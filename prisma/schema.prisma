generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ai_prompts {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(255)
  version    Int
  template   String    @db.Text
  created_at DateTime? @default(now()) @db.Timestamp(0)
  ai_runs    ai_runs[]

  @@unique([name, version], map: "name")
}

model ai_runs {
  id          Int        @id @default(autoincrement())
  prompt_id   Int
  run_id      Int?
  token_used  Int?
  cost_usd    Decimal?   @db.Decimal(10, 6)
  executed_at DateTime?  @default(now()) @db.Timestamp(0)
  ai_prompts  ai_prompts @relation(fields: [prompt_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "ai_runs_ibfk_1")
  test_runs   test_runs? @relation(fields: [run_id], references: [id], onUpdate: NoAction, map: "ai_runs_ibfk_2")

  @@index([prompt_id], map: "prompt_id")
  @@index([run_id], map: "run_id")
}

model api_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int
  token_hash String    @db.VarChar(255)
  scopes     Json?
  expires_at DateTime? @db.Timestamp(0)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "api_tokens_ibfk_1")

  @@index([user_id], map: "user_id")
}

model attachments {
  id               Int              @id @default(autoincrement())
  run_result_id    Int
  file_key         String           @db.VarChar(1024)
  mime_type        String?          @db.VarChar(100)
  size_bytes       BigInt?
  created_at       DateTime?        @default(now()) @db.Timestamp(0)
  test_run_results test_run_results @relation(fields: [run_result_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "attachments_ibfk_1")

  @@index([run_result_id], map: "run_result_id")
}

model audit_logs {
  id          BigInt    @id @default(autoincrement())
  user_id     Int?
  action      String    @db.VarChar(100)
  target_type String?   @db.VarChar(50)
  target_id   BigInt?
  meta        Json?
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  users       users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "audit_logs_ibfk_1")

  @@index([user_id], map: "user_id")
}

model feature_flags {
  flag_name          String    @id @db.VarChar(100)
  is_enabled         Boolean?  @default(false)
  rollout_percentage Int?      @db.UnsignedTinyInt
  updated_at         DateTime? @default(now()) @db.Timestamp(0)
}

model job_logs {
  id         BigInt          @id @default(autoincrement())
  job_name   String          @db.VarChar(255)
  status     job_logs_status
  message    String?         @db.Text
  started_at DateTime?       @db.Timestamp(0)
  ended_at   DateTime?       @db.Timestamp(0)
}

model metrics_daily {
  metric_date     DateTime @db.Date
  suite_id        Int
  pass_rate       Decimal? @db.Decimal(5, 2)
  avg_duration_ms Int?

  @@id([metric_date, suite_id])
}

model reports {
  id           Int       @id @default(autoincrement())
  run_id       Int
  summary      Json?
  generated_at DateTime? @default(now()) @db.Timestamp(0)
  test_runs    test_runs @relation(fields: [run_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "reports_ibfk_1")

  @@index([run_id], map: "run_id")
}

model roles {
  id         Int          @id @default(autoincrement())
  name       String       @unique(map: "name") @db.VarChar(50)
  user_roles user_roles[]
}

model settings {
  key        String    @id @db.VarChar(255)
  value      String?   @db.Text
  updated_at DateTime? @default(now()) @db.Timestamp(0)
}

model step_screenshots {
  id               Int                     @id @default(autoincrement())
  run_id           String                  @db.VarChar(255)
  test_case_id     Int?
  step_index       String                  @db.VarChar(50)
  step_description String?                 @db.Text
  status           step_screenshots_status
  file_path        String                  @db.VarChar(1024)
  file_name        String                  @db.VarChar(255)
  file_size        BigInt?
  mime_type        String?                 @default("image/png") @db.VarChar(100)
  created_at       DateTime?               @default(now()) @db.Timestamp(0)
  file_exists      Boolean                 @default(true)
  test_cases       test_cases?             @relation(fields: [test_case_id], references: [id])

  @@index([created_at], map: "idx_created_at")
  @@index([run_id], map: "idx_run_id")
  @@index([test_case_id], map: "idx_test_case_id")
}

model suite_case_map {
  suite_id    Int
  case_id     Int
  test_suites test_suites @relation(fields: [suite_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "suite_case_map_ibfk_1")
  test_cases  test_cases  @relation(fields: [case_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "suite_case_map_ibfk_2")

  @@id([suite_id, case_id])
  @@index([case_id], map: "case_id")
}

model test_cases {
  id                   Int                    @id @default(autoincrement())
  title                String                 @db.VarChar(255)
  steps                Json?
  tags                 Json?
  system               String?                @db.VarChar(100)
  module               String?                @db.VarChar(100)
  project              String?                @db.VarChar(100)
  created_at           DateTime?              @default(now()) @db.Timestamp(0)
  updated_at           DateTime?              @updatedAt @db.Timestamp(0)
  patch_proposals      case_patch_proposals[]
  case_versions        case_versions[]
  step_screenshots     step_screenshots[]
  suite_case_map       suite_case_map[]
  test_case_executions test_case_executions[]
  test_run_results     test_run_results[]
}

model test_run_results {
  id             Int                     @id @default(autoincrement())
  run_id         Int
  case_id        Int
  status         test_run_results_status
  duration_ms    Int?
  screenshot_url String?                 @db.VarChar(1024)
  executed_at    DateTime?               @default(now()) @db.Timestamp(0)
  attachments    attachments[]
  test_runs      test_runs               @relation(fields: [run_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "test_run_results_ibfk_1")
  test_cases     test_cases              @relation(fields: [case_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "test_run_results_ibfk_2")

  @@index([case_id], map: "case_id")
  @@index([run_id], map: "run_id")
}

model test_runs {
  id               Int                @id @default(autoincrement())
  suite_id         Int
  trigger_user_id  Int
  status           test_runs_status
  started_at       DateTime?          @db.Timestamp(0)
  finished_at      DateTime?          @db.Timestamp(0)
  ai_runs          ai_runs[]
  reports          reports[]
  test_run_results test_run_results[]
  test_suites      test_suites        @relation(fields: [suite_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "test_runs_ibfk_1")
  users            users              @relation(fields: [trigger_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "test_runs_ibfk_2")

  @@index([suite_id], map: "suite_id")
  @@index([trigger_user_id], map: "trigger_user_id")
}

model test_suites {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  owner_id       Int
  project        String?          @db.VarChar(100)
  metadata       Json?
  created_at     DateTime?        @default(now()) @db.Timestamp(0)
  suite_case_map suite_case_map[]
  test_runs      test_runs[]
  users          users            @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "test_suites_ibfk_1")

  @@index([owner_id], map: "owner_id")
}

model user_roles {
  user_id Int
  role_id Int
  users   users @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_ibfk_1")
  roles   roles @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_roles_ibfk_2")

  @@id([user_id, role_id])
  @@index([role_id], map: "role_id")
}

model users {
  id                     Int                      @id @default(autoincrement())
  email                  String                   @unique(map: "email") @db.VarChar(255)
  username               String                   @unique(map: "username") @db.VarChar(100)
  account_name           String?                  @db.VarChar(100)
  password_hash          String                   @db.VarChar(255)
  project                String?                  @db.VarChar(100)
  is_super_admin         Boolean                  @default(false)
  created_at             DateTime?                @default(now()) @db.Timestamp(0)
  ai_generation_sessions ai_generation_sessions[]
  api_tokens             api_tokens[]
  audit_logs             audit_logs[]
  bulk_edit_sessions          bulk_edit_sessions[]
  case_versions               case_versions[]
  functional_test_cases       functional_test_cases[]
  requirement_documents       requirement_documents[]
  test_case_executions        test_case_executions[]
  test_runs                   test_runs[]
  test_suites                 test_suites[]
  user_roles                  user_roles[]
  functional_test_executions  functional_test_executions[]
  test_plans                  test_plans[]
}

model run_artifacts {
  id        Int      @id @default(autoincrement())
  runId     String   @db.VarChar(255)
  type      String   @db.VarChar(50)
  filename  String   @db.VarChar(255)
  size      BigInt
  createdAt DateTime @default(now()) @db.Timestamp(0)

  @@index([runId], map: "idx_run_id")
  @@index([createdAt], map: "idx_created_at")
}

model case_versions {
  id         Int        @id @default(autoincrement())
  case_id    Int
  version    Int
  steps      Json?
  tags       Json?
  system     String?    @db.VarChar(100)
  module     String?    @db.VarChar(100)
  meta       Json?
  created_by Int?
  created_at DateTime?  @default(now()) @db.Timestamp(0)
  test_cases test_cases @relation(fields: [case_id], references: [id], onDelete: Cascade)
  users      users?     @relation(fields: [created_by], references: [id])

  @@unique([case_id, version])
  @@index([case_id])
  @@index([created_at])
  @@index([created_by], map: "case_versions_created_by_fkey")
}

model bulk_edit_sessions {
  id              Int                       @id @default(autoincrement())
  system          String                    @db.VarChar(100)
  module          String                    @db.VarChar(100)
  tag_filter      Json?
  priority_filter String?                   @db.VarChar(50)
  change_brief    String                    @db.Text
  status          bulk_edit_sessions_status @default(dry_run)
  created_by      Int
  created_at      DateTime?                 @default(now()) @db.Timestamp(0)
  applied_at      DateTime?                 @db.Timestamp(0)
  users           users                     @relation(fields: [created_by], references: [id], onDelete: Cascade)
  proposals       case_patch_proposals[]

  @@index([created_by])
  @@index([status])
  @@index([created_at])
}

model case_patch_proposals {
  id            Int                   @id @default(autoincrement())
  session_id    Int
  case_id       Int
  diff_json     Json
  ai_rationale  String?               @db.Text
  side_effects  Json?
  risk_level    proposal_risk_level   @default(medium)
  recall_reason String?               @db.VarChar(255)
  old_hash      String                @db.VarChar(255)
  new_hash      String?               @db.VarChar(255)
  apply_status  proposal_apply_status @default(pending)
  created_at    DateTime?             @default(now()) @db.Timestamp(0)
  applied_at    DateTime?             @db.Timestamp(0)
  test_cases    test_cases            @relation(fields: [case_id], references: [id], onDelete: Cascade)
  session       bulk_edit_sessions    @relation(fields: [session_id], references: [id], onDelete: Cascade)

  @@index([session_id])
  @@index([case_id])
  @@index([apply_status])
}

model test_case_executions {
  id                  String                     @id @db.VarChar(255)
  test_case_id        Int
  test_case_title     String                     @db.VarChar(255)
  environment         String                     @default("default") @db.VarChar(100)
  execution_mode      String                     @default("standard") @db.VarChar(50)
  status              test_case_execution_status @default(queued)
  executor_user_id    Int?
  executor_project    String?                    @db.VarChar(100)
  queued_at           DateTime                   @default(now()) @db.Timestamp(0)
  started_at          DateTime?                  @db.Timestamp(0)
  finished_at         DateTime?                  @db.Timestamp(0)
  duration_ms         Int?
  total_steps         Int                        @default(0)
  completed_steps     Int                        @default(0)
  passed_steps        Int                        @default(0)
  failed_steps        Int                        @default(0)
  progress            Int                        @default(0) @db.TinyInt
  error_message       String?                    @db.Text
  execution_logs      Json?
  screenshots         Json?
  artifacts           Json?
  metadata            Json?
  users               users?                     @relation(fields: [executor_user_id], references: [id])
  test_cases          test_cases                 @relation(fields: [test_case_id], references: [id], onDelete: Cascade)

  @@index([test_case_id])
  @@index([executor_user_id])
  @@index([executor_project])
  @@index([status])
  @@index([queued_at])
  @@index([started_at])
  @@index([finished_at])
}

model functional_test_cases {
  id                  Int                      @id @default(autoincrement())
  case_id             String?                  @db.VarChar(100)
  name                String                   @db.VarChar(255)
  description         String?                  @db.Text
  system              String?                  @db.VarChar(100)
  module              String?                  @db.VarChar(100)
  priority            functional_test_priority @default(medium)
  tags                String?                  @db.VarChar(500)
  status              functional_test_status   @default(PUBLISHED)
  source              functional_test_source   @default(MANUAL)
  ai_session_id       String?                  @db.VarChar(100)
  creator_id          Int
  test_type           String?                  @db.VarChar(50)
  preconditions       String?                  @db.Text
  test_data           String?                  @db.Text
  section_id          String?                  @db.VarChar(50)
  section_name        String?                  @db.VarChar(255)
  scenario_name       String?                  @db.VarChar(255)
  scenario_description String?                 @db.Text
  batch_number        Int?                     @default(0)
  coverage_areas      String?                  @db.VarChar(500)
  created_at          DateTime                 @default(now()) @db.Timestamp(0)
  updated_at          DateTime                 @updatedAt @db.Timestamp(0)
  case_type           functional_case_type     @default(FULL)
  project_version_id  Int?
  requirement_source  String?                  @db.Text
  section_description String?                  @db.Text
  expected_result     String?                  @db.Text
  risk_level          functional_risk_level    @default(medium)
  steps               String?                  @db.Text
  test_point_name     String?                  @db.VarChar(500)
  test_purpose        String?                  @db.Text
  requirement_doc_id  Int?
  deleted_at          DateTime?                @db.Timestamp(0)  // ğŸ†• è½¯åˆ é™¤å­—æ®µï¼Œnullè¡¨ç¤ºæœªåˆ é™¤
  users               users                            @relation(fields: [creator_id], references: [id], onDelete: Cascade)
  project_version     project_versions?                @relation(fields: [project_version_id], references: [id])
  requirement_doc     requirement_documents?           @relation(fields: [requirement_doc_id], references: [id])
  executions          functional_test_executions[]

  @@index([system])
  @@index([module])
  @@index([creator_id])
  @@index([ai_session_id])
  @@index([source])
  @@index([section_id])
  @@index([batch_number])
  @@index([project_version_id])
  @@index([case_type])
  @@index([test_point_name])
  @@index([requirement_doc_id])
  @@index([deleted_at])  // ğŸ†• è½¯åˆ é™¤ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
}

model ai_generation_sessions {
  id                    String                  @id @db.VarChar(100)
  user_id               Int
  axure_filename        String                  @db.VarChar(255)
  axure_file_size       Int
  project_name          String?                 @db.VarChar(255)
  system_type           String?                 @db.VarChar(50)
  business_domain       String?                 @db.VarChar(100)
  requirement_doc       String?                 @db.Text
  page_count            Int                     @default(0)
  element_count         Int                     @default(0)
  interaction_count     Int                     @default(0)
  total_generated       Int                     @default(0)
  total_saved           Int                     @default(0)
  batches               Json?
  pre_analysis_result   Json?
  enhanced_data         Json?
  created_at            DateTime                @default(now()) @db.Timestamp(0)
  users                 users                   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  requirement_documents requirement_documents[]

  @@index([user_id])
  @@index([created_at])
}

model requirement_documents {
  id                 Int                     @id @default(autoincrement())
  title              String                  @db.VarChar(255)
  content            String                  @db.LongText
  summary            String?                 @db.Text
  source_filename    String?                 @db.VarChar(255)
  ai_session_id      String?                 @db.VarChar(100)
  project_id         Int?
  project_version_id Int?
  creator_id         Int
  scenario_count     Int                     @default(0)
  test_case_count    Int                     @default(0)
  status             requirement_doc_status  @default(ACTIVE)
  created_at         DateTime                @default(now()) @db.Timestamp(0)
  updated_at         DateTime                @updatedAt @db.Timestamp(0)
  module             String?                 @db.VarChar(255)
  system             String?                 @db.VarChar(255)
  test_cases         functional_test_cases[]
  ai_session         ai_generation_sessions? @relation(fields: [ai_session_id], references: [id])
  users              users                   @relation(fields: [creator_id], references: [id], onDelete: Cascade)
  project            systems?                @relation(fields: [project_id], references: [id])
  project_version    project_versions?       @relation(fields: [project_version_id], references: [id])

  @@index([creator_id])
  @@index([ai_session_id])
  @@index([project_id])
  @@index([project_version_id])
  @@index([status])
  @@index([created_at])
}

model systems {
  id                    Int                     @id @default(autoincrement())
  name                  String                  @unique @db.VarChar(100)
  short_name            String?                 @db.VarChar(20)
  description           String?                 @db.Text
  status                system_status           @default(active)
  sort_order            Int                     @default(0)
  created_at            DateTime                @default(now()) @db.Timestamp(0)
  updated_at            DateTime                @updatedAt @db.Timestamp(0)
  versions              project_versions[]
  requirement_documents requirement_documents[]

  @@index([status])
  @@index([sort_order])
}

model project_versions {
  id                    Int                     @id @default(autoincrement())
  project_id            Int
  version_name          String                  @db.VarChar(100)
  version_code          String                  @db.VarChar(50)
  description           String?                 @db.Text
  is_main               Boolean                 @default(false)
  status                system_status           @default(active)
  release_date          DateTime?               @db.Date
  created_at            DateTime                @default(now()) @db.Timestamp(0)
  updated_at            DateTime                @updatedAt @db.Timestamp(0)
  functional_test_cases functional_test_cases[]
  project               systems                 @relation(fields: [project_id], references: [id], onDelete: Cascade)
  requirement_documents requirement_documents[]

  @@unique([project_id, version_code])
  @@index([project_id])
  @@index([is_main])
}

enum job_logs_status {
  STARTED
  SUCCESS
  FAILED
}

enum test_run_results_status {
  PASSED
  FAILED
  SKIPPED
}

enum test_runs_status {
  PENDING
  RUNNING
  PASSED
  FAILED
  CANCELLED
}

enum step_screenshots_status {
  success
  failed
  error
  completed
}

enum bulk_edit_sessions_status {
  dry_run
  applied
  cancelled
  failed
}

enum proposal_risk_level {
  low
  medium
  high
}

enum proposal_apply_status {
  pending
  applied
  skipped
  conflicted
}

enum test_case_execution_status {
  queued
  running
  completed
  failed
  cancelled
  error
}

enum functional_risk_level {
  low
  medium
  high
}

enum requirement_doc_status {
  ACTIVE
  ARCHIVED
  DELETED
}

enum functional_test_priority {
  low
  medium
  high
  critical
}

enum functional_test_status {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum functional_test_source {
  MANUAL
  AI_GENERATED
}

enum functional_case_type {
  SMOKE         // å†’çƒŸæµ‹è¯•
  FULL          // å…¨é‡æµ‹è¯•
  ABNORMAL      // å¼‚å¸¸æµ‹è¯•
  BOUNDARY      // è¾¹ç•Œæµ‹è¯•
  PERFORMANCE   // æ€§èƒ½æµ‹è¯•
  SECURITY      // å®‰å…¨æµ‹è¯•
  USABILITY     // å¯ç”¨æ€§æµ‹è¯•
  COMPATIBILITY // å…¼å®¹æ€§æµ‹è¯•
}

enum functional_execution_result {
  pass
  fail
  block
}

model functional_test_executions {
  id                    String                        @id @default(uuid()) @db.VarChar(100)
  test_case_id          Int
  test_case_name        String                        @db.VarChar(255)
  
  // æ‰§è¡Œç»“æœ
  final_result          functional_execution_result
  actual_result         String                        @db.Text
  comments              String?                       @db.Text
  
  // æ‰§è¡Œä¿¡æ¯
  duration_ms           Int?                          // æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
  executed_at           DateTime                      @default(now()) @db.Timestamp(0)
  executor_id           Int
  executor_project      String?                       @db.VarChar(100)
  
  // æ­¥éª¤æ‰§è¡Œè¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰
  step_results          Json?                         // [{action, expected, result, note}]
  total_steps           Int                           @default(0)
  completed_steps       Int                           @default(0)
  passed_steps          Int                           @default(0)
  failed_steps          Int                           @default(0)
  blocked_steps         Int                           @default(0)
  
  // é™„ä»¶å’Œæˆªå›¾ï¼ˆJSONæ ¼å¼ï¼‰
  screenshots           Json?                         // [{ url, filename, timestamp }]
  attachments           Json?                         // [{ url, filename, size, type }]
  
  // å…ƒæ•°æ®
  metadata              Json?                         // å…¶ä»–å…ƒæ•°æ®
  
  // å…³è”
  test_case             functional_test_cases         @relation(fields: [test_case_id], references: [id], onDelete: Cascade)
  executor              users                         @relation(fields: [executor_id], references: [id], onDelete: Cascade)
  
  @@index([test_case_id])
  @@index([executor_id])
  @@index([executed_at])
  @@index([final_result])
  @@index([executor_project])
}

enum system_status {
  active
  inactive
}

// ğŸ”¥ æµ‹è¯•è®¡åˆ’æ¨¡å—

enum test_plan_status {
  draft        // è‰ç¨¿
  active       // è¿›è¡Œä¸­
  completed    // å·²å®Œæˆ
  cancelled    // å·²å–æ¶ˆ
  archived     // å·²å½’æ¡£
}

enum test_plan_type {
  functional   // åŠŸèƒ½æµ‹è¯•
  ui_auto      // UIè‡ªåŠ¨åŒ–æµ‹è¯•
  mixed        // æ··åˆæµ‹è¯•
  regression   // å›å½’æµ‹è¯•
  smoke        // å†’çƒŸæµ‹è¯•
  integration  // é›†æˆæµ‹è¯•
}

// æµ‹è¯•è®¡åˆ’ä¸»è¡¨
model test_plans {
  id                  Int                      @id @default(autoincrement())
  name                String                   @db.VarChar(255)
  short_name          String?                  @db.VarChar(100)
  description         String?                  @db.Text
  project             String?                  @db.VarChar(100)
  plan_type           test_plan_type           @default(functional)
  status              test_plan_status         @default(draft)
  members             Json?                    // æµ‹è¯•æˆå‘˜åˆ—è¡¨ [userId1, userId2, ...]
  owner_id            Int                      // ä¸»è´Ÿè´£äºº
  start_date          DateTime?                @db.Timestamp(0)
  end_date            DateTime?                @db.Timestamp(0)
  created_at          DateTime                 @default(now()) @db.Timestamp(0)
  updated_at          DateTime                 @updatedAt @db.Timestamp(0)
  deleted_at          DateTime?                @db.Timestamp(0)
  
  // å…³è”
  owner               users                    @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  plan_cases          test_plan_cases[]
  plan_executions     test_plan_executions[]
  
  @@index([owner_id])
  @@index([project])
  @@index([plan_type])
  @@index([status])
  @@index([created_at])
  @@index([deleted_at])
}

// æµ‹è¯•è®¡åˆ’ä¸ç”¨ä¾‹å…³è”è¡¨
model test_plan_cases {
  id                  Int                      @id @default(autoincrement())
  plan_id             Int
  case_id             Int
  case_type           String                   @db.VarChar(50) // 'functional' æˆ– 'ui_auto'
  case_name           String                   @db.VarChar(255)
  sort_order          Int                      @default(0)
  is_executed         Boolean                  @default(false)
  execution_result    String?                  @db.VarChar(50) // 'pass', 'fail', 'block', 'skip'
  created_at          DateTime                 @default(now()) @db.Timestamp(0)
  
  // å…³è”
  plan                test_plans               @relation(fields: [plan_id], references: [id], onDelete: Cascade)
  
  @@unique([plan_id, case_id, case_type])
  @@index([plan_id])
  @@index([case_id])
  @@index([case_type])
}

// æµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•è¡¨
model test_plan_executions {
  id                  String                   @id @default(uuid()) @db.VarChar(100)
  plan_id             Int
  plan_name           String                   @db.VarChar(255)
  executor_id         Int
  executor_name       String                   @db.VarChar(100)
  execution_type      String                   @db.VarChar(50) // 'functional' æˆ– 'ui_auto'
  status              String                   @db.VarChar(50) // 'running', 'completed', 'failed', 'cancelled'
  progress            Int                      @default(0) @db.TinyInt
  
  // ç»Ÿè®¡ä¿¡æ¯
  total_cases         Int                      @default(0)
  completed_cases     Int                      @default(0)
  passed_cases        Int                      @default(0)
  failed_cases        Int                      @default(0)
  blocked_cases       Int                      @default(0)
  skipped_cases       Int                      @default(0)
  
  // æ—¶é—´ä¿¡æ¯
  started_at          DateTime                 @default(now()) @db.Timestamp(0)
  finished_at         DateTime?                @db.Timestamp(0)
  duration_ms         Int?
  
  // æ‰§è¡Œè¯¦æƒ…å’Œç»“æœ
  execution_results   Json?                    // æ¯ä¸ªç”¨ä¾‹çš„æ‰§è¡Œç»“æœè¯¦æƒ…
  error_message       String?                  @db.Text
  metadata            Json?
  
  // å…³è”
  plan                test_plans               @relation(fields: [plan_id], references: [id], onDelete: Cascade)
  
  @@index([plan_id])
  @@index([executor_id])
  @@index([status])
  @@index([started_at])
  @@index([finished_at])
}
