<!DOCTYPE html>
<html>
<head>
    <title>å‰ç«¯é…ç½®è°ƒè¯•</title>
</head>
<body>
    <h1>å‰ç«¯é…ç½®è°ƒè¯•</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += '<p>' + message + '</p>';
        }

        async function debugFrontendConfig() {
            log('ğŸ” å¼€å§‹è°ƒè¯•å‰ç«¯é…ç½®...');
            
            // 1. æ£€æŸ¥localStorageä¸­çš„é…ç½®
            log('\nğŸ“‹ æ£€æŸ¥localStorageé…ç½®:');
            const storedConfig = localStorage.getItem('testflow_settings');
            if (storedConfig) {
                try {
                    const parsed = JSON.parse(storedConfig);
                    log('âœ… localStorageé…ç½®å­˜åœ¨:');
                    log('   æ¨¡å‹: ' + (parsed.llm?.selectedModelId || 'æœªè®¾ç½®'));
                    log('   æ¸©åº¦: ' + (parsed.llm?.customConfig?.temperature || 'æœªè®¾ç½®'));
                    log('   æœ€å¤§ä»¤ç‰Œ: ' + (parsed.llm?.customConfig?.maxTokens || 'æœªè®¾ç½®'));
                } catch (e) {
                    log('âŒ localStorageé…ç½®è§£æå¤±è´¥: ' + e.message);
                }
            } else {
                log('âŒ localStorageä¸­æ²¡æœ‰é…ç½®');
            }
            
            // 2. æµ‹è¯•APIè°ƒç”¨
            log('\nğŸŒ æµ‹è¯•APIè°ƒç”¨:');
            try {
                const response = await fetch('/api/config/llm');
                log('APIå“åº”çŠ¶æ€: ' + response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    log('âœ… APIè°ƒç”¨æˆåŠŸ:');
                    log('   Success: ' + result.success);
                    if (result.data) {
                        log('   æ¨¡å‹: ' + (result.data.selectedModelId || 'æœªè®¾ç½®'));
                        log('   æ¸©åº¦: ' + (result.data.customConfig?.temperature || 'æœªè®¾ç½®'));
                        log('   æœ€å¤§ä»¤ç‰Œ: ' + (result.data.customConfig?.maxTokens || 'æœªè®¾ç½®'));
                    } else {
                        log('   âš ï¸ APIè¿”å›æ•°æ®ä¸ºç©º');
                    }
                } else {
                    const errorText = await response.text();
                    log('âŒ APIè°ƒç”¨å¤±è´¥: ' + errorText);
                }
            } catch (error) {
                log('âŒ APIè°ƒç”¨å¼‚å¸¸: ' + error.message);
            }
            
            // 3. æ¨¡æ‹Ÿå‰ç«¯è®¾ç½®æœåŠ¡çš„è¡Œä¸º
            log('\nğŸ”§ æ¨¡æ‹Ÿå‰ç«¯è®¾ç½®æœåŠ¡:');
            try {
                // æ¨¡æ‹ŸsettingsService.getLLMSettings()çš„é€»è¾‘
                let finalConfig = null;
                
                // å…ˆå°è¯•API
                try {
                    const response = await fetch('/api/config/llm');
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.data) {
                            finalConfig = result.data;
                            log('âœ… ä½¿ç”¨APIé…ç½®');
                        }
                    }
                } catch (apiError) {
                    log('âš ï¸ APIè°ƒç”¨å¤±è´¥ï¼Œå›é€€åˆ°localStorage');
                }
                
                // APIå¤±è´¥æ—¶ä½¿ç”¨localStorage
                if (!finalConfig) {
                    const storedConfig = localStorage.getItem('testflow_settings');
                    if (storedConfig) {
                        const parsed = JSON.parse(storedConfig);
                        finalConfig = parsed.llm;
                        log('âœ… ä½¿ç”¨localStorageé…ç½®');
                    }
                }
                
                if (finalConfig) {
                    log('ğŸ“‹ æœ€ç»ˆé…ç½®:');
                    log('   æ¨¡å‹: ' + (finalConfig.selectedModelId || 'æœªè®¾ç½®'));
                    log('   æ¸©åº¦: ' + (finalConfig.customConfig?.temperature || 'æœªè®¾ç½®'));
                    log('   æœ€å¤§ä»¤ç‰Œ: ' + (finalConfig.customConfig?.maxTokens || 'æœªè®¾ç½®'));
                } else {
                    log('âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•é…ç½®');
                }
                
            } catch (error) {
                log('âŒ æ¨¡æ‹Ÿè®¾ç½®æœåŠ¡å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œè°ƒè¯•
        window.addEventListener('load', debugFrontendConfig);
    </script>
</body>
</html>