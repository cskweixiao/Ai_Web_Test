## ç”¨ä¾‹æ‰§è¡Œå®Œæˆåè‡ªåŠ¨æ›´æ–°æµ‹è¯•è®¡åˆ’çŠ¶æ€ + æ‰§è¡Œè¯¦æƒ…WebSocketå®æ—¶æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `server/services/testPlanService.ts` - æ·»åŠ updateTestPlanStatusFromLatestExecutionå‡½æ•°ï¼Œè‡ªåŠ¨æ›´æ–°test_plansè¡¨çŠ¶æ€
- `src/components/TestPlanExecutionLogModal.tsx` - æ·»åŠ WebSocketç›‘å¬å’Œè½®è¯¢æœºåˆ¶å®æ—¶æ›´æ–°æ‰§è¡Œè¯¦æƒ…

**é—®é¢˜æè¿°ï¼š**
1. åŠŸèƒ½ç”¨ä¾‹æˆ–UIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œå®Œæˆåï¼Œtest_plansè¡¨çš„statusçŠ¶æ€å’Œæ›´æ–°æ—¶é—´æ²¡æœ‰åŒæ­¥æ›´æ–°
2. TestPlanExecutionLogModalæ‰§è¡Œè¯¦æƒ…é¡µé¢æ²¡æœ‰å®æ—¶æ›´æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°æ‰èƒ½çœ‹åˆ°æœ€æ–°æ•°æ®

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. åç«¯ï¼šæ·»åŠ updateTestPlanStatusFromLatestExecutionå‡½æ•°
æ ¹æ®æœ€æ–°çš„æ‰§è¡Œå†å²è®°å½•è‡ªåŠ¨æ›´æ–°test_plansè¡¨ï¼š
- statuså­—æ®µï¼šæ ¹æ®æ‰§è¡Œæƒ…å†µæ›´æ–°ä¸ºactive/completed/expired
- updated_atå­—æ®µï¼šæ›´æ–°ä¸ºå½“å‰æ—¶é—´
- åˆ¤æ–­é€»è¾‘ï¼š
  - å·²å½’æ¡£(archived)ï¼šä¿æŒä¸å˜
  - æ— ç”¨ä¾‹(draft)ï¼šä¿æŒè‰ç¨¿çŠ¶æ€
  - å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼šcompleted
  - è®¡åˆ’æ—¶é—´å·²è¿‡ä½†æœªå®Œæˆï¼šexpired
  - æœ‰ç”¨ä¾‹å·²æ‰§è¡Œä½†æœªå…¨éƒ¨å®Œæˆï¼šactive

### 2. åç«¯ï¼šåœ¨æ‰§è¡Œå®Œæˆæ—¶è‡ªåŠ¨è°ƒç”¨çŠ¶æ€æ›´æ–°
- updateTestPlanExecutionå‡½æ•°ï¼šå½“statuså˜ä¸ºcompletedæˆ–failedæ—¶è‡ªåŠ¨è°ƒç”¨
- startTestPlanExecutionå‡½æ•°ï¼šUIè‡ªåŠ¨åŒ–æ‰¹é‡æ‰§è¡Œå®Œæˆåè‡ªåŠ¨è°ƒç”¨

### 3. å‰ç«¯ï¼šTestPlanExecutionLogModalæ·»åŠ WebSocketç›‘å¬
- ç›‘å¬test_completeå’Œtest_updateäº‹ä»¶
- æ”¶åˆ°äº‹ä»¶å200mså»¶è¿Ÿåˆ·æ–°ï¼Œé˜²æ­¢é¢‘ç¹è¯·æ±‚
- å¤‡ç”¨è½®è¯¢æœºåˆ¶ï¼šå½“æœ‰è¿è¡Œä¸­çš„æµ‹è¯•æ—¶ï¼Œæ¯3ç§’è‡ªåŠ¨åˆ·æ–°

---

## æ‰©å±•æ‰§è¡Œè¯¦æƒ…å­˜å‚¨å®é™…æ‰§è¡ŒçŠ¶æ€ï¼ˆexecution_statusï¼‰

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `server/services/testPlanService.ts` - waitForTestCompletionè¿”å›execution_statusï¼ˆUIè‡ªåŠ¨åŒ–ï¼‰
- `server/services/testExecution.ts` - syncToTestPlanExecutionæ·»åŠ execution_statusï¼ˆUIè‡ªåŠ¨åŒ–ï¼‰
- `src/pages/TestPlanExecute.tsx` - åŠŸèƒ½æµ‹è¯•æ‰§è¡Œæ—¶æ„å»ºexecutionResultsæ·»åŠ execution_status
- `src/types/testPlan.ts` - TestPlanCaseResultæ¥å£æ·»åŠ execution_statuså­—æ®µ
- `src/components/TestPlanExecutionLogModal.tsx` - getExecutionStatusTextä½¿ç”¨execution_status

**é—®é¢˜æè¿°ï¼š**
æ‰§è¡Œè¯¦æƒ…å¼¹çª—ä¸­çš„"æ‰§è¡ŒçŠ¶æ€"åˆ—åªæ ¹æ®resultå­—æ®µåˆ¤æ–­ï¼Œæ— æ³•æ˜¾ç¤ºå®é™…çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆå¦‚æ‰§è¡Œä¸­ã€å·²å¤±è´¥ã€å·²å–æ¶ˆç­‰ï¼‰ã€‚

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. åç«¯è¿”å›execution_statusï¼ˆUIè‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼‰
åœ¨`waitForTestCompletion`è¿”å›å€¼ä¸­æ·»åŠ `execution_status`å­—æ®µï¼š
- running - æ‰§è¡Œä¸­
- completed - å·²å®Œæˆ
- failed - å·²å¤±è´¥
- cancelled - å·²å–æ¶ˆ
- error - æ‰§è¡Œé”™è¯¯
- queued - æ’é˜Ÿä¸­

### 2. å‰ç«¯æ„å»ºexecution_statusï¼ˆåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹ï¼‰
åœ¨`TestPlanExecute.tsx`çš„`executionResults`æ„å»ºé€»è¾‘ä¸­æ·»åŠ `execution_status: 'completed'`ã€‚

### 3. å‰ç«¯æ˜¾ç¤ºå®é™…çŠ¶æ€
ä¿®æ”¹`getExecutionStatusText`å‡½æ•°ï¼Œä¼˜å…ˆä½¿ç”¨`execution_status`å­—æ®µæ˜¾ç¤ºå®é™…æ‰§è¡ŒçŠ¶æ€ã€‚

**æ•ˆæœï¼š**
1. âœ… åŠŸèƒ½æµ‹è¯•å’ŒUIè‡ªåŠ¨åŒ–ç”¨ä¾‹éƒ½å­˜å‚¨å®é™…æ‰§è¡ŒçŠ¶æ€
2. âœ… æ‰§è¡Œè¯¦æƒ…å¼¹çª—æ˜¾ç¤ºæ­£ç¡®çš„çŠ¶æ€æ–‡æœ¬
3. âœ… æ”¯æŒæ˜¾ç¤ºï¼šæ‰§è¡Œä¸­ã€å·²å®Œæˆã€å·²å¤±è´¥ã€å·²å–æ¶ˆã€æ‰§è¡Œé”™è¯¯ã€æ’é˜Ÿä¸­

---

## ä¿®å¤UIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œè¯¦æƒ…ç¼ºå°‘æ­¥éª¤ç»Ÿè®¡æ•°æ®çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `server/services/testPlanService.ts` - waitForTestCompletionå‡½æ•°è¿”å›æ­¥éª¤ç»Ÿè®¡
- `server/services/testExecution.ts` - syncToTestPlanExecutionæ·»åŠ æ­¥éª¤ç»Ÿè®¡

**é—®é¢˜æè¿°ï¼š**
UIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œå®Œæˆåï¼Œåœ¨æ‰§è¡Œè¯¦æƒ…å¼¹çª—ï¼ˆTestPlanExecutionLogModalï¼‰ä¸­ï¼Œæ­¥éª¤ç›¸å…³æ•°æ®ï¼ˆtotalStepsã€passedStepsã€failedStepsç­‰ï¼‰æ˜¾ç¤ºä¸º0æˆ–ç©ºï¼Œä¸åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹çš„æ•°æ®ç»“æ„ä¸ä¸€è‡´ã€‚

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. æ‰©å±•waitForTestCompletionè¿”å›å€¼
åœ¨`testPlanService.ts`ä¸­ï¼Œä¿®æ”¹`waitForTestCompletion`å‡½æ•°ï¼Œè¿”å›å®Œæ•´çš„æ­¥éª¤ç»Ÿè®¡æ•°æ®ï¼š
- totalSteps - æ€»æ­¥éª¤æ•°
- passedSteps - é€šè¿‡æ­¥éª¤æ•°
- failedSteps - å¤±è´¥æ­¥éª¤æ•°
- blockedSteps - é˜»å¡æ­¥éª¤æ•°
- completedSteps - å·²å®Œæˆæ­¥éª¤æ•°
- started_at - å¼€å§‹æ—¶é—´
- finished_at - ç»“æŸæ—¶é—´
- executor_name - æ‰§è¡Œäººåç§°
- executor_id - æ‰§è¡ŒäººID
- execution_status - æ‰§è¡ŒçŠ¶æ€

### 2. ä¿®æ”¹æ‰¹é‡æ‰§è¡Œç»“æœæ„å»ºé€»è¾‘
ä½¿ç”¨`waitForTestCompletion`è¿”å›çš„å®Œæ•´æ•°æ®æ„å»º`execution_results`ï¼š
```typescript
results.push({
  case_id, case_name, case_type, result, duration_ms, execution_id,
  // æ–°å¢æ­¥éª¤ç»Ÿè®¡æ•°æ®
  totalSteps: execResult.totalSteps,
  passedSteps: execResult.passedSteps,
  failedSteps: execResult.failedSteps,
  blockedSteps: execResult.blockedSteps,
  completedSteps: execResult.completedSteps,
  started_at: execResult.started_at,
  finished_at: execResult.finished_at,
  executor_name: execResult.executor_name,
  executor_id: execResult.executor_id,
});
```

### 3. ä¿®æ”¹å•ä¸ªæ‰§è¡ŒåŒæ­¥é€»è¾‘
åœ¨`testExecution.ts`çš„`syncToTestPlanExecution`æ–¹æ³•ä¸­ï¼Œæ·»åŠ æ­¥éª¤ç»Ÿè®¡æ•°æ®åˆ°`caseResult`å¯¹è±¡ã€‚

**æ•ˆæœï¼š**
1. âœ… UIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œè¯¦æƒ…æ˜¾ç¤ºå®Œæ•´çš„æ­¥éª¤ç»Ÿè®¡
2. âœ… ä¸åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹çš„æ•°æ®ç»“æ„ä¿æŒä¸€è‡´
3. âœ… æ”¯æŒåœ¨æ‰§è¡Œè¯¦æƒ…å¼¹çª—ä¸­æŸ¥çœ‹ï¼šæ€»æ­¥éª¤ã€é€šè¿‡ã€å¤±è´¥ã€é˜»å¡ç­‰ç»Ÿè®¡
4. âœ… å•ä¸ªæ‰§è¡Œå’Œæ‰¹é‡æ‰§è¡Œéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºæ­¥éª¤ç»Ÿè®¡

---

## ä¿®å¤UIè‡ªåŠ¨åŒ–æµ‹è¯•æ–­è¨€æ­¥éª¤æˆåŠŸåæœªè®¡å…¥passedStepså¯¼è‡´ç»“æœè¢«è¯¯åˆ¤ä¸ºblockçš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `server/services/testExecution.ts`

**é—®é¢˜æè¿°ï¼š**
UIè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå®Œæˆåï¼Œæ‰€æœ‰æ­¥éª¤ï¼ˆåŒ…æ‹¬æ“ä½œæ­¥éª¤å’Œæ–­è¨€æ­¥éª¤ï¼‰éƒ½æˆåŠŸé€šè¿‡ï¼Œä½†æœ€ç»ˆç»“æœå´è¢«åˆ¤å®šä¸º `blocked` è€Œä¸æ˜¯ `passed`ã€‚

**æ ¹å› åˆ†æï¼š**
åœ¨æ‰§è¡Œæµç¨‹ä¸­ï¼š
1. æ“ä½œæ­¥éª¤æˆåŠŸåä¼šæ›´æ–° `passedSteps`ï¼ˆ+1ï¼‰
2. **æ–­è¨€æ­¥éª¤æˆåŠŸåæ²¡æœ‰æ›´æ–° `passedSteps`**

å¯¼è‡´ `totalSteps=7`ï¼ˆ6ä¸ªæ“ä½œ+1ä¸ªæ–­è¨€ï¼‰ï¼Œä½† `passedSteps=6`ï¼ˆåªè®¡ç®—äº†æ“ä½œæ­¥éª¤ï¼‰ã€‚

åœ¨ `testPlanService.ts` çš„ç»“æœåˆ¤æ–­é€»è¾‘ä¸­ï¼š
```typescript
if (passedSteps < totalSteps) {
  result = 'block'; // 6 < 7ï¼Œè¢«è¯¯åˆ¤ä¸ºé˜»å¡
}
```

**ä¿®å¤å†…å®¹ï¼š**
åœ¨æ–­è¨€æ­¥éª¤æˆåŠŸåæ·»åŠ  `passedSteps` æ›´æ–°é€»è¾‘ï¼š

```typescript
this.addLog(runId, `âœ… æ–­è¨€ ${i + 1} é€šè¿‡`, 'success');

// ğŸ”¥ æ–­è¨€æˆåŠŸåæ›´æ–° passedStepsï¼ˆä¿®å¤ passedSteps å°‘è®¡1çš„bugï¼‰
if (testRun) {
  testRun.passedSteps = (testRun.passedSteps || 0) + 1;
  testRun.completedSteps = assertionIndex;
  testRun.progress = Math.round((assertionIndex / totalSteps) * 100);
}
```

**æ•ˆæœï¼š**
1. âœ… æ–­è¨€æ­¥éª¤æˆåŠŸåæ­£ç¡®ç´¯åŠ  `passedSteps`
2. âœ… `passedSteps` ä¸ `totalSteps` ç›¸ç­‰æ—¶æ­£ç¡®åˆ¤å®šä¸º `passed`
3. âœ… æ‰§è¡Œå†å²ä¸­çš„ç»Ÿè®¡æ•°æ®å‡†ç¡®æ— è¯¯

---

## ä¿®å¤å•ä¸ªUIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œæ—¶æ‰§è¡Œå†å²è®°å½•ä¸å®Œæ•´çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/pages/TestPlanDetail.tsx`

**é—®é¢˜æè¿°ï¼š**
å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶è®¾ç½®äº† `autoExecute: false`ï¼Œåç«¯åªåˆ›å»ºæ‰§è¡Œè®°å½•ä½†ä¸æ‰§è¡Œç”¨ä¾‹ã€‚å‰ç«¯è°ƒç”¨ `testService.runTestCase` æ‰§è¡Œç”¨ä¾‹åï¼Œæ‰§è¡Œå®Œæˆåæ²¡æœ‰æ›´æ–° `test_plan_executions` è¡¨çš„ `execution_results` å­—æ®µï¼Œå¯¼è‡´æ‰§è¡Œå†å²è®°å½•ä¸­çš„æ•°æ®ä¸å®Œæ•´ã€‚

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. ç»Ÿä¸€æ‰§è¡Œé€»è¾‘
ä¿®æ”¹ `handleConfirmExecute` å‡½æ•°ï¼Œè®©å•ä¸ªç”¨ä¾‹æ‰§è¡Œå’Œæ‰¹é‡æ‰§è¡Œéƒ½ä½¿ç”¨ `autoExecute: true`ï¼š

```typescript
// ğŸ”¥ ä¿®å¤ï¼šç»Ÿä¸€ä½¿ç”¨ autoExecute: trueï¼Œè®©åç«¯ç»Ÿä¸€å¤„ç†æ‰§è¡Œå’Œè®°å½•æ›´æ–°
await testPlanService.startTestPlanExecution({
  plan_id: parseInt(id!),
  executor_id: user!.id,
  execution_type: 'ui_auto',
  case_ids: caseIds,
  autoExecute: true, // ğŸ”¥ ä¿®å¤ï¼šå§‹ç»ˆä½¿ç”¨ true
  executionConfig: { ... }
});
```

### 2. ç»Ÿä¸€ç”¨æˆ·ä½“éªŒ
æ‰§è¡Œåç»Ÿä¸€åˆ‡æ¢åˆ°æ‰§è¡Œå†å²tabï¼ŒæŸ¥çœ‹æ‰§è¡Œè¿›åº¦ï¼Œä¿æŒç”¨æˆ·ä½“éªŒä¸€è‡´ï¼š

```typescript
// ğŸ”¥ ä¿®å¤ï¼šç»Ÿä¸€åˆ‡æ¢åˆ°æ‰§è¡Œå†å²tabï¼ŒæŸ¥çœ‹æ‰§è¡Œè¿›åº¦
setActiveTab('executions');
await loadTestPlanDetail();
```

**æ•ˆæœï¼š**
1. âœ… å•ä¸ªç”¨ä¾‹æ‰§è¡Œå’Œæ‰¹é‡æ‰§è¡Œéƒ½æ­£ç¡®è®°å½•åˆ° `test_plan_executions` è¡¨
2. âœ… `execution_results` å­—æ®µæ­£ç¡®æ›´æ–°ï¼ŒåŒ…å«æ‰§è¡Œç»“æœ
3. âœ… ç”¨æˆ·ä½“éªŒç»Ÿä¸€ï¼Œæ‰§è¡Œåéƒ½å¯åœ¨æ‰§è¡Œå†å²ä¸­æŸ¥çœ‹è¿›åº¦å’Œç»“æœ
4. âœ… æ•°æ®å®Œæ•´æ€§å¾—åˆ°ä¿è¯

---

## ä¼˜åŒ–å¹¶å¢å¼ºå•ä¸ªUIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œæ—¶çš„æ•°æ®è·å–é€»è¾‘

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `server/services/testPlanService.ts`

**é—®é¢˜æè¿°ï¼š**
è™½ç„¶ä¹‹å‰å·²ç»å®ç°äº†åŒæ•°æ®æºæŸ¥è¯¢ï¼ˆä»`execution_results`å’Œ`test_case_executions`è¡¨è·å–æ•°æ®ï¼‰ï¼Œä½†ç”±äºæ—¥å¿—ä¸å¤Ÿè¯¦ç»†ï¼Œæ— æ³•ç¡®è®¤ä»£ç æ˜¯å¦æ­£ç¡®æ‰§è¡Œä»¥åŠæ•°æ®æµå‘ã€‚ç”¨æˆ·åé¦ˆä¾æ—§æ˜¾ç¤ºä¸Šæ¬¡çš„çŠ¶æ€å’Œç»“æœï¼Œä¸æ˜¯æœ€æ–°çš„ã€‚

**ä¼˜åŒ–å†…å®¹ï¼š**

### 1. å¢å¼ºæ—¥å¿—ç³»ç»Ÿ
åœ¨åŒæ•°æ®æºæŸ¥è¯¢çš„æ•´ä¸ªæµç¨‹ä¸­æ·»åŠ è¯¦ç»†çš„æ—¥å¿—ï¼Œä¾¿äºè¿½è¸ªé—®é¢˜ï¼š

#### æ­¥éª¤1æ—¥å¿—ï¼ˆä»execution_resultsè·å–ï¼‰
```typescript
console.log(`ğŸ“‹ [testPlanService] å¼€å§‹æ„å»ºç”¨ä¾‹æ‰§è¡ŒçŠ¶æ€æ˜ å°„ï¼Œè®¡åˆ’ID: ${planId}`);
console.log(`ğŸ“‹ [testPlanService] æ‰§è¡Œè®°å½•æ€»æ•°: ${plan.plan_executions.length}`);
console.log(`ğŸ“Š [testPlanService] å¤„ç†æ‰§è¡Œè®°å½• ${execution.id}ï¼ŒåŒ…å« ${executionResults.length} ä¸ªç”¨ä¾‹ç»“æœ`);
console.log(`âœ… [æ­¥éª¤1] ç”¨ä¾‹ ${caseId} ä»execution_resultsè·å–çŠ¶æ€`);
console.log(`ğŸ“Š [æ­¥éª¤1å®Œæˆ] ä»execution_resultsè·å–äº† ${step1Count} ä¸ªç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€`);
```

#### æ­¥éª¤2æ—¥å¿—ï¼ˆä»test_case_executionsè¡¨è·å–ï¼‰
```typescript
console.log(`ğŸ” [æ­¥éª¤2å¼€å§‹] æŸ¥è¯¢ ${uiAutoCaseIds.length} ä¸ªUIè‡ªåŠ¨åŒ–ç”¨ä¾‹çš„æœ€æ–°æ‰§è¡Œè®°å½•`);
console.log(`ğŸ” [æ­¥éª¤2] ç”¨ä¾‹IDåˆ—è¡¨:`, uiAutoCaseIds);
console.log(`ğŸ” [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} æŸ¥è¯¢åˆ°æ‰§è¡Œè®°å½•`);
console.log(`ğŸ” [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} å†³ç­–`);
console.log(`âœ… [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} æ›´æ–°çŠ¶æ€`);
console.log(`ğŸ“Š [æ­¥éª¤2å®Œæˆ] ä»test_case_executionsæ›´æ–°äº† ${step2UpdateCount} ä¸ªç”¨ä¾‹`);
```

### 2. ä¿®å¤æ‰§è¡Œæ—¶é—´è·å–é€»è¾‘
**é—®é¢˜ï¼š** ä¹‹å‰çš„ä»£ç åœ¨`executed_at`ä¸ºç©ºæ—¶ä¼šä½¿ç”¨`new Date().toISOString()`ï¼Œè¿™ä¼šå¯¼è‡´æ—¶é—´æˆ³æ¯”è¾ƒå‡ºé—®é¢˜ã€‚

**ä¿®å¤ï¼š**
```typescript
// æ­¥éª¤1ï¼šä¼˜å…ˆä½¿ç”¨result.executed_atï¼Œå¦åˆ™ä½¿ç”¨execution.started_at
const executedAt = result.executed_at || execution.started_at.toISOString();

// æ­¥éª¤2ï¼šå¿…é¡»æ£€æŸ¥started_atæ˜¯å¦å­˜åœ¨
if (!execution.started_at) {
  console.warn(`âš ï¸ [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} è·³è¿‡ï¼šexecution.started_atä¸ºç©º`);
  continue;
}
const executedAt = execution.started_at.toISOString();
```

### 3. å¢å¼ºå†³ç­–é€»è¾‘å¯è§æ€§
æ·»åŠ è¯¦ç»†çš„å†³ç­–æ—¥å¿—ï¼Œæ˜ç¡®æ˜¾ç¤ºä¸ºä»€ä¹ˆé€‰æ‹©æŸä¸ªæ•°æ®æºï¼š

```typescript
console.log(`ğŸ” [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} å†³ç­–:`, {
  shouldUpdate,
  existing: existing ? {
    executed_at: existing.executed_at,
    result: existing.result,
    æ¥æº: 'æ­¥éª¤1'
  } : null,
  current: {
    executed_at: executedAt,
    æ¥æº: 'test_case_executions'
  }
});
```

### 4. å®Œå–„ç»Ÿè®¡ä¿¡æ¯
æ·»åŠ å„é˜¶æ®µçš„ç»Ÿè®¡è®¡æ•°ï¼š
- `step1Count`: ä»execution_resultsè·å–çš„ç”¨ä¾‹æ•°
- `step2UpdateCount`: ä»test_case_executionsæ›´æ–°çš„ç”¨ä¾‹æ•°
- `step2SkipCount`: è·³è¿‡æ›´æ–°çš„ç”¨ä¾‹æ•°
- æœ€ç»ˆçš„`caseExecutionMap.size`: æ€»å…±åŒ…å«çš„ç”¨ä¾‹æ•°

### 5. æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  getTestPlanDetail(planId)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º caseExecutionMap (Map<caseId, executionInfo>)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
        â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: æ‰¹é‡æ‰§è¡Œæ•°æ®    â”‚              â”‚  æ­¥éª¤2: å•ä¸ªæ‰§è¡Œæ•°æ®          â”‚
â”‚  æ¥æº: execution_resultsâ”‚              â”‚  æ¥æº: test_case_executions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”‚ éå† plan_executions                  â”‚ æŸ¥è¯¢æ¯ä¸ªUIè‡ªåŠ¨åŒ–ç”¨ä¾‹
        â”‚   â†“                                   â”‚   â†“
        â”‚ éå† execution_results                â”‚ findFirst (order by started_at desc)
        â”‚   â†“                                   â”‚   â†“
        â”‚ å¯¹æ¯”æ—¶é—´æˆ³                             â”‚ å¯¹æ¯”æ—¶é—´æˆ³
        â”‚   â†“                                   â”‚   â†“
        â”‚ æ›´æ–° caseExecutionMap                 â”‚ æ›´æ–° caseExecutionMap
        â”‚   â†“                                   â”‚   â†“
        â”‚ æ—¥å¿—: step1Count++                    â”‚ æ—¥å¿—: step2UpdateCount++ / step2SkipCount++
        â”‚                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æœ€ç»ˆ caseExecutionMap             â”‚
        â”‚  - åŒ…å«æ‰€æœ‰ç”¨ä¾‹çš„æœ€æ–°æ‰§è¡ŒçŠ¶æ€        â”‚
        â”‚  - ä¼˜å…ˆä½¿ç”¨æ—¶é—´æˆ³æ›´æ–°çš„æ•°æ®          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ„å»ºè¿”å›æ•°æ®                      â”‚
        â”‚  - cases: åŒ…å« last_execution     â”‚
        â”‚  - executions: æ‰§è¡Œå†å²           â”‚
        â”‚  - statistics: ç»Ÿè®¡ä¿¡æ¯           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. å…³é”®æ”¹è¿›ç‚¹

#### æ”¹è¿›1ï¼šæ‰§è¡Œæ—¶é—´è·å–æ›´å®‰å…¨
```typescript
// ä¹‹å‰ï¼šå¯èƒ½ä½¿ç”¨å½“å‰æ—¶é—´ï¼Œå¯¼è‡´æ—¶é—´æˆ³æ¯”è¾ƒé”™è¯¯
const executedAt = execution.started_at?.toISOString() || new Date().toISOString();

// ç°åœ¨ï¼šå¿…é¡»æœ‰started_atæ‰ç»§ç»­ï¼Œå¦åˆ™è·³è¿‡
if (!execution.started_at) {
  console.warn(`âš ï¸ [æ­¥éª¤2] ç”¨ä¾‹ ${caseId} è·³è¿‡ï¼šexecution.started_atä¸ºç©º`);
  continue;
}
const executedAt = execution.started_at.toISOString();
```

#### æ”¹è¿›2ï¼šæ—¥å¿—ç³»ç»Ÿå®Œæ•´æ€§
- **å¼€å§‹é˜¶æ®µ**ï¼šæ˜¾ç¤ºæ€»è§ˆä¿¡æ¯ï¼ˆè®¡åˆ’IDã€æ‰§è¡Œè®°å½•æ•°ã€UIè‡ªåŠ¨åŒ–ç”¨ä¾‹æ•°ï¼‰
- **å¤„ç†é˜¶æ®µ**ï¼šæ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†æ—¥å¿—ï¼ˆæ¥æºã€å†³ç­–ã€æ›´æ–°ï¼‰
- **å®Œæˆé˜¶æ®µ**ï¼šç»Ÿè®¡ä¿¡æ¯ï¼ˆå„é˜¶æ®µå¤„ç†çš„ç”¨ä¾‹æ•°ã€æœ€ç»ˆçŠ¶æ€ï¼‰

#### æ”¹è¿›3ï¼šå†³ç­–é€æ˜åŒ–
æ˜ç¡®æ˜¾ç¤ºä¸ºä»€ä¹ˆé€‰æ‹©æŸä¸ªæ•°æ®æºï¼ŒåŒ…æ‹¬ï¼š
- æ˜¯å¦å­˜åœ¨ç°æœ‰æ•°æ®
- æ—¶é—´æˆ³æ¯”è¾ƒç»“æœ
- æœ€ç»ˆå†³ç­–ï¼ˆæ›´æ–° or è·³è¿‡ï¼‰

### 7. é¢„æœŸæ•ˆæœ

1. âœ… **é—®é¢˜è¯Šæ–­æ›´å®¹æ˜“**ï¼šé€šè¿‡è¯¦ç»†æ—¥å¿—å¿«é€Ÿå®šä½é—®é¢˜
2. âœ… **æ•°æ®æµå‘æ¸…æ™°**ï¼šçŸ¥é“æ¯ä¸ªç”¨ä¾‹çš„æ•°æ®æ¥è‡ªå“ªé‡Œ
3. âœ… **æ—¶é—´æˆ³æ¯”è¾ƒæ›´å‡†ç¡®**ï¼šé¿å…ä½¿ç”¨é”™è¯¯çš„æ—¶é—´å¯¼è‡´æ•°æ®ä¸æ›´æ–°
4. âœ… **ç»Ÿè®¡ä¿¡æ¯å®Œæ•´**ï¼šäº†è§£å„é˜¶æ®µå¤„ç†çš„æ•°æ®é‡
5. âœ… **å•ä¸ªæ‰§è¡Œå’Œæ‰¹é‡æ‰§è¡Œéƒ½æ­£ç¡®**ï¼šåŒæ•°æ®æºä¿éšœ

### 8. éªŒè¯æ­¥éª¤

æ‰§è¡Œæµ‹è¯•åï¼Œåœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ“‹ [testPlanService] å¼€å§‹æ„å»ºç”¨ä¾‹æ‰§è¡ŒçŠ¶æ€æ˜ å°„ï¼Œè®¡åˆ’ID: 123
ğŸ“‹ [testPlanService] æ‰§è¡Œè®°å½•æ€»æ•°: 5
ğŸ“Š [testPlanService] å¤„ç†æ‰§è¡Œè®°å½• xxxï¼ŒåŒ…å« 10 ä¸ªç”¨ä¾‹ç»“æœ
âœ… [æ­¥éª¤1] ç”¨ä¾‹ 1 ä»execution_resultsè·å–çŠ¶æ€
ğŸ“Š [æ­¥éª¤1å®Œæˆ] ä»execution_resultsè·å–äº† 10 ä¸ªç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€
ğŸ” [æ­¥éª¤2å¼€å§‹] æŸ¥è¯¢ 5 ä¸ªUIè‡ªåŠ¨åŒ–ç”¨ä¾‹çš„æœ€æ–°æ‰§è¡Œè®°å½•
ğŸ” [æ­¥éª¤2] ç”¨ä¾‹ 1 æŸ¥è¯¢åˆ°æ‰§è¡Œè®°å½•
ğŸ” [æ­¥éª¤2] ç”¨ä¾‹ 1 å†³ç­–: shouldUpdate=true
âœ… [æ­¥éª¤2] ç”¨ä¾‹ 1 æ›´æ–°çŠ¶æ€
ğŸ“Š [æ­¥éª¤2å®Œæˆ] ä»test_case_executionsæ›´æ–°äº† 3 ä¸ªç”¨ä¾‹ï¼Œè·³è¿‡ 2 ä¸ª
âœ… [å®Œæˆ] caseExecutionMap æœ€ç»ˆåŒ…å« 15 ä¸ªç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€
```

---

## å®ç°å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶è‡ªåŠ¨åŒæ­¥ç»“æœåˆ°æµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/pages/TestPlanDetail.tsx` - æ¢å¤å•ä¸ªç”¨ä¾‹æ‰§è¡Œè·³è½¬è¯¦æƒ…é¡µé€»è¾‘ï¼Œä¼ é€’planExecutionId
- `src/services/testService.ts` - runTestCaseæ–¹æ³•å¢åŠ planExecutionIdå‚æ•°
- `server/routes/test.ts` - æ¥æ”¶å¹¶ä¼ é€’planExecutionIdå‚æ•°
- `server/services/testExecution.ts` - æµ‹è¯•å®Œæˆæ—¶è‡ªåŠ¨åŒæ­¥ç»“æœåˆ°test_plan_executionsè¡¨

**é—®é¢˜æè¿°ï¼š**
ç”¨æˆ·å¸Œæœ›å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶è·³è½¬åˆ°æµ‹è¯•æ‰§è¡Œè¯¦æƒ…é¡µæŸ¥çœ‹å®æ—¶è¿›åº¦ï¼ŒåŒæ—¶æ‰§è¡Œå®Œæˆåéœ€è¦è‡ªåŠ¨åŒæ­¥ç»“æœåˆ° `test_plan_executions` è¡¨ã€‚

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. å‰ç«¯ï¼šæ¢å¤è·³è½¬è¯¦æƒ…é¡µé€»è¾‘
å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ï¼š
1. å…ˆåˆ›å»ºæµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•ï¼ˆautoExecute: falseï¼‰
2. è°ƒç”¨runTestCaseæ‰§è¡Œï¼Œä¼ é€’planExecutionId
3. è·³è½¬åˆ°æµ‹è¯•æ‰§è¡Œè¯¦æƒ…é¡µ

```typescript
// åˆ›å»ºæµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•
const planExecution = await testPlanService.startTestPlanExecution({
  plan_id: parseInt(id!),
  autoExecute: false, // ä¸è‡ªåŠ¨æ‰§è¡Œ
});

// æ‰§è¡Œå¹¶ä¼ é€’planExecutionId
const response = await testService.runTestCase(caseId, {
  planExecutionId: planExecution.id, // ç”¨äºå®ŒæˆååŒæ­¥
});

// è·³è½¬åˆ°è¯¦æƒ…é¡µ
navigate(`/test-runs/${response.runId}/detail`, {
  state: { planExecutionId: planExecution.id }
});
```

### 2. æœåŠ¡å±‚ï¼šå¢åŠ planExecutionIdå‚æ•°
`testService.runTestCase` æ¥æ”¶å¹¶ä¼ é€’planExecutionIdåˆ°åç«¯ã€‚

### 3. åç«¯è·¯ç”±ï¼šæ¥æ”¶å¹¶ä¼ é€’planExecutionId
`/cases/execute` è·¯ç”±æ¥æ”¶planExecutionIdå¹¶ä¼ é€’ç»™testExecutionService.runTestã€‚

### 4. æ‰§è¡ŒæœåŠ¡ï¼šæµ‹è¯•å®Œæˆæ—¶è‡ªåŠ¨åŒæ­¥
åœ¨ `testExecutionService.finalizeTestRun` ä¸­ï¼š
1. æ£€æµ‹æ˜¯å¦å­˜åœ¨planExecutionId
2. å­˜åœ¨æ—¶è°ƒç”¨ `syncToTestPlanExecution` æ–¹æ³•
3. åŒæ­¥æ‰§è¡Œç»“æœåˆ° `test_plan_executions` è¡¨

```typescript
// åŒæ­¥åˆ°test_plan_executionsè¡¨
private async syncToTestPlanExecution(runId, testRun, planExecutionId) {
  // æŸ¥è¯¢ç°æœ‰è®°å½•
  const planExecution = await prisma.test_plan_executions.findUnique({
    where: { id: planExecutionId }
  });
  
  // æ„å»ºæ‰§è¡Œç»“æœ
  const caseResult = {
    case_id: testRun.testCaseId,
    result: testRun.failedSteps > 0 ? 'fail' : 'pass',
    duration_ms: durationMs,
    execution_id: runId,
  };
  
  // æ›´æ–°è®°å½•
  await prisma.test_plan_executions.update({
    where: { id: planExecutionId },
    data: {
      status: isAllCompleted ? 'completed' : 'running',
      execution_results: updatedResults,
      passed_cases, failed_cases, blocked_cases,
    }
  });
}
```

**æ•ˆæœï¼š**
1. âœ… å•ä¸ªç”¨ä¾‹æ‰§è¡Œè·³è½¬åˆ°æµ‹è¯•æ‰§è¡Œè¯¦æƒ…é¡µï¼Œå¯æŸ¥çœ‹å®æ—¶è¿›åº¦
2. âœ… æ‰§è¡Œå®Œæˆåè‡ªåŠ¨åŒæ­¥ç»“æœåˆ°test_plan_executionsè¡¨
3. âœ… æ•°æ®ä»test_case_executionsè¡¨è·å–ï¼Œä¿æŒä¸€è‡´æ€§
4. âœ… æ‰§è¡Œå†å²è®°å½•æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰æ‰§è¡Œç»“æœ

---

## ä¿®å¤åç«¯è·¯ç”±æœªæ¥æ”¶ autoExecute å‚æ•°å¯¼è‡´çš„æ‰§è¡Œé‡å¤é—®é¢˜

**é—®é¢˜ï¼š**
å‰ç«¯ä¼ é€’äº† `autoExecute` å’Œ `executionConfig` å‚æ•°ï¼Œä½†åç«¯è·¯ç”±æ²¡æœ‰æ­£ç¡®æ¥æ”¶ï¼Œå¯¼è‡´è¿™äº›å‚æ•°ä¸¢å¤±ï¼Œ`autoExecute` é»˜è®¤ä¸º `true`ï¼Œé€ æˆå•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ä¾ç„¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå‡ºç°é‡å¤ä»»åŠ¡ã€‚

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/types/testPlan.ts` - æ·»åŠ  `autoExecute` å’Œ `executionConfig` ç±»å‹å®šä¹‰
- `src/pages/TestPlanDetail.tsx` - å‰ç«¯ä¼ é€’ `autoExecute` å’Œ `executionConfig` å‚æ•°
- `server/routes/testPlan.ts` - åç«¯è·¯ç”±æ­£ç¡®æ¥æ”¶å‚æ•°
- `server/services/testPlanService.ts` - æ ¹æ® `autoExecute` å‚æ•°å†³å®šæ˜¯å¦è‡ªåŠ¨æ‰§è¡Œ

**ä¿®æ”¹å†…å®¹ï¼š**

### 1. ç±»å‹å®šä¹‰æ›´æ–°
åœ¨ `StartTestPlanExecutionInput` æ¥å£ä¸­æ·»åŠ ï¼š
- `autoExecute?: boolean` - æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œï¼Œé»˜è®¤ trueï¼ˆæ‰¹é‡æ‰§è¡Œæ—¶ï¼‰ï¼Œfalseï¼ˆå•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ï¼‰
- `executionConfig?: ExecutionConfig` - æ‰§è¡Œé…ç½®ï¼ˆç¯å¢ƒã€å¼•æ“ã€traceã€videoç­‰ï¼‰

### 2. å‰ç«¯è°ƒç”¨æ›´æ–°
- å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ï¼šä¼ é€’ `autoExecute: false`ï¼Œé¿å…è‡ªåŠ¨æ‰§è¡Œ
- æ‰¹é‡æ‰§è¡Œæ—¶ï¼šä¼ é€’ `autoExecute: true`ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹
- åŒæ—¶ä¼ é€’ `executionConfig` é…ç½®ï¼ˆç¯å¢ƒã€å¼•æ“ã€traceã€videoç­‰ï¼‰

### 3. åç«¯è·¯ç”±æ›´æ–°
åœ¨ `POST /:id/execute` è·¯ç”±ä¸­ï¼š
- æ­£ç¡®æ¥æ”¶ `req.body.autoExecute` å’Œ `req.body.executionConfig` å‚æ•°
- æ·»åŠ æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•å’Œè¿½è¸ªå‚æ•°ä¼ é€’
- å°†å‚æ•°ä¼ é€’ç»™æœåŠ¡å±‚

### 4. åç«¯æœåŠ¡æ›´æ–°
åœ¨ `startTestPlanExecution` å‡½æ•°ä¸­ï¼š
- æ ¹æ® `autoExecute` å‚æ•°å†³å®šæ˜¯å¦è‡ªåŠ¨æ‰§è¡Œç”¨ä¾‹
- å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ï¼ˆ`autoExecute=false`ï¼‰ï¼šåªåˆ›å»ºæ‰§è¡Œè®°å½•ï¼Œä¸è‡ªåŠ¨æ‰§è¡Œ
- æ‰¹é‡æ‰§è¡Œæ—¶ï¼ˆ`autoExecute=true`ï¼‰ï¼šè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹
- ä½¿ç”¨ `executionConfig` ä¸­çš„é…ç½®ï¼ˆç¯å¢ƒã€å¼•æ“ã€traceã€videoç­‰ï¼‰æ‰§è¡Œç”¨ä¾‹

**æ•ˆæœï¼š**
1. âœ… åç«¯æ­£ç¡®æ¥æ”¶å‰ç«¯ä¼ é€’çš„ `autoExecute` å‚æ•°
2. âœ… å•ä¸ªç”¨ä¾‹æ‰§è¡Œæ—¶ `autoExecute=false` ç”Ÿæ•ˆï¼Œä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œé¿å…é‡å¤ä»»åŠ¡
3. âœ… æ‰¹é‡æ‰§è¡Œæ—¶ `autoExecute=true` ç”Ÿæ•ˆï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹
4. âœ… æ‰§è¡Œé…ç½®ï¼ˆç¯å¢ƒã€å¼•æ“ã€traceã€videoç­‰ï¼‰æ­£ç¡®ä¼ é€’åˆ°åç«¯å¹¶ä½¿ç”¨
5. âœ… å½»åº•è§£å†³é‡å¤ä»»åŠ¡é—®é¢˜

---

## ä¸ºæ‰§è¡ŒçŠ¶æ€æ·»åŠ èƒŒæ™¯è‰²æ˜¾ç¤º

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/components/TestPlanExecutionLogModal.tsx` - getExecutionStatusTextå‡½æ•°è¿”å›å¸¦èƒŒæ™¯è‰²çš„Tagç»„ä»¶

**ä¿®æ”¹å†…å®¹ï¼š**
ä¿®æ”¹`getExecutionStatusText`å‡½æ•°ï¼Œå°†è¿”å›çš„æ–‡æœ¬æ”¹ä¸ºå¸¦èƒŒæ™¯è‰²çš„Tagç»„ä»¶ï¼Œæ ¹æ®ä¸åŒçš„æ‰§è¡ŒçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„é¢œè‰²ï¼š
- running: è“è‰²ï¼ˆprocessingï¼‰- æ‰§è¡Œä¸­
- completed: ç»¿è‰²ï¼ˆsuccessï¼‰- å·²å®Œæˆ
- failed: çº¢è‰²ï¼ˆerrorï¼‰- å·²å¤±è´¥
- cancelled: ç°è‰²ï¼ˆdefaultï¼‰- å·²å–æ¶ˆ
- error: çº¢è‰²ï¼ˆerrorï¼‰- æ‰§è¡Œé”™è¯¯
- queued: æ©™è‰²ï¼ˆwarningï¼‰- æ’é˜Ÿä¸­
- æœªæ‰§è¡Œ: ç°è‰²ï¼ˆdefaultï¼‰

åŒæ—¶æ›´æ–°è¡¨æ ¼åˆ—æ¸²æŸ“é€»è¾‘ï¼Œç›´æ¥è¿”å›Tagç»„ä»¶è€Œä¸éœ€è¦é¢å¤–çš„spanåŒ…è£…ã€‚

**æ•ˆæœï¼š**
1. âœ… æ‰§è¡ŒçŠ¶æ€åˆ—æ˜¾ç¤ºå¸¦èƒŒæ™¯è‰²çš„æ ‡ç­¾ï¼Œè§†è§‰æ•ˆæœæ›´æ¸…æ™°
2. âœ… ä¸åŒçŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²ï¼Œä¾¿äºå¿«é€Ÿè¯†åˆ«
3. âœ… ä¸æ‰§è¡Œç»“æœåˆ—çš„Tagæ ·å¼ä¿æŒä¸€è‡´

---

## ä¿®å¤ï¼šlast_execution.statusåº”ä»execution_resultsä¸­è·å–

**é—®é¢˜ï¼š**
`last_execution.status` å­—æ®µå½“å‰ä»æ•´ä¸ªæµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•çš„ `status` è·å–ï¼Œè€Œä¸æ˜¯ä» `execution_results` ä¸­æ¯ä¸ªç”¨ä¾‹çš„ `execution_status` è·å–ï¼Œå¯¼è‡´æ‰€æœ‰ç”¨ä¾‹æ˜¾ç¤ºç›¸åŒçš„æ‰§è¡ŒçŠ¶æ€ã€‚

**ä¿®å¤ï¼š**
ä¿®æ”¹ `server/services/testPlanService.ts` ä¸­æ­¥éª¤1çš„é€»è¾‘ï¼š
1. ä¼˜å…ˆä» `result.execution_status` è·å–æ¯ä¸ªç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€
2. å¦‚æœ `execution_status` ä¸å­˜åœ¨ï¼Œå†å›é€€åˆ°æ•´ä¸ªæ‰§è¡Œè®°å½•çš„ `status`
3. ç¡®ä¿æ¯ä¸ªç”¨ä¾‹æ˜¾ç¤ºå…¶çœŸå®çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆrunning/completed/failedç­‰ï¼‰

**æ•ˆæœï¼š**
1. âœ… æ¯ä¸ªç”¨ä¾‹çš„ `last_execution.status` æ­£ç¡®åæ˜ å…¶å®é™…æ‰§è¡ŒçŠ¶æ€
2. âœ… æ”¯æŒæ‰¹é‡æ‰§è¡Œæ—¶ä¸åŒç”¨ä¾‹å¯èƒ½æœ‰ä¸åŒçŠ¶æ€çš„æƒ…å†µ
3. âœ… ä¿æŒå‘åå…¼å®¹ï¼Œå¦‚æœexecution_statusä¸å­˜åœ¨åˆ™ä½¿ç”¨æ‰§è¡Œè®°å½•çš„çŠ¶æ€

---

## feat: æ·»åŠ æµ‹è¯•è®¡åˆ’æ‰§è¡Œä¸­é€”é€€å‡ºç¡®è®¤åŠŸèƒ½

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**åŠŸèƒ½æè¿°ï¼š**
æ‰¹é‡æ‰§è¡Œå’Œæ‰§è¡Œæ‰€æœ‰åŠŸèƒ½ç”¨ä¾‹æ—¶ï¼Œå¦‚æœä¸­é€”ç‚¹å‡»è¿”å›åˆ—è¡¨ã€å…³é—­æˆ–é€€å‡ºé¡µé¢ï¼Œç»™å‡ºå¼¹çª—æç¤ºå¹¶æ›´æ–°æ‰§è¡ŒçŠ¶æ€ã€‚

**ä¸»è¦ä¿®æ”¹ï¼š**
1. æ·»åŠ  `popstate` äº‹ä»¶ç›‘å¬é˜»æ­¢æµè§ˆå™¨åé€€æŒ‰é’®ï¼ˆå…¼å®¹ä¼ ç»Ÿ BrowserRouterï¼‰
2. æ·»åŠ  `beforeunload` äº‹ä»¶ç›‘å¬é˜»æ­¢é¡µé¢å…³é—­/åˆ·æ–°
3. æ·»åŠ é€€å‡ºç¡®è®¤å¼¹çª—ç»„ä»¶ï¼Œæ˜¾ç¤ºå½“å‰æ‰§è¡Œè¿›åº¦ï¼ˆæ€»ç”¨ä¾‹ã€å·²å®Œæˆã€é€šè¿‡ã€å¤±è´¥ç­‰ï¼‰
4. ä¿®æ”¹è¿”å›æŒ‰é’®å’Œå–æ¶ˆæŒ‰é’®ä½¿ç”¨ç»Ÿä¸€çš„ç¡®è®¤é€»è¾‘
5. ç¡®è®¤é€€å‡ºæ—¶æ›´æ–°æ‰§è¡ŒçŠ¶æ€ä¸º `cancelled`ï¼Œä¿å­˜å·²å®Œæˆçš„æ‰§è¡Œç»“æœ

**æ•ˆæœï¼š**
1. âœ… ç‚¹å‡»è¿”å›æŒ‰é’®æ—¶å¼¹å‡ºç¡®è®¤å¼¹çª—
2. âœ… ç‚¹å‡»å–æ¶ˆæŒ‰é’®æ—¶å¼¹å‡ºç¡®è®¤å¼¹çª—
3. âœ… ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®æ—¶å¼¹å‡ºç¡®è®¤å¼¹çª—
4. âœ… å…³é—­/åˆ·æ–°é¡µé¢æ—¶æµè§ˆå™¨æ˜¾ç¤ºç¦»å¼€ç¡®è®¤
5. âœ… ç¡®è®¤é€€å‡ºåæ‰§è¡ŒçŠ¶æ€æ›´æ–°ä¸ºå·²å–æ¶ˆï¼Œå·²æäº¤çš„ç»“æœä¿ç•™

---

## feat: æ·»åŠ æµ‹è¯•è®¡åˆ’ç»§ç»­æ‰§è¡ŒåŠŸèƒ½

**ä¿®æ”¹æ–‡ä»¶ï¼š** 
- `src/pages/TestPlanDetail.tsx`
- `src/pages/TestPlanExecute.tsx`

**åŠŸèƒ½æè¿°ï¼š**
å¯¹äºä¸­é€”é€€å‡ºæˆ–å–æ¶ˆçš„æµ‹è¯•è®¡åˆ’æ‰§è¡Œï¼Œå¯ä»¥åœ¨æ‰§è¡Œå†å²ä¸­ç‚¹å‡»"ç»§ç»­"æŒ‰é’®ç»§ç»­æ‰§è¡Œæœªå®Œæˆçš„ç”¨ä¾‹ã€‚

**TestPlanDetail.tsx ä¿®æ”¹ï¼š**
1. å¯¼å…¥ `RotateCcw` å›¾æ ‡
2. æ·»åŠ  `handleContinueExecution` å‡½æ•°å¤„ç†ç»§ç»­æ‰§è¡Œé€»è¾‘
3. åœ¨æ‰€æœ‰è§†å›¾æ¨¡å¼ï¼ˆè¡¨æ ¼ã€ç´§å‡‘ã€æ—¶é—´è½´ã€å¡ç‰‡ï¼‰çš„æ“ä½œåˆ—æ·»åŠ "ç»§ç»­"æŒ‰é’®
4. ä»…å¯¹å·²å–æ¶ˆæˆ–æœªå®Œæˆçš„æ‰§è¡Œæ˜¾ç¤ºç»§ç»­æŒ‰é’®
5. ç»§ç»­æ‰§è¡Œæ—¶ä¼ é€’ `continueFrom` å‚æ•°æ ‡è¯†æ¢å¤çš„æ‰§è¡Œè®°å½•

**TestPlanExecute.tsx ä¿®æ”¹ï¼š**
1. è§£æ `continueFrom` URL å‚æ•°
2. ç»§ç»­æ‰§è¡Œæ¨¡å¼ä¸‹å¤ç”¨ä¹‹å‰çš„æ‰§è¡Œè®°å½•ID
3. è·å–ä¹‹å‰æ‰§è¡Œè¯¦æƒ…å¹¶æ¢å¤å·²å®Œæˆç”¨ä¾‹çš„çŠ¶æ€
4. æ›´æ–°æ‰§è¡ŒçŠ¶æ€ä» `cancelled` æ”¹ä¸º `running`

**æ•ˆæœï¼š**
1. âœ… å·²å–æ¶ˆçš„æ‰§è¡Œè®°å½•æ˜¾ç¤º"ç»§ç»­"æŒ‰é’®
2. âœ… ç‚¹å‡»ç»§ç»­åè·³è½¬åˆ°æ‰§è¡Œé¡µé¢ï¼Œåªæ˜¾ç¤ºæœªå®Œæˆçš„ç”¨ä¾‹
3. âœ… ä¹‹å‰å·²å®Œæˆçš„ç”¨ä¾‹çŠ¶æ€è¢«æ¢å¤
4. âœ… å¤ç”¨åŒä¸€ä¸ªæ‰§è¡Œè®°å½•ï¼Œç»Ÿè®¡æ•°æ®ç´¯åŠ 

---

## 2025-12-26 æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢ç¦»å¼€ç¡®è®¤å’Œè‡ªåŠ¨æ¸…ç†è¶…æ—¶æ‰§è¡Œè®°å½•

**ä¿®æ”¹æ–‡ä»¶ï¼š** 
- `src/pages/TestPlanDetail.tsx`
- `server/services/testPlanService.ts`

**é—®é¢˜ï¼š**
1. å…³é—­/åˆ·æ–°é¡µé¢æ—¶æ²¡æœ‰ç¦»å¼€ç¡®è®¤ï¼Œå¯¼è‡´ç”Ÿæˆæ’é˜Ÿä¸­çŠ¶æ€çš„æ‰§è¡Œè®°å½•
2. ç‚¹å‡»è¿”å›åˆ—è¡¨æŒ‰é’®æ—¶æ²¡æœ‰ç¦»å¼€ç¡®è®¤
3. é¡µé¢åˆ·æ–°åé—ç•™çš„ queued æ‰§è¡Œè®°å½•æ— æ³•è‡ªåŠ¨æ¸…ç†

**ä¿®å¤å†…å®¹ï¼š**

å‰ç«¯ (`TestPlanDetail.tsx`)ï¼š
1. æ·»åŠ  `isExecutingLocally` æœ¬åœ°çŠ¶æ€è·Ÿè¸ªæ­£åœ¨æ‰§è¡Œçš„æ“ä½œ
2. æ·»åŠ  `isExecutingRef` ä½¿ç”¨ useRef ç«‹å³è·Ÿè¸ªæ‰§è¡ŒçŠ¶æ€
3. æ·»åŠ  `pendingExecutionIdRef` è·Ÿè¸ªæ­£åœ¨åˆ›å»ºçš„æ‰§è¡Œè®°å½•ID
4. `beforeunload` äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ `navigator.sendBeacon` å‘é€å–æ¶ˆè¯·æ±‚
5. æ–°å¢ `handleBackToList` å‡½æ•°ï¼Œåœ¨æœ‰æ´»è·ƒæ‰§è¡Œæ—¶å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†

åç«¯ (`testPlanService.ts`)ï¼š
1. åœ¨ `getTestPlanDetail` ä¸­æ·»åŠ è‡ªåŠ¨æ¸…ç†é€»è¾‘
2. è¶…è¿‡ 2 åˆ†é’Ÿçš„ queued æ‰§è¡Œè®°å½•è‡ªåŠ¨æ ‡è®°ä¸º cancelled
3. æ·»åŠ é”™è¯¯æ¶ˆæ¯è¯´æ˜æ‰§è¡Œè¢«å–æ¶ˆçš„åŸå› 

**æ•ˆæœï¼š**
1. âœ… é¡µé¢å…³é—­/åˆ·æ–°æ—¶å°è¯•å–æ¶ˆæœªå®Œæˆçš„æ‰§è¡Œè®°å½•
2. âœ… æ¯æ¬¡åŠ è½½é¡µé¢è‡ªåŠ¨æ¸…ç†è¶…æ—¶çš„ queued æ‰§è¡Œè®°å½•
3. âœ… é˜²æ­¢é¡µé¢åˆ·æ–°å¯¼è‡´çš„å¼‚å¸¸æ‰§è¡Œè®°å½•å †ç§¯

---

## 2024-12-26

### fix: ç»§ç»­æ‰§è¡Œæ¨¡å¼ä¸‹è¿”å›æŒ‰é’®æ·»åŠ ç¦»å¼€ç¡®è®¤

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
åœ¨æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µç‚¹å‡»"ç»§ç»­æ‰§è¡Œæœªå®Œæˆçš„ç”¨ä¾‹"åè¿›å…¥æ‰§è¡Œé¡µé¢ï¼Œéƒ¨åˆ†è¿”å›æŒ‰é’®ç›´æ¥ä½¿ç”¨ `navigate()` è·³è½¬ï¼Œæ²¡æœ‰è°ƒç”¨ `handleBackClick()` è¿›è¡Œç¦»å¼€ç¡®è®¤ã€‚

**ä¿®å¤å†…å®¹ï¼š**
1. å°†åŠ è½½ä¸­è§†å›¾çš„è¿”å›æŒ‰é’® `onClick={() => navigate(...)}` æ”¹ä¸º `onClick={handleBackClick}`
2. å°†"æ²¡æœ‰æ‰¾åˆ°è¦æ‰§è¡Œçš„ç”¨ä¾‹"è§†å›¾çš„è¿”å›æŒ‰é’®ä¹Ÿæ”¹ä¸ºä½¿ç”¨ `handleBackClick`
3. ä¿®æ”¹ `hasUnfinishedExecution` åˆ¤æ–­é€»è¾‘ï¼Œåœ¨ `continueFromExecutionId` å­˜åœ¨æ—¶ç›´æ¥è¿”å› `true`

**æ•ˆæœï¼š**
âœ… æ‰€æœ‰è¿”å›æŒ‰é’®éƒ½ä¼šåœ¨æœ‰æœªå®Œæˆæ‰§è¡Œæ—¶å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
âœ… ç»§ç»­æ‰§è¡Œæ¨¡å¼ä¸‹é¡µé¢åŠ è½½æœŸé—´ç‚¹å‡»è¿”å›ä¹Ÿä¼šå¼¹å‡ºç¡®è®¤

---

### fix: ä»æ‰§è¡Œå†å²tabç»§ç»­æ‰§è¡Œåè¿”å›åº”ä¿æŒåœ¨æ‰§è¡Œå†å²tab

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/pages/TestPlanDetail.tsx`
- `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
ä»æ‰§è¡Œå†å²tabé¡µç‚¹å‡»"ç»§ç»­æ‰§è¡Œ"è¿›å…¥æ‰§è¡Œé¡µé¢ï¼Œç‚¹å‡»"è¿”å›æµ‹è¯•è®¡åˆ’"åï¼Œè¿”å›çš„æ˜¯ç”¨ä¾‹tabé¡µï¼ˆé»˜è®¤ï¼‰ï¼Œè€Œä¸æ˜¯æ‰§è¡Œå†å²tabé¡µã€‚

**ä¿®å¤å†…å®¹ï¼š**

1. **TestPlanDetail.tsxï¼š** 
   - åœ¨ `handleContinueExecution` å‡½æ•°çš„å¯¼èˆªURLä¸­æ·»åŠ  `fromTab=executions` å‚æ•°

2. **TestPlanExecute.tsxï¼š**
   - è¯»å– `fromTab` URLå‚æ•°ï¼ˆ`cases` | `executions`ï¼‰
   - æ·»åŠ  `navigateBackToPlan` è¾…åŠ©å‡½æ•°ï¼Œè¿”å›æ—¶æºå¸¦ `{ state: { activeTab: fromTab } }`
   - å°†æ‰€æœ‰è¿”å›æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µçš„ `navigate()` è°ƒç”¨æ›¿æ¢ä¸º `navigateBackToPlan()`

**æ•ˆæœï¼š**
âœ… ä»æ‰§è¡Œå†å²tabç»§ç»­æ‰§è¡Œåè¿”å›ï¼Œè‡ªåŠ¨åˆ‡æ¢å›æ‰§è¡Œå†å²tab
âœ… ä»ç”¨ä¾‹tabæ‰§è¡Œåè¿”å›ï¼Œä¿æŒåœ¨ç”¨ä¾‹tabï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
âœ… æ‰€æœ‰è¿”å›è·¯å¾„ï¼ˆè¿”å›æŒ‰é’®ã€å®Œæˆæ‰§è¡Œã€å–æ¶ˆæ‰§è¡Œç­‰ï¼‰éƒ½æ”¯æŒtabçŠ¶æ€æ¢å¤

---

## fix: ä¿®å¤åŠŸèƒ½ç”¨ä¾‹æ‰¹é‡æ‰§è¡Œè·³è¿‡æ—¶æ‰§è¡Œç»“æœæ•°æ®ä¸å®Œæ•´çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
åŠŸèƒ½ç”¨ä¾‹æ‰¹é‡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ç”¨ä¾‹é€šè¿‡åŒæ—¶ä¹Ÿæœ‰ç”¨ä¾‹è¢«è·³è¿‡ï¼Œæœ€ç»ˆæäº¤æ‰€æœ‰ç»“æœæ—¶æ•°æ®ä¸å®Œæ•´ã€‚è·³è¿‡æ“ä½œæ—¶åªä¿å­˜äº†åŸºæœ¬å­—æ®µï¼Œç¼ºå°‘ `execution_id`ã€`duration_ms`ã€`actualResult`ã€`totalSteps` ç­‰è¯¦ç»†ä¿¡æ¯ã€‚

**ä¿®å¤å†…å®¹ï¼š**

### 1. é‡æ„ `handleSkipCurrentCase` ä¸­ `executionResults` æ„å»ºé€»è¾‘
- ä½¿ç”¨ä¸ `handleSaveCurrentCase` ç›¸åŒçš„é€»è¾‘ç»“æ„
- ä» `state.executionDetails` ä¸­è¯»å–ä¹‹å‰å·²æ‰§è¡Œç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯
- åœ¨æ‰§è¡Œè¿›åº¦æ›´æ–°ä¸­æ·»åŠ å®Œæ•´çš„ç»Ÿè®¡å­—æ®µ

### 2. ä¸ºè·³è¿‡çš„ç”¨ä¾‹æ·»åŠ æ—¶é—´å­—æ®µ
- åœ¨ `CaseExecutionState.executionDetails` æ¥å£ä¸­æ·»åŠ  `started_at` å’Œ `finished_at` å­—æ®µ
- è·³è¿‡çš„ç”¨ä¾‹è®°å½•å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ï¼ˆç›¸åŒï¼‰å’Œè€—æ—¶ï¼ˆ0ï¼‰
- æ‰§è¡Œçš„ç”¨ä¾‹æ ¹æ® `executionTime` è®¡ç®—å¹¶ä¿å­˜å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´

### 3. ç»Ÿä¸€æ‰€æœ‰åˆ†æ”¯çš„æ—¶é—´å­—æ®µå¤„ç†
- å½“å‰æäº¤çš„ç”¨ä¾‹ï¼šè®¡ç®— `startedAt` å’Œ `finishedAt`
- ä¹‹å‰æ‰§è¡Œçš„ç”¨ä¾‹ï¼šä» `state.executionDetails` è¯»å–æ—¶é—´å­—æ®µ
- è·³è¿‡çš„ç”¨ä¾‹ï¼šå¼€å§‹æ—¶é—´=ç»“æŸæ—¶é—´=å½“å‰æ—¶é—´ï¼Œè€—æ—¶=0

**æ•ˆæœï¼š**
âœ… è·³è¿‡ç”¨ä¾‹åï¼Œä¹‹å‰å·²æ‰§è¡Œç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯æ­£ç¡®ä¿ç•™
âœ… æ‰§è¡Œå†å²ä¸­æ˜¾ç¤ºå®Œæ•´çš„æ‰§è¡Œç»“æœæ•°æ®ï¼ˆåŒ…å«å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€è€—æ—¶ï¼‰
âœ… è·³è¿‡çš„ç”¨ä¾‹ä¹Ÿè®°å½•æ—¶é—´ä¿¡æ¯
âœ… ç»Ÿè®¡æ•°æ®æ­£ç¡®è®¡ç®—

---

## fix: ä¿®å¤æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ—¶é—´è®°å½•ä¸å‡†ç¡®çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
1. æµ‹è¯•ç”¨ä¾‹çš„å¼€å§‹æ—¶é—´æ˜¯é€šè¿‡ç»“æŸæ—¶é—´å‡å»è€—æ—¶è®¡ç®—å‡ºæ¥çš„ï¼Œä¸æ˜¯çœŸå®çš„å¼€å§‹æ—¶é—´
2. è·³è¿‡çš„æµ‹è¯•ç”¨ä¾‹å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´éƒ½è®¾ç½®ä¸ºåŒä¸€æ—¶é—´ï¼Œè€—æ—¶ä¸º0ï¼Œä¸ç¬¦åˆå®é™…æƒ…å†µ
3. ç”¨æˆ·åœ¨é¡µé¢åœç•™çš„æ—¶é—´æ²¡æœ‰è¢«æ­£ç¡®è®°å½•

**ä¿®å¤å†…å®¹ï¼š**

### 1. æ·»åŠ  `caseStartTimeRef` è·Ÿè¸ªå½“å‰ç”¨ä¾‹å¼€å§‹æ—¶é—´
```typescript
const caseStartTimeRef = useRef<string>('');
```

### 2. åœ¨ `loadCaseDetails` å‡½æ•°ä¸­è®°å½•å¼€å§‹æ—¶é—´
æ¯æ¬¡åŠ è½½ç”¨ä¾‹è¯¦æƒ…æ—¶ï¼ˆåŒ…æ‹¬é¦–æ¬¡è¿›å…¥å’Œåˆ‡æ¢ç”¨ä¾‹ï¼‰ï¼Œè®°å½•å½“å‰æ—¶é—´ä½œä¸ºå¼€å§‹æ—¶é—´ï¼š
```typescript
// ğŸ”¥ è®°å½•å½“å‰ç”¨ä¾‹çš„å¼€å§‹æ—¶é—´
caseStartTimeRef.current = new Date().toISOString();
```

### 3. ä¿®æ”¹ `handleSaveCurrentCase` ä½¿ç”¨çœŸå®æ—¶é—´
- ä½¿ç”¨ `caseStartTimeRef.current` ä½œä¸ºçœŸå®çš„å¼€å§‹æ—¶é—´
- ç»“æŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´
- è€—æ—¶ = ç»“æŸæ—¶é—´ - å¼€å§‹æ—¶é—´ï¼ˆçœŸå®çš„é¡µé¢åœç•™æ—¶é—´ï¼‰

```typescript
const finishedAt = new Date();
const startedAt = caseStartTimeRef.current 
  ? new Date(caseStartTimeRef.current) 
  : new Date(finishedAt.getTime() - result.executionTime * 1000);
const actualDurationMs = finishedAt.getTime() - startedAt.getTime();
```

### 4. ä¿®æ”¹ `handleSkipCurrentCase` ä½¿ç”¨çœŸå®æ—¶é—´
- ä½¿ç”¨ `caseStartTimeRef.current` ä½œä¸ºå¼€å§‹æ—¶é—´
- ç»“æŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´ï¼ˆç‚¹å‡»è·³è¿‡çš„æ—¶é—´ï¼‰
- è€—æ—¶ = ç»“æŸæ—¶é—´ - å¼€å§‹æ—¶é—´ï¼ˆç”¨æˆ·åœ¨è¯¥ç”¨ä¾‹é¡µé¢åœç•™çš„å®é™…æ—¶é—´ï¼‰

```typescript
const finishedAt = new Date();
const startedAt = caseStartTimeRef.current 
  ? new Date(caseStartTimeRef.current) 
  : finishedAt;
const actualDurationMs = finishedAt.getTime() - startedAt.getTime();
```

**æ•ˆæœï¼š**
âœ… æµ‹è¯•ç”¨ä¾‹çš„å¼€å§‹æ—¶é—´æ˜¯çœŸå®è¿›å…¥é¡µé¢çš„æ—¶é—´
âœ… ç»“æŸæ—¶é—´æ˜¯çœŸå®æäº¤æˆ–è·³è¿‡çš„æ—¶é—´
âœ… è€—æ—¶åæ˜ ç”¨æˆ·åœ¨è¯¥ç”¨ä¾‹é¡µé¢çš„å®é™…åœç•™æ—¶é—´
âœ… è·³è¿‡çš„ç”¨ä¾‹ä¹Ÿè®°å½•çœŸå®çš„å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´å’Œè€—æ—¶
âœ… æ‰§è¡Œå†å²ä¸­çš„æ—¶é—´æ•°æ®æ›´åŠ å‡†ç¡®å’Œæœ‰æ„ä¹‰

---

## fix: ä¿®å¤æµ‹è¯•è®¡åˆ’æ‰§è¡Œæ€»è€—æ—¶è®¡ç®—é”™è¯¯çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
æµ‹è¯•è®¡åˆ’æ‰§è¡Œå®Œæˆåï¼Œ`duration_ms` å­—æ®µä½¿ç”¨ `seconds * 1000`ï¼ˆè®¡æ—¶å™¨ç§’æ•°ï¼‰è®¡ç®—ï¼Œè€Œä¸æ˜¯æ¯æ¡ç”¨ä¾‹çš„å®é™…è€—æ—¶æ€»å’Œã€‚
- ä¾‹å¦‚ï¼šç”¨ä¾‹1è€—æ—¶ 5191msï¼Œç”¨ä¾‹2è€—æ—¶ 6455ms
- æœŸæœ›æ€»è€—æ—¶ï¼š5191 + 6455 = 11646ms
- å®é™…æ˜¾ç¤ºï¼š11000msï¼ˆè®¡æ—¶å™¨ç§’æ•° Ã— 1000ï¼‰

**ä¿®å¤å†…å®¹ï¼š**

### 1. ä¿®æ”¹ `handleConfirmExit` ä¸­çš„æ€»è€—æ—¶è®¡ç®—
ä½¿ç”¨ `executionResults.reduce()` ç´¯åŠ æ¯æ¡ç”¨ä¾‹çš„ `duration_ms`ã€‚

### 2. ä¿®æ”¹ `executeUIAutoCases` å®Œæˆæ—¶çš„æ€»è€—æ—¶è®¡ç®—
ä½¿ç”¨ `caseStates` ä¸­æ‰€æœ‰å·²å®Œæˆç”¨ä¾‹çš„ `duration_ms` æ€»å’Œï¼Œå¦‚æœæ²¡æœ‰è¯¦ç»†è€—æ—¶åˆ™å›é€€åˆ°è®¡æ—¶å™¨å€¼ã€‚

### 3. ä¿®æ”¹ `executeUIAutoCases` å¤±è´¥æ—¶çš„æ€»è€—æ—¶è®¡ç®—
åŒä¸Šï¼Œä½¿ç”¨ç´¯åŠ çš„æ€»è€—æ—¶æˆ–å›é€€åˆ°è®¡æ—¶å™¨å€¼ã€‚

### 4. ä¿®æ”¹ `handleSaveCurrentCase` ä¸­æ‰€æœ‰ç”¨ä¾‹å®Œæˆæ—¶çš„æ€»è€—æ—¶è®¡ç®—
ä½¿ç”¨ `executionResults.reduce()` ç´¯åŠ æ¯æ¡ç”¨ä¾‹çš„ `duration_ms`ã€‚

### 5. ä¿®æ”¹ `handleSkipCurrentCase` ä¸­æœ€åä¸€ä¸ªç”¨ä¾‹å®Œæˆæ—¶çš„æ€»è€—æ—¶è®¡ç®—
ä½¿ç”¨ `executionResults.reduce()` ç´¯åŠ æ¯æ¡ç”¨ä¾‹çš„ `duration_ms`ã€‚

**æ•ˆæœï¼š**
âœ… æµ‹è¯•è®¡åˆ’æ‰§è¡Œæ€»è€—æ—¶ = æ‰€æœ‰ç”¨ä¾‹è€—æ—¶ä¹‹å’Œ
âœ… è€—æ—¶è®¡ç®—æ›´åŠ ç²¾ç¡®ï¼Œä¸å†å—è®¡æ—¶å™¨ç§’æ•°é™åˆ¶
âœ… UIè‡ªåŠ¨åŒ–ç”¨ä¾‹ä¿æŒå…¼å®¹ï¼Œæ— è¯¦ç»†è€—æ—¶æ—¶ä½¿ç”¨è®¡æ—¶å™¨å€¼

---

## fix: ä¿®å¤æ‰§è¡Œè¯¦æƒ…æŸ¥è¯¢æ—¶è¦†ç›–åŸå§‹æ—¶é—´å’Œè€—æ—¶æ•°æ®çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** `server/services/testPlanService.ts`

**é—®é¢˜æè¿°ï¼š**
åœ¨ `getTestPlanExecutionDetail` å‡½æ•°ä¸­ï¼Œå½“ä» `functional_test_executions` è¡¨è·å–æ‰§è¡Œè®°å½•æ—¶ï¼Œæ•°æ®åº“ä¸­çš„å€¼ä¼šè¦†ç›–åŸå§‹å­˜å‚¨åœ¨ `execution_results` ä¸­çš„æ—¶é—´å’Œè€—æ—¶æ•°æ®ã€‚

ç”±äº `functional_test_executions` è¡¨çš„æ—¶é—´æˆ³ç²¾åº¦åªåˆ°ç§’çº§ï¼ˆ.000Zï¼‰ï¼Œè€Œå‰ç«¯æäº¤çš„ `execution_results` æ˜¯æ¯«ç§’çº§ç²¾åº¦ï¼Œå¯¼è‡´æŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸¢å¤±ç²¾åº¦ã€‚

**å¯¹æ¯”ç¤ºä¾‹ï¼š**
| å­—æ®µ | å­˜å‚¨å€¼ï¼ˆæ¯«ç§’çº§ï¼‰ | æŸ¥è¯¢è¿”å›å€¼ï¼ˆç§’çº§ï¼‰ |
|------|------------------|-------------------|
| started_at | 2025-12-27T02:50:11.714Z | 2025-12-27T02:50:21.000Z |
| duration_ms | 9967 | 9000 |
| finished_at | 2025-12-27T02:50:21.681Z | 2025-12-27T02:50:30.000Z |

**ä¿®å¤å†…å®¹ï¼š**
ä¿®æ”¹ `getTestPlanExecutionDetail` ä¸­çš„æ•°æ®åˆå¹¶é€»è¾‘ï¼Œä¼˜å…ˆä¿ç•™åŸå§‹ `result` ä¸­çš„å€¼ï¼Œåªåœ¨ç¼ºå¤±æ—¶æ‰ä½¿ç”¨æ•°æ®åº“å€¼ï¼š

```typescript
// ä¿®å¤å‰ï¼šç›´æ¥è¦†ç›–
started_at: executionRecord.executed_at.toISOString(),
duration_ms: executionRecord.duration_ms || undefined,

// ä¿®å¤åï¼šä¼˜å…ˆä¿ç•™åŸå§‹å€¼
started_at: result.started_at || executionRecord.executed_at.toISOString(),
duration_ms: result.duration_ms ?? executionRecord.duration_ms ?? undefined,
```

**æ•ˆæœï¼š**
âœ… æŸ¥è¯¢è¿”å›çš„æ—¶é—´å’Œè€—æ—¶æ•°æ®ä¿æŒæ¯«ç§’çº§ç²¾åº¦
âœ… ä¸å­˜å‚¨çš„åŸå§‹æ•°æ®ä¸€è‡´
âœ… åªåœ¨åŸå§‹æ•°æ®ç¼ºå¤±æ—¶æ‰ä½¿ç”¨æ•°æ®åº“å€¼ä½œä¸ºå›é€€

---

## perf: ä¼˜åŒ–WebSocket/è½®è¯¢åˆ·æ–°å¯¼è‡´çš„é¡µé¢é—ªçƒé—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** 
- `src/components/TestPlanExecutionLogModal.tsx`
- `src/pages/TestPlanDetail.tsx`

**é—®é¢˜æè¿°ï¼š**
WebSocket ç›‘å¬å’Œè½®è¯¢æœºåˆ¶åœ¨åˆ·æ–°æ•°æ®æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šè®¾ç½® `setLoading(true)`ï¼Œå¯¼è‡´ï¼š
1. å¼¹çª—å†…å®¹è¢« Spin ç»„ä»¶æ›¿æ¢ï¼Œé€ æˆå¼¹çª—é—ªçƒ
2. çˆ¶ç»„ä»¶ TestPlanDetail é‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´æ•´ä¸ªé¡µé¢é—ªçƒï¼ˆåŒ…æ‹¬ Modalï¼‰

**ä¿®å¤å†…å®¹ï¼š**

### TestPlanExecutionLogModal.tsx

#### 1. åŒºåˆ†é¦–æ¬¡åŠ è½½å’Œåˆ·æ–°æ›´æ–°
- æ·»åŠ  `isRefreshing` çŠ¶æ€ç”¨äºè½»é‡åˆ·æ–°æŒ‡ç¤ºå™¨
- æ·»åŠ  `hasLoadedRef` ç”¨äºæ ‡è®°æ˜¯å¦å·²å®Œæˆé¦–æ¬¡åŠ è½½
- é¦–æ¬¡åŠ è½½æ—¶æ˜¾ç¤ºå…¨å± Spinï¼Œåˆ·æ–°æ—¶åªæ˜¾ç¤ºå°å›¾æ ‡

#### 2. é™é»˜åˆ·æ–°æ¨¡å¼
- `loadExecutionDetail` å‡½æ•°æ·»åŠ  `isSilentRefresh` å‚æ•°
- WebSocket å’Œè½®è¯¢è°ƒç”¨æ—¶ä¼ é€’ `true`ï¼Œä¸è§¦å‘å…¨å±åŠ è½½
- é¦–æ¬¡åŠ è½½ä¼ é€’ `false`ï¼Œæ˜¾ç¤ºå…¨å± Spin

#### 3. æ·»åŠ å±€éƒ¨åˆ·æ–°æŒ‡ç¤ºå™¨
- åœ¨æ ‡é¢˜æ æ·»åŠ  RefreshCw æ—‹è½¬å›¾æ ‡
- æ·»åŠ "æ‰§è¡Œä¸­"çŠ¶æ€å¾½ç« ï¼ˆå¸¦åŠ¨ç”»è„‰å†²ç‚¹ï¼‰
- åˆ·æ–°æ—¶åªæ˜¾ç¤ºå›¾æ ‡åŠ¨ç”»ï¼Œä¸å½±å“è¡¨æ ¼å†…å®¹

#### 4. æ•°æ®å¯¹æ¯”ä¼˜åŒ–
- åˆ·æ–°æ—¶æ¯”è¾ƒå…³é”®å­—æ®µï¼ˆstatusã€completed_casesã€passed_casesç­‰ï¼‰
- å¦‚æœæ•°æ®æ— å˜åŒ–åˆ™è·³è¿‡çŠ¶æ€æ›´æ–°ï¼Œå‡å°‘ä¸å¿…è¦çš„ re-render

### TestPlanDetail.tsx

#### 1. æ·»åŠ é™é»˜åˆ·æ–°æ”¯æŒ
- æ·»åŠ  `isRefreshing` çŠ¶æ€ç”¨äºè½»é‡åˆ·æ–°æŒ‡ç¤ºå™¨
- æ·»åŠ  `hasLoadedRef` ç”¨äºæ ‡è®°æ˜¯å¦å·²å®Œæˆé¦–æ¬¡åŠ è½½
- `loadTestPlanDetail` å‡½æ•°æ·»åŠ  `isSilentRefresh` å‚æ•°

#### 2. WebSocket/è½®è¯¢è°ƒç”¨ä¼˜åŒ–
- WebSocket ç›‘å¬å™¨ä¸­è°ƒç”¨ `loadTestPlanDetail(true)` é™é»˜åˆ·æ–°
- è½®è¯¢æœºåˆ¶ä¸­è°ƒç”¨ `loadTestPlanDetail(true)` é™é»˜åˆ·æ–°

#### 3. æ·»åŠ é¡µé¢åˆ·æ–°æŒ‡ç¤ºå™¨
- åœ¨é¡µé¢æ ‡é¢˜æ—æ·»åŠ  RefreshCw æ—‹è½¬å›¾æ ‡
- åˆ·æ–°æ—¶æ˜¾ç¤ºå›¾æ ‡åŠ¨ç”»ï¼Œä¸å½±å“é¡µé¢å…¶ä»–å†…å®¹

**æ•ˆæœï¼š**
âœ… é¦–æ¬¡æ‰“å¼€é¡µé¢/å¼¹çª—æ—¶æ­£å¸¸æ˜¾ç¤ºåŠ è½½ä¸­
âœ… WebSocket/è½®è¯¢åˆ·æ–°æ—¶ä¸å†é—ªå±
âœ… åˆ·æ–°æ—¶æ ‡é¢˜æ—æ˜¾ç¤ºå°çš„æ—‹è½¬å›¾æ ‡
âœ… è¿è¡Œä¸­çŠ¶æ€æ˜¾ç¤º"æ‰§è¡Œä¸­"å¾½ç« 
âœ… æ•°æ®æ— å˜åŒ–æ—¶ä¸è§¦å‘ re-render
âœ… çˆ¶ç»„ä»¶åˆ·æ–°ä¸å†å¯¼è‡´ Modal é—ªçƒ

---

## fix: ä¿®å¤ Ant Design bodyStyle å·²å¼ƒç”¨è­¦å‘Š

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/components/TestPlanExecutionLogModal.tsx`
- `src/pages/FunctionalTestCases/components/ExecutionLogModal.tsx`
- `src/components/TestPlanCaseExecutionLogModal.tsx`
- `src/pages/CacheStats.tsx`

**é—®é¢˜æè¿°ï¼š**
Ant Design ç»„ä»¶ä¸­çš„ `bodyStyle` å±æ€§å·²è¢«å¼ƒç”¨ï¼Œæ§åˆ¶å°å‡ºç°è­¦å‘Šï¼š`Warning: bodyStyle is deprecated, please use styles instead.`

**ä¿®å¤å†…å®¹ï¼š**
å°†æ‰€æœ‰ä½¿ç”¨ `bodyStyle` çš„åœ°æ–¹æ›¿æ¢ä¸º `styles` å±æ€§ï¼š
- Modal ç»„ä»¶ï¼š`bodyStyle={{...}}` â†’ `styles={{ body: {...} }}`
- Card ç»„ä»¶ï¼š`bodyStyle={{...}}` â†’ `styles={{ body: {...} }}`

**æ•ˆæœï¼š**
âœ… æ¶ˆé™¤æ‰€æœ‰ bodyStyle å·²å¼ƒç”¨è­¦å‘Š
âœ… ä½¿ç”¨æ–°çš„ styles APIï¼Œç¬¦åˆ Ant Design æœ€æ–°è§„èŒƒ
âœ… åŠŸèƒ½ä¿æŒä¸å˜ï¼Œæ ·å¼æ•ˆæœä¸€è‡´

---

## fix: ä¿®å¤æ‰§è¡Œå†å²runningçŠ¶æ€ç¼ºå°‘å®æ—¶è€—æ—¶å’Œåˆ·æ–°åæ•°æ®æœªæ›´æ–°çš„é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/pages/TestPlanDetail.tsx`
- `src/components/TestPlanExecutionLogModal.tsx`
- `server/services/testPlanService.ts`

**é—®é¢˜æè¿°ï¼š**
1. æ‰§è¡Œå†å²é¡µé¢ä¸­ï¼Œstatusä¸º"running"çš„æ‰§è¡Œè®°å½•æ²¡æœ‰æ˜¾ç¤ºè€—æ—¶ï¼Œä¹Ÿæ²¡æœ‰è½®è¯¢åˆ·æ–°æœºåˆ¶
2. æ‰§è¡Œè¯¦æƒ…å¼¹çª—è½®è¯¢åˆ·æ–°åï¼Œå³ä½¿æ¥å£è¿”å›äº†æœ€æ–°æ•°æ®ï¼Œé¡µé¢ä¹Ÿæ²¡æœ‰æ›´æ–°
3. **æ ¹æœ¬åŸå› **ï¼šåŠŸèƒ½ç”¨ä¾‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç”¨ä¾‹å®Œæˆååªæ›´æ–°äº†`execution_results`ï¼Œä½†æ²¡æœ‰åŒæ­¥æ›´æ–°`test_plan_executions`è¡¨çš„`started_at`ã€`finished_at`ã€`duration_ms`å­—æ®µ

**ä¿®å¤å†…å®¹ï¼š**

### 1. server/services/testPlanService.ts - åç«¯è‡ªåŠ¨åŒæ­¥æ—¶é—´å’Œè€—æ—¶

#### é—®é¢˜æ ¹å› 
`updateTestPlanExecution`å‡½æ•°åœ¨æ›´æ–°`execution_results`æ—¶ï¼Œæ²¡æœ‰æ ¹æ®å…¶ä¸­çš„æ—¶é—´æ•°æ®åŒæ­¥æ›´æ–°`test_plan_executions`è¡¨çš„æ—¶é—´å­—æ®µã€‚

#### ä¿®å¤æ–¹æ¡ˆ
åœ¨`updateTestPlanExecution`å‡½æ•°ä¸­ï¼Œå½“`execution_results`æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨è®¡ç®—å¹¶åŒæ­¥ï¼š
- `started_at`ï¼šä½¿ç”¨æ‰€æœ‰ç”¨ä¾‹ä¸­æœ€æ—©çš„å¼€å§‹æ—¶é—´
- `finished_at`ï¼šä½¿ç”¨æ‰€æœ‰ç”¨ä¾‹ä¸­æœ€æ™šçš„ç»“æŸæ—¶é—´
- `duration_ms`ï¼šä½¿ç”¨æ‰€æœ‰ç”¨ä¾‹è€—æ—¶ä¹‹å’Œ

```typescript
// ğŸ”¥ æ–°å¢ï¼šæ ¹æ® execution_results è‡ªåŠ¨è®¡ç®—å¹¶æ›´æ–°æ—¶é—´å’Œè€—æ—¶
if (update.execution_results && update.execution_results.length > 0) {
  const results = update.execution_results;
  
  // è·å–æ‰€æœ‰æœ‰æ•ˆçš„å¼€å§‹æ—¶é—´ï¼Œæ‰¾å‡ºæœ€æ—©çš„
  const startTimes = results
    .filter(r => r.started_at)
    .map(r => new Date(r.started_at!).getTime())
    .filter(t => !isNaN(t));
  
  // è·å–æ‰€æœ‰æœ‰æ•ˆçš„ç»“æŸæ—¶é—´ï¼Œæ‰¾å‡ºæœ€æ™šçš„
  const finishTimes = results
    .filter(r => r.finished_at)
    .map(r => new Date(r.finished_at!).getTime())
    .filter(t => !isNaN(t));
  
  // è®¡ç®—æ€»è€—æ—¶ï¼ˆæ‰€æœ‰ç”¨ä¾‹è€—æ—¶ä¹‹å’Œï¼‰
  const totalDurationMs = results
    .filter(r => r.duration_ms && r.duration_ms > 0)
    .reduce((sum, r) => sum + (r.duration_ms || 0), 0);
  
  // æ›´æ–° started_atï¼ˆä½¿ç”¨æœ€æ—©çš„å¼€å§‹æ—¶é—´ï¼‰
  if (startTimes.length > 0) {
    const earliestStart = new Date(Math.min(...startTimes));
    // å¦‚æœå½“å‰ started_at æ™šäºè®¡ç®—å‡ºçš„æœ€æ—©æ—¶é—´ï¼Œåˆ™æ›´æ–°
    if (currentExecution.started_at > earliestStart) {
      data.started_at = earliestStart;
    }
  }
  
  // æ›´æ–° finished_atï¼ˆä½¿ç”¨æœ€æ™šçš„ç»“æŸæ—¶é—´ï¼‰
  if (finishTimes.length > 0 && update.finished_at === undefined) {
    const latestFinish = new Date(Math.max(...finishTimes));
    data.finished_at = latestFinish;
  }
  
  // æ›´æ–° duration_msï¼ˆæ‰€æœ‰ç”¨ä¾‹è€—æ—¶ä¹‹å’Œï¼‰
  if (totalDurationMs > 0 && update.duration_ms === undefined) {
    data.duration_ms = totalDurationMs;
  }
}
```

### 2. TestPlanDetail.tsx - æ·»åŠ runningçŠ¶æ€å®æ—¶è€—æ—¶æ˜¾ç¤º

#### æ·»åŠ å½“å‰æ—¶é—´çŠ¶æ€
```typescript
const [currentTime, setCurrentTime] = useState<Date>(new Date());
```

#### æ·»åŠ å®æ—¶æ›´æ–°å®šæ—¶å™¨
å½“æœ‰runningçŠ¶æ€çš„æ‰§è¡Œè®°å½•æ—¶ï¼Œæ¯ç§’æ›´æ–°ä¸€æ¬¡currentTimeï¼š
```typescript
useEffect(() => {
  const hasRunningExecution = executions.some(e => e.status === 'running');
  if (!hasRunningExecution) return;
  
  const timeInterval = setInterval(() => {
    setCurrentTime(new Date());
  }, 1000);
  
  return () => clearInterval(timeInterval);
}, [executions]);
```

#### æ·»åŠ åŠ¨æ€è€—æ—¶è®¡ç®—å‡½æ•°
```typescript
const getExecutionDuration = (execution: TestPlanExecution): string => {
  if (execution.duration_ms) {
    return formatDuration(execution.duration_ms);
  }
  if (execution.status === 'running' && execution.started_at) {
    const runningMs = currentTime.getTime() - new Date(execution.started_at).getTime();
    if (runningMs > 0) {
      return formatDuration(runningMs);
    }
  }
  return '-';
};
```

#### ä¿®æ”¹è¡¨æ ¼æ¸²æŸ“
runningçŠ¶æ€çš„è€—æ—¶æ˜¾ç¤ºè“è‰²å¸¦åŠ¨ç”»æ•ˆæœï¼š
```tsx
{execution.status === 'running' ? (
  <span className="text-blue-600 animate-pulse">{getExecutionDuration(execution)}</span>
) : (
  getExecutionDuration(execution)
)}
```

### 3. TestPlanExecutionLogModal.tsx - ä¿®å¤æ•°æ®æ›´æ–°æ¯”è¾ƒé€»è¾‘

#### é—®é¢˜åŸå› 
ä¹‹å‰çš„æ¯”è¾ƒé€»è¾‘åªæ¯”è¾ƒäº†`execution_results?.length`ï¼Œä½†æ²¡æœ‰æ¯”è¾ƒæ¯ä¸ªç”¨ä¾‹çš„æ‰§è¡Œç»“æœå†…å®¹å˜åŒ–ã€‚

#### ä¿®å¤æ–¹æ¡ˆ
æ‰©å±•hasChangeæ¯”è¾ƒé€»è¾‘ï¼Œå¢åŠ å¯¹ç”¨ä¾‹æ‰§è¡Œç»“æœå†…å®¹çš„æ·±åº¦æ¯”è¾ƒï¼š
```typescript
// åŸºç¡€å­—æ®µæ¯”è¾ƒ
const hasBasicChange = 
  prevExecution.status !== result.status ||
  prevExecution.completed_cases !== result.completed_cases ||
  prevExecution.progress !== result.progress ||
  prevExecution.duration_ms !== result.duration_ms ||
  ...;

// ç”¨ä¾‹æ‰§è¡Œç»“æœå†…å®¹æ¯”è¾ƒ
let hasResultsChange = false;
if (!hasBasicChange && prevExecution.execution_results && result.execution_results) {
  for (let i = 0; i < result.execution_results.length; i++) {
    const prevResult = prevExecution.execution_results[i];
    const newResult = result.execution_results[i];
    if (prevResult && newResult && (
      prevResult.result !== newResult.result ||
      prevResult.execution_status !== newResult.execution_status ||
      prevResult.duration_ms !== newResult.duration_ms ||
      prevResult.passedSteps !== newResult.passedSteps ||
      ...
    )) {
      hasResultsChange = true;
      break;
    }
  }
}

const hasChange = hasBasicChange || hasResultsChange;
```

**æ•ˆæœï¼š**
âœ… åç«¯è‡ªåŠ¨æ ¹æ®execution_resultsåŒæ­¥æ›´æ–°started_atã€finished_atã€duration_ms
âœ… runningçŠ¶æ€çš„æ‰§è¡Œè®°å½•å®æ—¶æ˜¾ç¤ºå·²è¿è¡Œæ—¶é•¿ï¼ˆå‰ç«¯è®¡ç®—ï¼‰
âœ… ä¸€æ—¦åç«¯æ›´æ–°äº†duration_msï¼Œå‰ç«¯ä¼šä½¿ç”¨åç«¯çš„ç²¾ç¡®æ•°æ®
âœ… è€—æ—¶æ˜¾ç¤ºæ¯ç§’æ›´æ–°ï¼Œå¸¦è“è‰²åŠ¨ç”»æ•ˆæœ
âœ… æ²¡æœ‰runningçŠ¶æ€æ—¶ä¸å¯åŠ¨å®šæ—¶å™¨ï¼ŒèŠ‚çœèµ„æº
âœ… æ‰§è¡Œè¯¦æƒ…å¼¹çª—æ­£ç¡®æ£€æµ‹æ•°æ®å˜åŒ–å¹¶æ›´æ–°ç•Œé¢
âœ… ç”¨ä¾‹æ‰§è¡ŒçŠ¶æ€å˜åŒ–åç«‹å³åæ˜ åœ¨ç•Œé¢ä¸Š

---

## fix: è¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹åæ‰§è¡Œæ—¶é•¿åº”é‡æ–°è®¡æ—¶

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanExecute.tsx`

**é—®é¢˜æè¿°ï¼š**
æ‰§è¡Œè¿‡ç¨‹ä¸­è¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹ä¼šæ¢å¤æ‰§è¡Œç»“æœï¼Œä½†æ‰§è¡Œæ—¶é•¿ä¹Ÿä¼šè¢«æ¢å¤ä¸ºä¹‹å‰çš„å€¼ã€‚ç”¨æˆ·è®¤ä¸ºä¸åº”è¯¥æ¢å¤æ—¶é•¿ï¼Œè€Œåº”è¯¥é‡æ–°è®¡æ—¶ï¼Œæäº¤æ—¶ä½¿ç”¨æœ€æ–°çš„æ—¶é—´ä¿¡æ¯ã€‚

**ä¿®å¤å†…å®¹ï¼š**
åœ¨ `getInitialDataForCase` è®¡ç®—åˆå§‹æ•°æ®æ—¶ï¼Œä¸å†ä» `executionDetails.duration_ms` æ¢å¤æ‰§è¡Œæ—¶é•¿ï¼Œè€Œæ˜¯è®¾ç½®ä¸º 0 è®©ç”¨æˆ·é‡æ–°è®¡æ—¶ï¼š

```typescript
const initialData = {
  finalResult: state.finalResult,
  actualResult: state.executionDetails.actualResult || '',
  comments: state.executionDetails.comments || '',
  stepResults: state.executionDetails.stepResults || [],
  screenshots: restoredScreenshots,
  executionTime: 0, // ğŸ”¥ ä¸æ¢å¤æ‰§è¡Œæ—¶é•¿ï¼Œè¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹åé‡æ–°è®¡æ—¶
};
```

**è¯´æ˜ï¼š**
- `caseStartTimeRef` ä¼šåœ¨ `loadCaseDetails` ä¸­è‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´
- æäº¤æ—¶ä¼šä½¿ç”¨ `caseStartTimeRef.current` å’Œå½“å‰æ—¶é—´è®¡ç®—çœŸå®è€—æ—¶
- åªæ¢å¤æ‰§è¡Œç»“æœã€å®é™…ç»“æœã€å¤‡æ³¨ã€æˆªå›¾ç­‰æ•°æ®ï¼Œä¸æ¢å¤æ‰§è¡Œæ—¶é•¿

**æ•ˆæœï¼š**
âœ… è¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹åï¼Œæ‰§è¡Œæ—¶é•¿ä»0å¼€å§‹é‡æ–°è®¡æ—¶
âœ… å…¶ä»–æ‰§è¡Œæ•°æ®ï¼ˆç»“æœã€å¤‡æ³¨ã€æˆªå›¾ç­‰ï¼‰ä»ç„¶æ­£ç¡®æ¢å¤
âœ… æäº¤æ—¶ä½¿ç”¨æœ€æ–°çš„æ—¶é—´ä¿¡æ¯

---

## fix: ç¡®ä¿é‡æ–°æ‰§è¡Œæ—¶åŒæ­¥æ›´æ–° test_plan_executions çš„æ—¶é—´å­—æ®µ

**ä¿®æ”¹æ–‡ä»¶ï¼š** `server/services/testPlanService.ts`

**é—®é¢˜æè¿°ï¼š**
å½“ç”¨æˆ·è¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹å¹¶é‡æ–°æ‰§è¡Œæäº¤æ—¶ï¼Œ`finished_at` å’Œ `duration_ms` æ²¡æœ‰æ ¹æ®æœ€æ–°çš„ `execution_results` æ›´æ–°ï¼Œå› ä¸ºä¹‹å‰çš„é€»è¾‘åªåœ¨æ²¡æœ‰æ˜¾å¼ä¼ å…¥è¿™äº›å€¼æ—¶æ‰æ›´æ–°ã€‚

**ä¿®å¤å†…å®¹ï¼š**
ä¿®æ”¹ `updateTestPlanExecution` å‡½æ•°ä¸­çš„æ—¶é—´æ›´æ–°é€»è¾‘ï¼Œä½¿ `started_at`ã€`finished_at` å’Œ `duration_ms` æ€»æ˜¯æ ¹æ® `execution_results` é‡æ–°è®¡ç®—ï¼š

```typescript
// ğŸ”¥ ä¿®æ”¹ï¼šæ€»æ˜¯æ ¹æ® execution_results æ›´æ–° started_at
if (startTimes.length > 0) {
  const earliestStart = new Date(Math.min(...startTimes));
  data.started_at = earliestStart;
}

// ğŸ”¥ ä¿®æ”¹ï¼šæ€»æ˜¯æ ¹æ® execution_results æ›´æ–° finished_at
if (finishTimes.length > 0) {
  const latestFinish = new Date(Math.max(...finishTimes));
  data.finished_at = latestFinish;
}

// ğŸ”¥ ä¿®æ”¹ï¼šæ€»æ˜¯æ ¹æ® execution_results é‡æ–°è®¡ç®— duration_ms
if (totalDurationMs > 0) {
  data.duration_ms = totalDurationMs;
}
```

**è¯´æ˜ï¼š**
- `started_at`ï¼šæ€»æ˜¯æ›´æ–°ä¸ºæ‰€æœ‰ç”¨ä¾‹ä¸­æœ€æ—©çš„å¼€å§‹æ—¶é—´
- `finished_at`ï¼šæ€»æ˜¯æ›´æ–°ä¸ºæ‰€æœ‰ç”¨ä¾‹ä¸­æœ€æ™šçš„ç»“æŸæ—¶é—´
- `duration_ms`ï¼šæ€»æ˜¯é‡æ–°è®¡ç®—ä¸ºæ‰€æœ‰ç”¨ä¾‹è€—æ—¶ä¹‹å’Œ

**æ•ˆæœï¼š**
âœ… ç”¨æˆ·è¿”å›ä¸Šä¸€ä¸ªç”¨ä¾‹é‡æ–°æ‰§è¡Œåï¼Œ`test_plan_executions` è¡¨çš„æ‰€æœ‰æ—¶é—´å­—æ®µéƒ½æ­£ç¡®æ›´æ–°
âœ… `started_at` æ€»æ˜¯åæ˜ æœ€æ—©çš„å¼€å§‹æ—¶é—´
âœ… `finished_at` æ€»æ˜¯åæ˜ æœ€æ™šçš„ç»“æŸæ—¶é—´
âœ… `duration_ms` æ€»æ˜¯åæ˜ æ‰€æœ‰ç”¨ä¾‹çš„çœŸå®è€—æ—¶ä¹‹å’Œ

---

## fix: ä¿®å¤ test_plan_executions æ—¶é—´å­—æ®µç²¾åº¦é—®é¢˜

**ä¿®æ”¹æ–‡ä»¶ï¼š** `prisma/schema.prisma`

**é—®é¢˜æè¿°ï¼š**
`test_plan_executions` è¡¨çš„ `started_at` å’Œ `finished_at` å­—æ®µå®šä¹‰ä¸º `@db.Timestamp(0)`ï¼ˆç§’çº§ç²¾åº¦ï¼‰ï¼Œå¯¼è‡´ä¿å­˜æ—¶æ¯«ç§’è¢«æˆªæ–­ã€‚ä¾‹å¦‚ï¼š
- `execution_results` ä¸­çš„ `finished_at`: `2025-12-27T07:02:58.845Z`
- æ•°æ®åº“ä¸­çš„ `finished_at`: `2025-12-27T07:02:59.000Z`

**ä¿®å¤å†…å®¹ï¼š**
å°† `Timestamp(0)` æ”¹ä¸º `Timestamp(3)` ä»¥æ”¯æŒæ¯«ç§’ç²¾åº¦ï¼š

```prisma
// ä¿®æ”¹å‰
started_at          DateTime                 @default(now()) @db.Timestamp(0)
finished_at         DateTime?                @db.Timestamp(0)

// ä¿®æ”¹å
started_at          DateTime                 @default(now()) @db.Timestamp(3)
finished_at         DateTime?                @db.Timestamp(3)
```

**è¿ç§»å‘½ä»¤ï¼š**
```bash
npx prisma migrate dev --name update_timestamp_precision
```

**æ•ˆæœï¼š**
âœ… æ—¶é—´å­—æ®µä¿å­˜æ¯«ç§’ç²¾åº¦
âœ… `test_plan_executions` è¡¨çš„æ—¶é—´ä¸ `execution_results` ä¸­çš„æ—¶é—´å®Œå…¨ä¸€è‡´

---

## 2024-12-27 ä¿®å¤è·³è¿‡ç”¨ä¾‹å¯¼è‡´æ‰§è¡Œè®°å½•è¢«è¯¯åˆ é™¤çš„é—®é¢˜

### fix: è·³è¿‡ç”¨ä¾‹æ—¶æ ‡è®°å·²æäº¤ç»“æœé˜²æ­¢æ‰§è¡Œè®°å½•è¢«åˆ é™¤

**é—®é¢˜ï¼š**
å½“æµ‹è¯•è®¡åˆ’æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ç”¨ä¾‹éƒ½è¢«è·³è¿‡æ—¶ï¼Œé¡µé¢å¸è½½æ—¶ä¼šé”™è¯¯åœ°åˆ é™¤æ‰§è¡Œè®°å½•ã€‚è¿™æ˜¯å› ä¸º `hasSubmittedResultsRef` æ²¡æœ‰åœ¨è·³è¿‡ç”¨ä¾‹æ—¶è¢«è®¾ç½®ä¸º `true`ã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanExecute.tsx`ï¼šåœ¨ `handleSkipCurrentCase` å‡½æ•°ä¸­ï¼ŒæˆåŠŸè°ƒç”¨ `updateTestPlanCaseStatus` åè®¾ç½® `hasSubmittedResultsRef.current = true`

**æ•ˆæœï¼š**
âœ… è·³è¿‡ç”¨ä¾‹ä¹Ÿè¢«è§†ä¸ºæ­£å¸¸æäº¤ç»“æœï¼Œæ‰§è¡Œè®°å½•ä¸ä¼šè¢«é”™è¯¯åˆ é™¤

---

## 2024-12-27 ä¿®å¤ä¸­é€”é€€å‡ºæ‰§è¡Œæ—¶ç¼ºå¤±æ—¶é—´å­—æ®µçš„é—®é¢˜

### fix: é€€å‡ºç¡®è®¤æ—¶ä¿å­˜å®Œæ•´çš„æ‰§è¡Œç»“æœæ—¶é—´å­—æ®µ

**é—®é¢˜ï¼š**
ç”¨æˆ·ä¸­é€”é€€å‡ºæ‰§è¡Œæ—¶ï¼Œ`execution_results` ä¸­ç¼ºå°‘ `started_at` å’Œ `finished_at` å­—æ®µï¼Œä¸” `executed_at` ä½¿ç”¨çš„æ˜¯é€€å‡ºæ—¶çš„å½“å‰æ—¶é—´è€Œéå®é™…æ‰§è¡Œå®Œæˆæ—¶é—´ã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanExecute.tsx`ï¼š`handleConfirmExit` å‡½æ•°ä¸­æ„å»º `executionResults` æ—¶ï¼š
  - æ·»åŠ  `started_at` å­—æ®µï¼Œä» `state.executionDetails.started_at` è¯»å–
  - æ·»åŠ  `finished_at` å­—æ®µï¼Œä» `state.executionDetails.finished_at` è¯»å–
  - `executed_at` ä¼˜å…ˆä½¿ç”¨ `state.executionDetails.finished_at`

**æ•ˆæœï¼š**
âœ… ä¸­é€”é€€å‡ºä¿å­˜çš„æ‰§è¡Œè®°å½•ä¸æ­£å¸¸å®Œæˆçš„æ•°æ®ç»“æ„ä¸€è‡´

---

## 2024-12-27 ä¿®å¤ç»§ç»­æ‰§è¡Œæ—¶æœªé‡ç½®æ‰§è¡Œè¿›åº¦å’Œæ—¶é—´å­—æ®µçš„é—®é¢˜

### fix: ç»§ç»­æ‰§è¡Œå·²å–æ¶ˆçš„æµ‹è¯•è®¡åˆ’æ—¶æ­£ç¡®é‡ç½®çŠ¶æ€

**é—®é¢˜ï¼š**
ä¸­é€”é€€å‡ºï¼ˆå–æ¶ˆï¼‰åï¼Œé‡æ–°ç»§ç»­æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œè¿›åº¦ã€ç»“æŸæ—¶é—´ã€è€—æ—¶ç­‰å­—æ®µæ²¡æœ‰é‡ç½®ï¼Œå¯¼è‡´æ˜¾ç¤ºé”™è¯¯çš„çŠ¶æ€ã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanExecute.tsx`ï¼š`loadPlanAndCases` å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œæ¨¡å¼ï¼š
  - è®¡ç®—å·²æ¢å¤ç”¨ä¾‹çš„ç»Ÿè®¡æ•°æ®ï¼ˆé€šè¿‡/å¤±è´¥/é˜»å¡/è·³è¿‡æ•°é‡ï¼‰
  - é‡ç½® `finished_at` ä¸º `null`ï¼ˆå› ä¸ºé‡æ–°å¼€å§‹æ‰§è¡Œï¼‰
  - é‡ç½® `duration_ms` ä¸º `null`ï¼ˆå› ä¸ºéœ€è¦é‡æ–°è®¡æ—¶ï¼‰
  - é‡æ–°è®¡ç®— `progress`ï¼ˆåŸºäºå½“å‰ç”¨ä¾‹åˆ—è¡¨ï¼‰
  - æ›´æ–° `total_cases` å’Œå„çŠ¶æ€è®¡æ•°
  - æ¢å¤ `started_at` å’Œ `finished_at` æ—¶é—´å­—æ®µ
  
- `server/services/testPlanService.ts`ï¼š`updateTestPlanExecution` å‡½æ•°ï¼š
  - æ”¯æŒ `finished_at` è®¾ç½®ä¸º `null`
  - æ”¯æŒ `duration_ms` è®¾ç½®ä¸º `null`
  - æ”¯æŒ `error_message` è®¾ç½®ä¸º `null`
  - æ–°å¢ `total_cases` å­—æ®µæ”¯æŒ

**æ•ˆæœï¼š**
âœ… ç»§ç»­æ‰§è¡Œæ—¶æ­£ç¡®é‡ç½®æ‰§è¡ŒçŠ¶æ€ï¼Œè¿›åº¦å’Œæ—¶é—´ä¿¡æ¯å‡†ç¡®

---

## 2024-12-27 ä¿®å¤è¶…æ—¶è‡ªåŠ¨å–æ¶ˆæ—¶ç¼ºå¤± duration_ms çš„é—®é¢˜

### fix: è¶…æ—¶è‡ªåŠ¨å–æ¶ˆæ‰§è¡Œè®°å½•æ—¶æ­£ç¡®è®¡ç®—è€—æ—¶

**é—®é¢˜ï¼š**
è¶…æ—¶è‡ªåŠ¨å–æ¶ˆæ‰§è¡Œè®°å½•æ—¶ï¼Œæ²¡æœ‰è®¾ç½® `duration_ms` å­—æ®µï¼Œå¯¼è‡´æ‰§è¡Œå†å²ä¸­è€—æ—¶æ˜¾ç¤ºä¸ºç©ºã€‚

**ä¿®å¤ï¼š**
- `server/services/testPlanService.ts`ï¼š`getTestPlanDetail` å‡½æ•°ä¸­è¶…æ—¶æ¸…ç†é€»è¾‘ï¼š
  - å°† `updateMany` æ”¹ä¸º `findMany` + å¾ªç¯ `update`ï¼Œä»¥ä¾¿è®¡ç®—æ¯æ¡è®°å½•çš„è€—æ—¶
  - ä¼˜å…ˆä½¿ç”¨ `execution_results` ä¸­æ¯æ¡ç”¨ä¾‹çš„ `duration_ms` æ€»å’Œ
  - å¦‚æœæ²¡æœ‰ç”¨ä¾‹è€—æ—¶æ•°æ®ï¼Œä½¿ç”¨ä» `started_at` åˆ°å½“å‰æ—¶é—´çš„å·®å€¼
  - æ›´æ–°æ³¨é‡Šå’Œå˜é‡åï¼ˆä» queued æ”¹ä¸º runningï¼‰

**æ•ˆæœï¼š**
âœ… è¶…æ—¶è‡ªåŠ¨å–æ¶ˆçš„æ‰§è¡Œè®°å½•åŒ…å«æ­£ç¡®çš„è€—æ—¶ä¿¡æ¯

---

## 2024-12-27 å¢å¼ºæ‰§è¡ŒçŠ¶æ€æ›´æ–°æ”¯æŒå’Œè°ƒè¯•æ—¥å¿—

### feat: æ”¯æŒæ›´æ–° started_at å­—æ®µå¹¶æ·»åŠ è°ƒè¯•æ—¥å¿—

**æ”¹è¿›ï¼š**
- `server/services/testPlanService.ts`ï¼š`updateTestPlanExecution` å‡½æ•°ï¼š
  - æ–°å¢ `started_at` å­—æ®µæ”¯æŒï¼Œå…è®¸æ›´æ–°æ‰§è¡Œå¼€å§‹æ—¶é—´
  - æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—ï¼Œæ‰“å°æ¥æ”¶åˆ°çš„æ›´æ–°æ•°æ®å’Œå°†è¦æ›´æ–°çš„æ•°æ®
  - ä¾¿äºæ’æŸ¥é‡æ–°æ‰§è¡Œ/ç»§ç»­æ‰§è¡Œæ—¶æ•°æ®é‡ç½®é—®é¢˜

**æ•ˆæœï¼š**
âœ… åç«¯æ”¯æŒæ›´å®Œæ•´çš„æ‰§è¡ŒçŠ¶æ€å­—æ®µæ›´æ–°
âœ… è°ƒè¯•æ—¥å¿—å¯è¿½è¸ªæ•°æ®æ›´æ–°æµç¨‹

---

## 2024-12-27 ä¿®å¤é‡æ–°æ‰§è¡Œé€»è¾‘å®Œå…¨é‡ç½®æ‰§è¡ŒçŠ¶æ€

### fix: é‡æ–°æ‰§è¡Œæ—¶å®Œå…¨é‡ç½®æ‰€æœ‰æ‰§è¡Œç»“æœå’Œç»Ÿè®¡æ•°æ®

**é—®é¢˜ï¼š**
é‡æ–°æ‰§è¡Œé€»è¾‘é”™è¯¯åœ°ä¿ç•™äº†ä¹‹å‰çš„ç”¨ä¾‹æ‰§è¡Œç»“æœå’Œç»Ÿè®¡æ•°æ®ï¼Œåº”è¯¥å®Œå…¨é‡ç½®ã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanExecute.tsx`ï¼š`loadPlanAndCases` å‡½æ•°ä¸­é‡æ–°æ‰§è¡Œæ¨¡å¼ï¼š
  - ä¿ç•™åŸæ¥çš„ç”¨ä¾‹æ•°é‡ï¼ˆ`total_cases`ï¼‰
  - é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®ä¸º 0ï¼ˆ`passed_cases`, `failed_cases`, `blocked_cases`, `skipped_cases`, `completed_cases`ï¼‰
  - é‡ç½®è¿›åº¦ä¸º 0ï¼ˆ`progress: 0`ï¼‰
  - æ›´æ–°å¼€å§‹æ—¶é—´ä¸ºå½“å‰æ—¶é—´ï¼ˆ`started_at: new Date()`ï¼‰
  - æ¸…ç©ºç»“æŸæ—¶é—´ï¼ˆ`finished_at: null`ï¼‰
  - æ¸…ç©ºæ‰§è¡Œè€—æ—¶ï¼ˆ`duration_ms: null`ï¼‰
  - æ¸…ç©ºé”™è¯¯ä¿¡æ¯ï¼ˆ`error_message: null`ï¼‰
  - æ¸…ç©ºæ‰§è¡Œç»“æœåˆ—è¡¨ï¼ˆ`execution_results: []`ï¼‰
  - å‰ç«¯ä¸æ¢å¤ä¹‹å‰çš„ç”¨ä¾‹çŠ¶æ€ï¼ˆ`caseStates` ä¿æŒä¸ºç©º Mapï¼‰
  - æ›´æ–°æç¤ºæ¶ˆæ¯ä¸º"é‡æ–°æ‰§è¡Œï¼Œå…± N ä¸ªç”¨ä¾‹"

**æ•ˆæœï¼š**
âœ… é‡æ–°æ‰§è¡Œæ—¶å®Œå…¨é‡ç½®æ‰€æœ‰æ‰§è¡ŒçŠ¶æ€ï¼Œä»å¤´å¼€å§‹

---

## 2024-12-27 ä¿®å¤é‡æ–°æ‰§è¡Œæ—¶ç”¨ä¾‹æ•°é‡ä¸æ­£ç¡®çš„é—®é¢˜

### fix: é‡æ–°æ‰§è¡Œæ—¶ä¼ é€’æ‰€æœ‰ç”¨ä¾‹è€Œä¸æ˜¯åªä¼ é€’æœªå®Œæˆçš„ç”¨ä¾‹

**é—®é¢˜ï¼š**
é‡æ–°æ‰§è¡Œæ—¶ï¼Œåªä¼ é€’äº†æœªå®Œæˆçš„ç”¨ä¾‹IDï¼Œå¯¼è‡´åŸæœ¬2ä¸ªç”¨ä¾‹åªæ˜¾ç¤º1ä¸ªã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanDetail.tsx`ï¼š`handleContinueExecution` å‡½æ•°ï¼š
  - è·å–è¯¥æ‰§è¡Œç±»å‹çš„æ‰€æœ‰ç”¨ä¾‹ï¼Œè€Œä¸æ˜¯åªè·å–æœªå®Œæˆçš„ç”¨ä¾‹
  - ä¼ é€’æ‰€æœ‰ç”¨ä¾‹IDåˆ°æ‰§è¡Œé¡µé¢
  - æ›´æ–°å‡½æ•°æ³¨é‡Šè¯´æ˜è¿™æ˜¯"é‡æ–°æ‰§è¡Œ"è€Œé"ç»§ç»­æ‰§è¡Œ"

**æ•ˆæœï¼š**
âœ… é‡æ–°æ‰§è¡Œæ—¶æ˜¾ç¤ºæ‰€æœ‰å…³è”çš„ç”¨ä¾‹

---

## 2024-12-27 åŒºåˆ†ç»§ç»­æ‰§è¡Œå’Œé‡æ–°æ‰§è¡Œä¸¤ç§æ¨¡å¼

### feat: åˆ†ç¦»ç»§ç»­æ‰§è¡Œå’Œé‡æ–°æ‰§è¡Œçš„é€»è¾‘

**éœ€æ±‚ï¼š**
- ç»§ç»­æ‰§è¡Œï¼ˆcancelled/running çŠ¶æ€ï¼‰ï¼šä¿ç•™ä¹‹å‰çš„å†å²æ•°æ®ï¼Œåªæ‰§è¡Œæœªå®Œæˆçš„ç”¨ä¾‹
- é‡æ–°æ‰§è¡Œï¼ˆcompleted çŠ¶æ€ï¼‰ï¼šå®Œå…¨é‡ç½®æ‰€æœ‰æ•°æ®ï¼Œæ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹

**ä¿®å¤ï¼š**
- `src/pages/TestPlanDetail.tsx`ï¼š
  - æ–°å¢ `handleReExecute` å‡½æ•°ç”¨äºé‡æ–°æ‰§è¡Œï¼ˆä¼ é€’æ‰€æœ‰ç”¨ä¾‹ï¼Œ`continueMode=reexecute`ï¼‰
  - ä¿®æ”¹ `handleContinueExecution` å‡½æ•°ç”¨äºç»§ç»­æ‰§è¡Œï¼ˆä¼ é€’æœªå®Œæˆç”¨ä¾‹ï¼Œ`continueMode=continue`ï¼‰
  - æ›´æ–°å››å¤„æŒ‰é’®ï¼š
    - `cancelled`/`running` çŠ¶æ€ â†’ æ˜¾ç¤ºç»¿è‰²"ç»§ç»­æ‰§è¡Œ"æŒ‰é’®
    - `completed` çŠ¶æ€ â†’ æ˜¾ç¤ºæ©™è‰²"é‡æ–°æ‰§è¡Œ"æŒ‰é’®

- `src/pages/TestPlanExecute.tsx`ï¼š
  - æ–°å¢ `continueMode` URL å‚æ•°ï¼ˆ`continue`/`reexecute`ï¼‰
  - æ ¹æ® `continueMode` åˆ†åˆ«å¤„ç†ï¼š
    - `reexecute`ï¼šå®Œå…¨é‡ç½®æ‰€æœ‰æ•°æ®
    - `continue`ï¼šä¿ç•™å·²å®Œæˆç”¨ä¾‹çš„çŠ¶æ€

**æ•ˆæœï¼š**
âœ… ç»§ç»­æ‰§è¡Œä¿ç•™å†å²æ•°æ®ï¼Œåªæ‰§è¡Œæœªå®Œæˆçš„ç”¨ä¾‹
âœ… é‡æ–°æ‰§è¡Œå®Œå…¨é‡ç½®ï¼Œæ‰§è¡Œæ‰€æœ‰ç”¨ä¾‹
âœ… æŒ‰é’®é¢œè‰²åŒºåˆ†ï¼šç»¿è‰²ç»§ç»­æ‰§è¡Œï¼Œæ©™è‰²é‡æ–°æ‰§è¡Œ

---

## 2024-12-27 ç»§ç»­æ‰§è¡Œæ—¶ä¼ é€’æ‰€æœ‰ç”¨ä¾‹

### fix: ç»§ç»­æ‰§è¡Œä¼ é€’æ‰€æœ‰ç”¨ä¾‹ä»¥ä¾¿åœ¨æ‰§è¡Œé¡µé¢æ˜¾ç¤ºå®Œæ•´åˆ—è¡¨

**é—®é¢˜ï¼š**
ç»§ç»­æ‰§è¡Œæ—¶åªä¼ é€’æœªå®Œæˆçš„ç”¨ä¾‹ IDï¼Œå¯¼è‡´æ‰§è¡Œé¡µé¢çœ‹ä¸åˆ°å·²å®Œæˆçš„ç”¨ä¾‹ã€‚

**ä¿®å¤ï¼š**
- `src/pages/TestPlanDetail.tsx`ï¼š`handleContinueExecution` å‡½æ•°ï¼š
  - ä¼ é€’æ‰€æœ‰ç”¨ä¾‹ IDï¼ˆè€Œä¸æ˜¯åªä¼ é€’æœªå®Œæˆçš„ç”¨ä¾‹ï¼‰
  - åœ¨ `TestPlanExecute.tsx` ä¸­é€šè¿‡ `continueMode=continue` æ¢å¤å·²å®Œæˆç”¨ä¾‹çš„çŠ¶æ€
  - è¿™æ ·æ‰§è¡Œé¡µé¢å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç”¨ä¾‹åˆ—è¡¨ï¼Œå·²å®Œæˆçš„ç”¨ä¾‹ä¼šæ˜¾ç¤ºå…¶æ‰§è¡ŒçŠ¶æ€

**æ•ˆæœï¼š**
âœ… ç»§ç»­æ‰§è¡Œæ—¶å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç”¨ä¾‹ï¼ˆåŒ…æ‹¬å·²å®Œæˆçš„ï¼‰
âœ… å·²å®Œæˆçš„ç”¨ä¾‹ä¿ç•™å…¶æ‰§è¡ŒçŠ¶æ€å’Œç»“æœ

---

## ä¿®å¤ï¼šç»§ç»­æ‰§è¡Œæ—¶å®Œå…¨æ¢å¤å·²å®Œæˆç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€

**é—®é¢˜æè¿°ï¼š**
ç»§ç»­æ‰§è¡Œæµ‹è¯•è®¡åˆ’æ—¶ï¼Œè™½ç„¶ä¿ç•™äº†ç”¨ä¾‹æ•°æ®ï¼Œä½†æ²¡æœ‰æ­£ç¡®æ¢å¤ç”¨ä¾‹çš„æ‰§è¡ŒçŠ¶æ€ï¼š
1. `stepResults`ï¼ˆæ­¥éª¤æ‰§è¡Œç»“æœï¼‰æ²¡æœ‰ä¿å­˜å’Œæ¢å¤
2. `currentCaseIndex` æ²¡æœ‰è·³è½¬åˆ°ç¬¬ä¸€ä¸ªæœªå®Œæˆçš„ç”¨ä¾‹
3. é¡µé¢æ€»æ˜¯ä»ç¬¬ä¸€ä¸ªç”¨ä¾‹å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»ç¬¬ä¸€ä¸ªæœªå®Œæˆçš„ç”¨ä¾‹å¼€å§‹

**ä¿®æ”¹å†…å®¹ï¼š**

1. **æ¢å¤ `stepResults` å­—æ®µ** (`src/pages/TestPlanExecute.tsx`)
   - åœ¨ç±»å‹å®šä¹‰ä¸­æ·»åŠ  `stepResults` å­—æ®µ
   - åœ¨æ¢å¤ `executionDetails` æ—¶åŒ…å« `stepResults`
   - åœ¨ `currentCaseInitialData` ä¸­æ¢å¤ `stepResults`

2. **è·³è½¬åˆ°ç¬¬ä¸€ä¸ªæœªå®Œæˆç”¨ä¾‹**
   - æ·»åŠ  `initialCaseIndex` å±€éƒ¨å˜é‡è·Ÿè¸ªåˆå§‹ç”¨ä¾‹ç´¢å¼•
   - ç»§ç»­æ‰§è¡Œæ—¶è®¾ç½® `currentCaseIndex` ä¸ºç¬¬ä¸€ä¸ªæœªå®Œæˆç”¨ä¾‹çš„ç´¢å¼•
   - ä¿®æ”¹åŠ è½½ç”¨ä¾‹é€»è¾‘ä½¿ç”¨ `initialCaseIndex`

3. **åœ¨æ‰€æœ‰ `executionResults` æ„å»ºå¤„æ·»åŠ  `stepResults`**
   - `handleSaveCurrentCase`: å½“å‰ç”¨ä¾‹å’Œä¹‹å‰ç”¨ä¾‹åˆ†æ”¯
   - `handleSkipCurrentCase`: è·³è¿‡ç”¨ä¾‹å’Œä¹‹å‰ç”¨ä¾‹åˆ†æ”¯
   - `handleConfirmExit`: é€€å‡ºç¡®è®¤æ—¶çš„ç”¨ä¾‹ç»“æœ

**æ•ˆæœï¼š**
âœ… ç»§ç»­æ‰§è¡Œæ—¶è‡ªåŠ¨è·³è½¬åˆ°ç¬¬ä¸€ä¸ªæœªå®Œæˆçš„ç”¨ä¾‹
âœ… å·²å®Œæˆç”¨ä¾‹çš„æ­¥éª¤æ‰§è¡Œç»“æœè¢«æ­£ç¡®æ¢å¤
âœ… å¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘å·²å®Œæˆç”¨ä¾‹çš„è¯¦ç»†æ‰§è¡Œç»“æœ
âœ… æ‰€æœ‰ä¿å­˜åœºæ™¯éƒ½åŒ…å«å®Œæ•´çš„æ­¥éª¤æ‰§è¡Œç»“æœ

---

## 2024-12-27: ä¿®å¤ç»§ç»­æ‰§è¡ŒçŠ¶æ€åŒæ­¥å’Œæµ‹è¯•è®¡åˆ’åˆ—è¡¨çŠ¶æ€æ˜¾ç¤º

### fix: ç‚¹å‡»ç»§ç»­æ‰§è¡Œç«‹å³åŒæ­¥çŠ¶æ€ä¸ºè¿›è¡Œä¸­

**ä¿®æ”¹æ–‡ä»¶ï¼š** 
- `src/pages/TestPlanDetail.tsx`
- `server/services/testPlanService.ts`

**é—®é¢˜ï¼š** ç‚¹å‡»"ç»§ç»­æ‰§è¡Œ"æŒ‰é’®åï¼Œæ‰§è¡ŒçŠ¶æ€æ²¡æœ‰ç«‹å³æ›´æ–°ä¸º"è¿›è¡Œä¸­"

**ä¿®å¤ï¼š**
- åœ¨ `handleContinueExecution` å‡½æ•°ä¸­ï¼Œå¯¼èˆªå‰å…ˆè°ƒç”¨ `testPlanService.updateTestPlanExecution` æ›´æ–°çŠ¶æ€ä¸º `running`
- åŒæ—¶ç«‹å³æ›´æ–°æœ¬åœ° `executions` çŠ¶æ€ï¼Œè®© UI åŒæ­¥æ˜¾ç¤º

### fix: æµ‹è¯•è®¡åˆ’åˆ—è¡¨çŠ¶æ€ä¸æ‰§è¡Œå†å²çŠ¶æ€å¯¹åº”ï¼ˆåç«¯åŒæ­¥æ›´æ–°ï¼‰

**ä¿®æ”¹æ–‡ä»¶ï¼š** 
- `server/services/testPlanService.ts`
- `src/pages/TestPlans.tsx`

**é—®é¢˜ï¼š** æµ‹è¯•è®¡åˆ’è¡¨ `test_plans` çš„çŠ¶æ€æ²¡æœ‰è·Ÿéšæ‰§è¡ŒçŠ¶æ€åŒæ­¥æ›´æ–°

**ä¿®å¤ï¼ˆåç«¯ï¼‰ï¼š**
- ä¿®æ”¹ `updateTestPlanExecution` å‡½æ•°ï¼šå½“æ‰§è¡ŒçŠ¶æ€å˜ä¸º `running`/`completed`/`failed`/`cancelled` æ—¶ï¼Œéƒ½è§¦å‘ `updateTestPlanStatusFromLatestExecution` æ›´æ–°è®¡åˆ’çŠ¶æ€
- ä¿®æ”¹ `updateTestPlanStatusFromLatestExecution` å‡½æ•°ï¼š
  - æ·»åŠ å¯¹ `running` çŠ¶æ€çš„å¤„ç†ï¼šæ›´æ–°è®¡åˆ’çŠ¶æ€ä¸º `active`
  - æ·»åŠ å¯¹ `cancelled` çŠ¶æ€çš„å¤„ç†ï¼šæ ¹æ®å·²æ‰§è¡Œç”¨ä¾‹æ•°åˆ¤æ–­çŠ¶æ€ï¼ˆå…¨éƒ¨å®Œæˆâ†’completedï¼Œéƒ¨åˆ†å®Œæˆâ†’activeï¼Œæ— å®Œæˆâ†’not_startedï¼‰
  - æ·»åŠ å¯¹ `failed` çŠ¶æ€çš„å¤„ç†ï¼šä¿æŒ `active` çŠ¶æ€ï¼ˆå› ä¸ºå¯èƒ½éœ€è¦é‡æ–°æ‰§è¡Œï¼‰

**ä¿®å¤ï¼ˆå‰ç«¯ï¼‰ï¼š**
- ä¿®æ”¹ `getStatusBadge` å‡½æ•°ï¼šç›´æ¥ä½¿ç”¨ `plan.status`ï¼Œå› ä¸ºåç«¯å·²åŒæ­¥æ›´æ–°
- ä¿®æ”¹ `handleReExecute` å‡½æ•°ï¼šç‚¹å‡»æ—¶ç«‹å³æ›´æ–°æ‰§è¡ŒçŠ¶æ€ä¸º `running`ï¼Œä¸ `handleContinueExecution` ä¿æŒä¸€è‡´

**æ•ˆæœï¼š**
âœ… ç‚¹å‡»ç»§ç»­æ‰§è¡Œ/é‡æ–°æ‰§è¡Œåï¼Œæ‰§è¡ŒçŠ¶æ€ç«‹å³å˜ä¸º"æ‰§è¡Œä¸­"
âœ… è¿”å›å–æ¶ˆæ‰§è¡Œæ—¶ï¼Œè®¡åˆ’çŠ¶æ€æ ¹æ®å·²å®Œæˆç”¨ä¾‹æ•°è‡ªåŠ¨æ›´æ–°
âœ… æµ‹è¯•è®¡åˆ’è¡¨ `test_plans` çš„ `status` å­—æ®µè‡ªåŠ¨ä¸æ‰§è¡ŒçŠ¶æ€åŒæ­¥
âœ… æµ‹è¯•è®¡åˆ’åˆ—è¡¨çŠ¶æ€ä¸æ‰§è¡Œå†å²çŠ¶æ€ä¿æŒä¸€è‡´

### fix: æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—

**ä¿®æ”¹æ–‡ä»¶ï¼š** `src/pages/TestPlanDetail.tsx`

**æ”¹è¿›ï¼š**
- `handleContinueExecution` å’Œ `handleReExecute` å‡½æ•°æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- æ•è·é”™è¯¯æ—¶æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼ˆé€šè¿‡ Toast æç¤ºç”¨æˆ·ï¼‰
- æ‰“å°åç«¯è¿”å›çš„ç»“æœï¼Œä¾¿äºè¿½è¸ªé—®é¢˜

### fix: ä¿®å¤ç»§ç»­æ‰§è¡Œæ—¶çŠ¶æ€è¢«è¶…æ—¶æ¸…ç†é€»è¾‘è¦†ç›–çš„é—®é¢˜

**é—®é¢˜æ ¹å› ï¼š**
- `getTestPlanDetail` å‡½æ•°ä¸­æœ‰è‡ªåŠ¨æ¸…ç†è¶…æ—¶æ‰§è¡Œè®°å½•çš„é€»è¾‘
- å¦‚æœ `running` çŠ¶æ€çš„æ‰§è¡Œè®°å½•çš„ `started_at` è¶…è¿‡ 1 åˆ†é’Ÿï¼Œä¼šè‡ªåŠ¨è®¾ç½®ä¸º `cancelled`

**ä¿®å¤æ–¹æ¡ˆï¼š**

**åç«¯ (`server/services/testPlanService.ts`)ï¼š**
- å°†è‡ªåŠ¨æ¸…ç†é€»è¾‘æ”¹ä¸ºå¯é…ç½®ï¼Œé»˜è®¤å…³é—­
- é€šè¿‡ç¯å¢ƒå˜é‡ `ENABLE_AUTO_CLEANUP_EXPIRED_EXECUTIONS=true` æ‰‹åŠ¨å¼€å¯
- è¶…æ—¶æ—¶é—´å¯é€šè¿‡ `RUNNING_TIMEOUT_MS` é…ç½®ï¼ˆé»˜è®¤ 60000 æ¯«ç§’ï¼‰

**å‰ç«¯ (`src/pages/TestPlanDetail.tsx`)ï¼š**
- `handleContinueExecution`ï¼šä¿ç•™åŸæ¥çš„ `started_at`ï¼Œåªæ›´æ–° `status` å’Œæ¸…é™¤ `error_message`
- `handleReExecute`ï¼šæ›´æ–° `started_at` ä¸ºå½“å‰æ—¶é—´ï¼ˆé‡æ–°æ‰§è¡Œéœ€è¦é‡ç½®å¼€å§‹æ—¶é—´ï¼‰

---

