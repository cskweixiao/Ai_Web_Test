# Ai Web Test 系统需求文档
## Axure 原型自动生成测试用例功能（V2.0）

---

**文档信息**

| 项目 | 内容 |
|------|------|
| 文档版本 | V2.0 |
| 创建日期 | 2025-01-20 |
| 更新日期 | 2025-01-20 |
| 系统名称 | Ai Web Test - 企业级自动化测试平台 |
| 所属模块 | 测试用例管理模块 |
| 需求优先级 | 高 |
| 预计工期 | 3-4 周 |

---

## 目录

1. [需求概述](#1-需求概述)
2. [功能架构](#2-功能架构)
3. [页面设计](#3-页面设计)
4. [详细功能设计](#4-详细功能设计)
5. [数据字典](#5-数据字典)
6. [接口设计](#6-接口设计)
7. [非功能性需求](#7-非功能性需求)
8. [测试计划](#8-测试计划)
9. [上线计划](#9-上线计划)
10. [风险与应对](#10-风险与应对)

---

## 1. 需求概述

### 1.1 背景

目前 Ai Web Test 系统已经具备以下功能：
- **UI 自动化测试用例**的创建、编辑、管理
- 基于 Playwright + MCP 的 UI 自动化测试执行

但用户反馈：**编写功能测试用例仍然耗时较长**，尤其是在新项目启动阶段，需要根据产品原型编写大量功能测试用例。现有的 UI 自动化测试用例主要针对自动化执行，而功能测试用例更侧重于手工测试的指导。

### 1.2 目标

新增 **"功能测试用例 AI 生成器"** 功能，通过 AI 技术，将 Axure 导出的 HTML 原型自动转换为结构化的功能测试用例，大幅提升测试用例编写效率。

**与 UI 自动化测试用例的区别**：
- **UI 自动化测试用例**：用于 Playwright 自动化执行
- **功能测试用例**：用于手工测试指导，由 AI 生成器创建

### 1.3 价值

- **效率提升**：原本需要 1-2 天手工编写的测试用例，现在可以在 10-20 分钟内生成
- **质量保证**：AI 自动识别正常流程、异常流程、边界场景，覆盖更全面
- **降低门槛**：测试人员无需深入理解技术细节，上传原型即可生成用例
- **标准化**：生成的测试用例格式统一，符合团队规范
- **可控性强**：分批生成、增量修改，用户完全掌控生成过程

### 1.4 用户角色

- **主要用户**：测试工程师、QA 工程师
- **次要用户**：产品经理（想提前了解测试覆盖范围）、开发工程师（了解测试场景）

---

## 2. 功能架构

### 2.1 系统架构

```
┌─────────────────────────────────────────────┐
│           Ai Web Test 测试平台                  │
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  🤖 UI 自动化测试用例（原有）        │   │
│  │  - Playwright + MCP 执行            │   │
│  │  - 数据存储：ui_test_case 表        │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📝 功能测试用例（新增）             │   │
│  │                                     │   │
│  │  ┌───────────────────────────────┐ │   │
│  │  │ 📋 用例列表（正式库）          │ │   │
│  │  │ - 查看已保存的用例             │ │   │
│  │  │ - 管理和手工测试               │ │   │
│  │  │ - 数据存储：数据库             │ │   │
│  │  └───────────────────────────────┘ │   │
│  │           ↑                         │   │
│  │           │ 保存                     │   │
│  │           │                         │   │
│  │  ┌───────────────────────────────┐ │   │
│  │  │ 🎨 AI 生成器（草稿箱）         │ │   │
│  │  │ - 上传 Axure 原型              │ │   │
│  │  │ - 生成和审核需求文档           │ │   │
│  │  │ - 分批生成测试用例             │ │   │
│  │  │ - 审核和编辑用例               │ │   │
│  │  │ - 数据存储：前端缓存           │ │   │
│  │  └───────────────────────────────┘ │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

### 2.2 核心设计理念

**草稿箱 + 正式库的分离设计**

1. **草稿箱**（AI 生成器页面）
   - 用途：生成、审核、编辑测试用例
   - 数据：临时存储（前端 State / LocalStorage）
   - 特点：可以随意修改、删除，不影响正式库

2. **正式库**（用例列表页面）
   - 用途：管理已发布的测试用例
   - 数据：持久化到数据库
   - 特点：经过审核的正式用例，可用于测试执行

### 2.3 菜单结构

```
Ai Web Test 系统
├── 📊 仪表板
│
├── 🤖 UI自动化测试用例 ← 原来的"测试用例"，改名
│   ├── 📋 用例列表（/ui-test-cases）
│   └── ...
│
├── 📝 功能测试用例 ← 新增菜单！
│   ├── 📋 用例列表（/functional-test-cases）← AI生成的用例保存在这里
│   └── 🎨 AI 生成器（/functional-test-cases/generator）← 新增！
│
├── 🧪 测试套件
├── 📈 测试运行
└── ⚙️ 设置
```

**说明**：
- **UI自动化测试用例**：原来的测试用例模块，基于 Playwright + MCP 执行
- **功能测试用例**：新增模块，从 AI 生成器保存的用例存放在这里
- **AI批量修改**：不是独立菜单，而是用例列表页面的一个功能按钮

---

## 3. 页面设计

### 3.1 页面列表

| 页面名称 | 路由 | 功能说明 | 数据存储 |
|---------|------|---------|---------|
| **UI自动化测试用例列表** | /ui-test-cases | 查看和管理UI自动化测试用例（原有功能） | 数据库 |
| **功能测试用例列表** | /functional-test-cases | 查看和管理功能测试用例（AI生成的） | 数据库 |
| **AI 生成器** | /functional-test-cases/generator | 完整的生成流程（上传→需求→用例→保存） | 前端缓存 |

### 3.2 页面关系

```
用户点击"功能测试用例 > AI 生成器"菜单
    ↓
进入 AI 生成器页面（/functional-test-cases/generator）
    ↓
完成生成和审核流程
    ↓
点击"保存到用例库"
    ↓
数据保存到数据库（functional_test_case 表）
    ↓
跳转到功能测试用例列表页面（/functional-test-cases）
    ↓
查看新保存的用例
```

---

## 4. 详细功能设计

### 4.1 AI 生成器页面（核心功能）

#### 4.1.1 页面概述

**路由**：`/functional-test-cases/generator`

**功能**：单页面完成从上传 Axure 到保存功能测试用例的全流程

**数据存储**：前端 State 管理 + LocalStorage 缓存（可选）

**页面结构**：
```
┌─────────────────────────────────────────────┐
│ 🎨 AI 测试用例生成器                         │
├─────────────────────────────────────────────┤
│                                             │
│ [1.上传原型] [2.需求文档] [3.生成用例]      │
│      ↑ 当前步骤                              │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │                                     │   │
│ │     当前步骤的内容区                 │   │
│ │     （Tab 或步骤切换）                │   │
│ │                                     │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ [< 上一步] [保存草稿] [下一步 >]             │
│                                             │
└─────────────────────────────────────────────┘
```

---

### 4.2 步骤一：上传 Axure 原型

#### 4.2.1 功能描述

用户上传 Axure 导出的 HTML 文件，并可选填写项目背景信息，系统解析文件为后续生成提供数据基础。

#### 4.2.2 用户故事

**作为** 测试工程师  
**我想要** 上传 Axure 原型文件并补充项目信息  
**以便** AI 能够更准确地生成测试用例

#### 4.2.3 界面设计

```
┌─────────────────────────────────────────────┐
│ ● 1.上传原型  ○ 2.需求文档  ○ 3.生成用例    │
├─────────────────────────────────────────────┤
│                                             │
│ 📤 上传 Axure 原型文件                       │
│ ┌─────────────────────────────────────┐   │
│ │                                     │   │
│ │      拖拽文件到此处或点击上传         │   │
│ │                                     │   │
│ │   支持格式：.html, .htm             │   │
│ │   文件大小：< 50MB                   │   │
│ │                                     │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ 💡 补充项目信息（可选，提升生成质量）：       │
│ ┌─────────────────────────────────────┐   │
│ │ 项目名称：                           │   │
│ │ [电商后台管理系统           ]       │   │
│ │                                     │   │
│ │ 系统类型：                           │   │
│ │ ( ) 2C 面向用户  (●) 2B 面向企业    │   │
│ │ ( ) 内部系统     ( ) 开放平台       │   │
│ │                                     │   │
│ │ 业务领域：                           │   │
│ │ [电商/零售                  ]       │   │
│ │                                     │   │
│ │ 关键业务规则（可选）：               │   │
│ │ ┌─────────────────────────────┐    │   │
│ │ │ - 订单金额超过1000需审批      │    │   │
│ │ │ - 库存不足时不能下单          │    │   │
│ │ │ - VIP用户享受折扣            │    │   │
│ │ └─────────────────────────────┘    │   │
│ │                                     │   │
│ │ 特殊约束（可选）：                   │   │
│ │ ┌─────────────────────────────┐    │   │
│ │ │ - 必须符合GDPR合规要求        │    │   │
│ │ │ - 支持多语言                  │    │   │
│ │ └─────────────────────────────┘    │   │
│ │                                     │   │
│ │ 补充说明（自由文本）：               │   │
│ │ ┌─────────────────────────────┐    │   │
│ │ │ 这是一个B2B电商平台的后台...  │    │   │
│ │ │                             │    │   │
│ │ └─────────────────────────────┘    │   │
│ │                                     │   │
│ │ [保存] [跳过]                       │   │
│ └─────────────────────────────────────┘   │
│                                             │
│              [开始解析 →]                    │
│                                             │
└─────────────────────────────────────────────┘
```

#### 4.2.4 正常流程

1. 用户进入 AI 生成器页面
2. 系统显示上传界面（步骤 1）
3. 用户拖拽或点击上传 Axure HTML 文件
4. 系统显示文件信息（文件名、大小）
5. 用户可选填写项目背景信息
   - 项目名称
   - 系统类型（单选）
   - 业务领域
   - 关键业务规则（多行文本）
   - 特殊约束（多行文本）
   - 补充说明（自由文本）
6. 用户点击"开始解析"按钮
7. 系统显示解析进度：
   ```
   ⏳ 正在解析 Axure 文件...
   
   ✓ 解析页面结构...
   ✓ 提取页面元素...
   ✓ 识别交互行为...
   ⏳ 准备生成需求文档...
   
   进度：75%
   ```
8. 解析完成后显示统计信息：
   ```
   ✓ 解析完成
   
   识别结果：
   - 页面数量：3 个
   - 元素数量：25 个
   - 交互数量：10 个
   ```
9. 自动进入步骤 2（生成需求文档）

#### 4.2.5 异常流程

**场景 1：文件格式错误**
- 提示：❌ 只支持 HTML 文件（.html, .htm）
- 用户需要重新选择

**场景 2：文件过大**
- 提示：❌ 文件大小超过限制（最大 50MB）
- 建议用户优化 Axure 导出设置

**场景 3：文件内容无效**
- 提示：❌ 无法识别的文件格式，请确保是 Axure 导出的 HTML 文件
- 用户需要检查文件

**场景 4：解析超时**
- 超过 5 分钟提示：⏰ 解析耗时较长，请稍后重试或联系管理员

**场景 5：网络中断**
- 提示：❌ 网络连接中断，请检查网络后重试

#### 4.2.6 业务规则

- 支持的文件格式：.html、.htm
- 文件大小限制：50MB
- 解析超时时间：5 分钟
- 项目信息为可选填写，但强烈建议填写以提升生成质量
- 解析结果缓存 1 小时

#### 4.2.7 技术要点

**后端解析逻辑**：
- 使用 cheerio 解析 HTML DOM
- 识别 Axure 特有属性（data-*）
- 提取元素的 id、name、placeholder、label
- 解析 onclick、onsubmit 等事件
- 识别页面跳转关系

**项目信息的使用**：
- 传递给 AI 作为额外上下文
- 帮助 AI 更准确理解业务场景
- 生成更符合实际的测试用例

---

### 4.3 步骤二：生成和审核需求文档

#### 4.3.1 功能描述

基于 Axure 解析结果和用户填写的项目信息，AI 自动生成结构化的需求文档，用户可以审核和编辑。

#### 4.3.2 用户故事

**作为** 测试工程师  
**我想要** 审核 AI 生成的需求文档并补充完善  
**以便** 确保后续生成的测试用例基于准确的需求

#### 4.3.3 界面设计

```
┌─────────────────────────────────────────────┐
│ ✓ 1.上传原型  ● 2.需求文档  ○ 3.生成用例    │
├─────────────────────────────────────────────┤
│                                             │
│ 📋 AI 生成的需求文档                         │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 📊 完整度评估                        │   │
│ │                                     │   │
│ │ ✅ 正常流程：完整                    │   │
│ │ ⚠️ 异常流程：较完整（3个场景）        │   │
│ │ ⚠️ 业务规则：可能不完整              │   │
│ │ ⚠️ 边界条件：需要补充                │   │
│ │                                     │   │
│ │ 整体完整度：75%                      │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ 💡 AI 建议补充以下内容：                     │
│ ┌─────────────────────────────────────┐   │
│ │ 1. 密码错误次数限制规则               │   │
│ │    [点击补充] [忽略]                 │   │
│ │                                     │   │
│ │ 2. Session 过期后的处理逻辑          │   │
│ │    [点击补充] [忽略]                 │   │
│ │                                     │   │
│ │ 3. 网络异常时的重试策略              │   │
│ │    [点击补充] [忽略]                 │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ─────────────────────────────────────────  │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 需求文档内容（可编辑）                │   │
│ │                                     │   │
│ │ # 电商系统需求文档                   │   │
│ │                                     │   │
│ │ ## 1. 用户管理模块                   │   │
│ │                                     │   │
│ │ ### 1.1 用户登录功能                 │   │
│ │                                     │   │
│ │ **功能描述**                         │   │
│ │ 用户通过用户名和密码登录系统...       │   │
│ │                                     │   │
│ │ **正常流程**                         │   │
│ │ 1. 打开登录页面                     │   │
│ │ 2. 输入用户名和密码                 │   │
│ │ 3. 点击登录按钮                     │   │
│ │ 4. 验证通过，跳转到首页             │   │
│ │                                     │   │
│ │ **异常流程**                         │   │
│ │ - 密码错误：显示错误提示             │   │
│ │ - 账号不存在：提示用户注册           │   │
│ │ ⚠️ 建议补充：连续错误5次锁定？        │   │
│ │                                     │   │
│ │ **业务规则**                         │   │
│ │ - 用户名必须是邮箱格式               │   │
│ │ - 密码长度 8-20 位                  │   │
│ │ ...                                 │   │
│ │                                     │   │
│ │ （继续滚动查看更多内容）             │   │
│ │                                     │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ [✏️ 编辑模式] [👁️ 预览模式] ← 切换按钮      │
│                                             │
│ [< 返回]              [生成测试用例 →]      │
│                                             │
└─────────────────────────────────────────────┘
```

#### 4.3.4 正常流程

1. 系统完成 Axure 解析后，自动开始生成需求文档
2. 显示生成进度：
   ```
   🤖 AI 正在分析需求并生成文档...
   
   ✓ 分析页面结构
   ✓ 推断业务流程
   ⏳ 生成用户故事
   ⏳ 识别异常场景
   
   进度：60%
   ```
3. AI 调用大语言模型处理：
   - 将页面元素分组为功能模块
   - 从交互行为推断操作流程
   - 结合用户提供的业务规则
   - 识别正常和异常流程
   - 生成用户故事和验收标准
4. 生成完成后，显示需求文档
5. 顶部显示完整度评估：
   - 正常流程：完整 ✅
   - 异常流程：较完整 ⚠️
   - 业务规则：可能不完整 ⚠️
   - 整体完整度：75%
6. AI 主动标注可能遗漏的内容，并建议补充
7. 文档以 Markdown 格式展示，用户可以：
   - 直接阅读（预览模式）
   - 切换到编辑模式进行修改
   - 点击 AI 建议的补充项快速添加内容
8. 用户审核完毕后，点击"生成测试用例"进入步骤 3

#### 4.3.5 异常流程

**场景 1：AI 生成失败**
- 提示：❌ 生成需求文档失败，请稍后重试
- 提供"重新生成"按钮
- 或"跳过此步，直接生成测试用例"选项

**场景 2：生成的文档质量不佳**
- 用户可以切换到编辑模式手动修正
- 或点击"返回"重新上传文件

**场景 3：用户编辑时误操作**
- 提供"撤销"功能（Ctrl+Z）
- 提供"重置"按钮恢复到 AI 原始版本

**场景 4：需求文档为空**
- 提示：⚠️ 未识别到有效的功能信息，请检查 Axure 文件
- 用户可以返回重新上传，或手动编写需求文档

#### 4.3.6 业务规则

- 需求文档生成基于 AI 大语言模型（Claude 3.5 Sonnet 或 GPT-4）
- 生成超时时间：30 秒
- 用户可以无限次编辑需求文档
- 编辑的文档实时保存到前端 State
- 可选持久化到 LocalStorage（防止意外关闭页面）

#### 4.3.7 AI Prompt 设计要点

**核心 Prompt 结构**：
```
你是专业的产品经理和需求分析师。

【项目背景】
项目名称：${projectName}
系统类型：${systemType}
业务领域：${businessDomain}
业务规则：${businessRules}
特殊约束：${constraints}

【Axure 原型信息】
${axureData}

【任务】
生成结构化的产品需求文档，包含：
1. 功能模块划分
2. 每个功能的：功能描述、用户故事、正常流程、异常流程、业务规则
3. 标注可能遗漏的内容

【输出格式】
Markdown 格式，结构清晰
```

---

### 4.4 步骤三：分批生成和审核测试用例（核心功能）

#### 4.4.1 功能描述

基于需求文档，AI 分批生成测试用例到"草稿箱"，用户可以审核、编辑、删除、重新生成，支持指定修改某几个用例，避免 LLM Token 限制导致输出不全。

#### 4.4.2 用户故事

**作为** 测试工程师  
**我想要** AI 分批生成测试用例，并能灵活地审核和修改  
**以便** 确保用例质量，避免一次性生成过多导致输出不全或质量下降

#### 4.4.3 核心设计理念

**分批生成 + 草稿箱 + 增量修改**

1. **分批生成**：每批生成 3-5 个用例，避免 Token 限制
2. **草稿箱**：生成的用例先放在草稿箱，可以随意编辑删除
3. **增量修改**：选中某几个用例，单独重新生成或优化
4. **流式输出**：实时显示生成进度，可以随时暂停
5. **智能追加**：用户可以追加生成更多场景

#### 4.4.4 界面设计

```
┌─────────────────────────────────────────────┐
│ ✓ 1.上传原型  ✓ 2.需求文档  ● 3.生成用例    │
├─────────────────────────────────────────────┤
│                                             │
│ 📊 生成计划与进度                            │
│ ┌─────────────────────────────────────┐   │
│ │ 预计场景：15 个                      │   │
│ │ 草稿箱：8 个（待审核）               │   │
│ │                                     │   │
│ │ 批次进度：                           │   │
│ │ ✓ 第1批：正常流程（5/5）              │   │
│ │ ● 第2批：异常流程（3/5）              │   │
│ │ ○ 第3批：边界条件（0/5）              │   │
│ │                                     │   │
│ │ [继续生成下一批] [暂停]              │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ─────────────────────────────────────────  │
│                                             │
│ 📦 草稿箱（生成的用例，可编辑）              │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 第 1 批：正常流程 ✓ 已完成            │   │
│ │                                     │   │
│ │ ☑ [#1] 用户登录 - 正常流程           │   │
│ │     系统：电商  优先级：高           │   │
│ │     步骤：4步  验证点：3个           │   │
│ │     [✏️ 编辑] [🔄 重新生成] [🗑️ 删除]  │   │
│ │                                     │   │
│ │ ☑ [#2] 提交订单 - 正常流程           │   │
│ │     系统：电商  优先级：高           │   │
│ │     步骤：6步  验证点：4个           │   │
│ │     [✏️ 编辑] [🔄 重新生成] [🗑️ 删除]  │   │
│ │                                     │   │
│ │ ☑ [#3] 查看订单列表                  │   │
│ │ ☑ [#4] 修改收货地址                  │   │
│ │ ☑ [#5] 取消订单                      │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 第 2 批：异常流程 ⏳ 生成中...        │   │
│ │                                     │   │
│ │ ☑ [#6] 用户登录 - 密码错误           │   │
│ │ ☑ [#7] 提交订单 - 库存不足           │   │
│ │ ☑ [#8] 支付失败 - 订单回滚           │   │
│ │ ⏳ [#9] 正在生成...                  │   │
│ │     步骤：1. 打开订单页面...         │   │
│ │           2. 选择█                   │   │
│ │                                     │   │
│ │ [⏸️ 暂停生成] [⏹️ 停止]              │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ─────────────────────────────────────────  │
│                                             │
│ 💡 批量操作（已选中 3 个用例）               │
│ ┌─────────────────────────────────────┐   │
│ │ 告诉 AI 如何改进（可选）：            │   │
│ │ ┌─────────────────────────────┐    │   │
│ │ │ 把验证点写得更详细，至少5个    │    │   │
│ │ └─────────────────────────────┘    │   │
│ │                                     │   │
│ │ [🔄 重新生成选中的] [✨ 优化选中的]   │   │
│ │ [🗑️ 删除选中的] [取消选择]           │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ─────────────────────────────────────────  │
│                                             │
│ 💡 需要更多用例？快速追加：                  │
│ [生成更多异常场景] [生成边界条件测试]       │
│ [生成性能测试] [自定义场景...]              │
│                                             │
│ ─────────────────────────────────────────  │
│                                             │
│ [< 返回修改需求]  [💾 保存到用例库 (8)]     │
│                                             │
└─────────────────────────────────────────────┘
```

#### 4.4.5 详细流程

**第一步：AI 规划分批策略**

1. AI 分析需求文档，识别所有测试场景
2. 按优先级分组：
   - 第 1 批：正常流程（5 个场景）
   - 第 2 批：异常流程（5 个场景）
   - 第 3 批：边界条件（5 个场景）
3. 显示生成计划，用户确认

**第二步：开始分批生成**

1. 生成第 1 批（正常流程）
2. 流式输出，实时显示每个用例的生成过程
3. 用户可以随时暂停或停止
4. 第 1 批生成完成后：
   - 显示 5 个用例在草稿箱
   - 用户审核：满意、需要修改、删除
   - 用户决定是否继续下一批

**第三步：用户审核和调整**

用户可以对草稿箱中的用例进行：

1. **单个用例操作**
   - 编辑：修改名称、描述、步骤、验证点
   - 重新生成：AI 重新生成这一个用例
   - 删除：从草稿箱移除

2. **批量操作**
   - 选中多个用例（勾选框）
   - 输入优化要求（可选）
   - 批量重新生成或优化
   - 批量删除

3. **智能追加**
   - 点击"生成更多异常场景"
   - 或输入自定义场景描述
   - AI 追加生成 3-5 个用例

**第四步：继续下一批**

1. 用户对第 1 批满意后，点击"继续生成下一批"
2. AI 生成第 2 批（异常流程）
3. 重复审核和调整流程
4. 直到所有批次生成完成

**第五步：保存到用例库**

1. 用户选中满意的用例（勾选框）
2. 点击"保存到用例库 (X)"按钮
3. 系统弹窗确认
4. 批量保存到数据库
5. 跳转到用例列表页面

#### 4.4.6 分批生成策略

**批次规划**：

| 批次 | 场景类型 | 优先级 | 说明 |
|-----|---------|--------|------|
| 第 1 批 | 正常流程 | 最高 | 核心功能的正常操作路径 |
| 第 2 批 | 异常流程 | 高 | 常见的错误场景和异常处理 |
| 第 3 批 | 边界条件 | 中 | 边界值、空值、极值测试 |
| 第 4 批 | 权限控制 | 中 | 不同角色和权限的测试 |
| 第 5 批 | 性能/兼容 | 低 | 并发、兼容性、性能测试 |

**批次说明**：
- 根据需求文档的复杂度，AI 自动规划批次数量和每批的场景数量
- 简单需求：3 批，每批 3-5 个场景
- 中等需求：5 批，每批 5-8 个场景  
- 复杂需求：8 批以上，每批 8-10 个场景
- **不限制总用例数量**，根据实际需求生成
- 用户可以随时停止，不必生成完所有批次

#### 4.4.7 增量修改功能

**单个用例重新生成**：

1. 用户点击某个用例的"🔄 重新生成"按钮
2. AI 只重新生成这一个用例
3. 其他用例保持不变
4. 新版本替换旧版本

**批量重新生成**：

1. 用户勾选多个用例（如 3 个）
2. 输入优化要求（可选）：
   - 例如："把验证点写得更详细，至少 5 个"
   - 例如："增加边界条件测试"
3. 点击"重新生成选中的"
4. AI 只重新生成这 3 个用例
5. 其他用例不受影响

**定向优化**：

1. 用户选中用例
2. 点击"✨ 优化选中的"
3. AI 在现有基础上增强：
   - 补充更多验证点
   - 添加更详细的步骤
   - 增加前置条件说明

#### 4.4.8 智能追加生成

**快速追加**：

提供常见场景的快捷按钮：
- "生成更多异常场景"：追加 3-5 个异常流程用例
- "生成边界条件测试"：追加 3-5 个边界值测试用例
- "生成性能测试"：追加 3-5 个性能相关用例

**自定义追加**：

1. 用户输入场景描述
   - 例如："密码过期强制修改"
   - 例如："多设备并发登录"
2. AI 根据描述生成 1-3 个相关用例
3. 追加到草稿箱

#### 4.4.9 流式输出

**实时显示生成进度**：

```
⏳ 正在生成第 2 批用例...

✓ [#6] 用户登录 - 密码错误
✓ [#7] 提交订单 - 库存不足
✓ [#8] 支付失败 - 订单回滚
⏳ [#9] 取消订单 - 订单已完成
   步骤：
   1. 打开订单详情页
   2. 点击"取消订单"按钮
   3. 系统显示█

进度：3/5 个用例

[⏸️ 暂停] [⏹️ 停止]
```

**用户可以**：
- 实时看到每个用例的生成过程
- 看到已生成的步骤内容
- 随时暂停或停止生成
- 停止后保存已生成的用例

#### 4.4.10 异常流程

**场景 1：AI 生成失败**
- 提示：❌ 生成用例失败，请稍后重试
- 提供"重新生成当前批次"按钮
- 已生成的用例不受影响

**场景 2：生成的用例质量不佳**
- 用户选中质量差的用例
- 输入优化要求
- 重新生成这些用例

**场景 3：用户取消了所有用例**
- 提示：⚠️ 请至少选择一个用例
- 用户需要重新勾选

**场景 4：生成中途网络中断**
- 提示：❌ 网络连接中断
- 已生成的用例保存在草稿箱
- 用户可以重新生成未完成的批次

#### 4.4.11 业务规则

**生成规则**：
- 每批生成 3-5 个用例
- 最多支持 10 批（总共 50 个用例）
- 单个批次生成超时：60 秒
- 支持暂停、继续、停止

**草稿箱规则**：
- 草稿箱数据存储在前端 State
- 可选缓存到 LocalStorage（防止页面刷新丢失）
- 缓存有效期：24 小时
- 用户可以随时编辑、删除草稿

**保存规则**：
- 只保存选中的用例
- 未选中的用例不会保存到数据库
- 保存后草稿箱清空

**用例字段**：
- 用例名称（必填）
- 用例描述
- 测试步骤（必填）
- 验证点（必填）
- 所属系统
- 所属模块
- 优先级（自动判断）
- 标签（自动生成）

#### 4.4.12 AI Prompt 设计要点

**分批规划 Prompt**：
```
分析需求文档，规划测试用例生成计划。

需求文档：${requirementDoc}

任务：
1. 识别所有测试场景
2. 按优先级分组（正常流程 > 异常流程 > 边界条件 > 性能）
3. 每组不超过 5 个场景
4. 返回分批计划

输出：JSON 格式的分批计划
```

**单批生成 Prompt**：
```
生成本批次的测试用例。

需求文档：${requirementDoc}
本批场景：${scenarios}
已生成用例：${existingTests}（避免重复）

要求：
1. 每个场景生成 1 个详细用例
2. 步骤具体可执行
3. 验证点明确可检查
4. 必须生成 ${count} 个用例

输出：JSON 数组
```

**重新生成 Prompt**：
```
重新生成指定的测试用例。

原用例：${originalTest}
用户要求：${instruction}
需求文档：${requirementDoc}

任务：按照用户要求改进用例

输出：JSON 格式的新用例
```

---

### 4.5 保存到用例库

#### 4.5.1 功能描述

用户审核满意后，将选中的测试用例批量保存到数据库，成为正式的测试用例。

#### 4.5.2 用户故事

**作为** 测试工程师  
**我想要** 将审核通过的测试用例保存到正式用例库  
**以便** 可以在后续的测试工作中使用这些用例

#### 4.5.3 界面设计

**保存确认弹窗**：

```
┌─────────────────────────────────────────────┐
│ 💾 保存到功能测试用例库                      │
├─────────────────────────────────────────────┤
│                                             │
│ 您即将保存以下用例到功能测试用例库：          │
│                                             │
│ ✓ 选中的用例：7 个                           │
│ ✓ 目标位置：功能测试用例                     │
│ ✓ 目标系统：电商系统                         │
│ ✓ 目标模块：用户管理                         │
│ ✓ 创建者：张三                               │
│ ✓ 状态：已发布（PUBLISHED）                  │
│ ✓ 来源：AI 生成                              │
│                                             │
│ 保存后：                                     │
│ • 这些用例将出现在"功能测试用例列表"页面      │
│ • 可以被测试套件引用                         │
│ • 可以执行手工测试                           │
│ • 草稿箱中的用例将被清空                     │
│                                             │
│ ⚠️ 未选中的 3 个用例将被丢弃                  │
│                                             │
│ 是否继续？                                   │
│                                             │
│        [取消]        [确认保存]              │
│                                             │
└─────────────────────────────────────────────┘
```

**保存成功提示**：

```
┌─────────────────────────────────────────────┐
│ ✅ 保存成功！                                │
├─────────────────────────────────────────────┤
│                                             │
│ 已成功保存 7 个测试用例到功能测试用例库      │
│                                             │
│ 📊 本次生成统计：                            │
│ • 上传文件：login_flow.html                 │
│ • 识别页面：3 个                             │
│ • 解析元素：25 个                            │
│ • 生成用例：10 个                            │
│ • 保存用例：7 个                             │
│ • 删除用例：3 个                             │
│                                             │
│ 接下来您可以：                               │
│ [查看已保存的用例] [继续生成更多] [返回首页]  │
│                                             │
└─────────────────────────────────────────────┘

// 3 秒后自动跳转到功能测试用例列表页面
```

#### 4.5.4 正常流程

1. 用户在草稿箱中选中满意的用例（勾选框）
2. 点击"保存到用例库 (X)"按钮
3. 系统弹出确认对话框
4. 显示保存信息：
   - 选中数量
   - 目标系统和模块
   - 创建者
   - 保存后的状态
5. 用户确认无误，点击"确认保存"
6. 按钮变为 Loading 状态："保存中..."
7. 调用后端 API 批量保存
8. 后端验证并插入数据库
9. 返回成功响应
10. 显示成功提示和统计信息
11. 3 秒后自动跳转到"用例列表"页面
12. 草稿箱清空

#### 4.5.5 异常流程

**场景 1：未选中任何用例**
- 提示：⚠️ 请至少选择一个用例
- 禁用"保存"按钮

**场景 2：网络请求失败**
- 提示：❌ 保存失败，请检查网络连接
- 按钮恢复可点击状态
- 用户可以重新保存
- 草稿箱数据不丢失

**场景 3：数据库插入失败**
- 提示：❌ 保存失败：数据库错误
- 用户可以重试或联系管理员

**场景 4：部分用例保存失败**
- 提示：⚠️ 部分用例保存失败（成功 5 个，失败 2 个）
- 显示失败的用例名称
- 用户可以重新保存失败的用例

#### 4.5.6 业务规则

- 只保存 `selected: true` 的用例
- 用例的 `status` 设置为 `PUBLISHED`
- 用例的 `source` 设置为 `AI_GENERATED`
- 用例的 `creatorId` 设置为当前用户 ID
- 用例的 `ai_session_id` 记录本次生成的批次 ID
- 标签数组转换为逗号分隔的字符串
- 批量插入使用事务，确保原子性

#### 4.5.7 技术要点

**后端 API**：
```
POST /api/v1/test-cases/batch-save

Request Body:
{
  "testCases": [
    {
      "name": "用户登录 - 正常流程",
      "description": "...",
      "steps": "1. ...\n2. ...",
      "assertions": "- ...\n- ...",
      "system": "电商系统",
      "module": "用户管理",
      "priority": "high",
      "tags": ["登录", "认证"]
    },
    ...
  ],
  "aiSessionId": "uuid-xxx"
}

Response:
{
  "success": true,
  "data": {
    "savedCount": 7,
    "failedCount": 0,
    "testCaseIds": [101, 102, 103, ...]
  }
}
```

**数据库操作**：
- 使用 Prisma 的 `createMany` 批量插入
- 使用事务确保一致性
- 记录操作日志

---

### 4.6 功能测试用例列表页面（正式库）

#### 4.6.1 功能描述

查看和管理所有已保存的功能测试用例，包括手动创建的和 AI 生成的。

#### 4.6.2 界面设计

```
┌─────────────────────────────────────────────┐
│ 📋 功能测试用例管理                          │
├─────────────────────────────────────────────┤
│                                             │
│ [🔍 搜索用例] [📊 筛选]                      │
│                                             │
│ [+ 创建用例] [🎨 AI生成器] [🤖 批量修改]    │
│                                             │
│ ✅ 刚刚从 AI 生成器保存了 7 个新用例          │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 🆕 [#101] 用户登录 - 正常流程        │   │ ← 新保存的
│ │ 系统：电商  模块：用户管理           │   │
│ │ 优先级：高  来源：AI生成             │   │
│ │ 创建者：张三  2024-01-20            │   │
│ │ [查看] [编辑] [添加到套件]          │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ 🆕 [#102] 用户登录 - 密码错误        │   │ ← 新保存的
│ │ 系统：电商  模块：用户管理           │   │
│ │ 优先级：高  来源：AI生成             │   │
│ │ [查看] [编辑] [添加到套件]          │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ ┌─────────────────────────────────────┐   │
│ │ [#100] 其他旧用例                    │   │
│ │ 系统：电商  模块：订单管理           │   │
│ │ 优先级：中  来源：手动创建           │   │
│ │ [查看] [编辑] [添加到套件]          │   │
│ └─────────────────────────────────────┘   │
│                                             │
│ [加载更多...]                               │
│                                             │
└─────────────────────────────────────────────┘
```

**说明**：
- **AI生成器**：按钮点击后跳转到 `/functional-test-cases/generator`
- **批量修改**：按钮点击后打开批量修改弹窗（已有功能），不是独立菜单
- 功能测试用例不支持"执行"操作（区别于UI自动化测试用例）

#### 4.6.3 关键功能

1. **新用例提示**
   - 保存成功后跳转到此页面
   - 顶部显示绿色提示条
   - 新保存的用例带 🆕 标识
   - 3 秒后提示自动消失

2. **用例筛选**
   - 按系统筛选
   - 按模块筛选
   - 按来源筛选（手动创建 / AI生成）
   - 按创建时间筛选

3. **用例操作**
   - 查看：查看用例详情
   - 编辑：修改用例内容
   - 添加到套件：加入测试套件
   - 批量修改：选中多个用例后批量修改（弹窗功能）

---

## 5. 数据字典

### 5.1 FunctionalTestCase 表（新增）

**说明**：存储功能测试用例，包括手动创建和 AI 生成的用例

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Int | ✓ | 主键，自增 |
| name | String(255) | ✓ | 测试用例名称 |
| description | Text |  | 用例描述 |
| steps | Text | ✓ | 测试步骤（换行分隔） |
| assertions | Text | ✓ | 验证点（换行分隔） |
| system | String(100) |  | 所属系统 |
| module | String(100) |  | 所属模块 |
| priority | Enum | ✓ | 优先级：LOW/MEDIUM/HIGH/CRITICAL |
| tags | String(500) |  | 标签（逗号分隔） |
| status | Enum | ✓ | 状态：DRAFT/PUBLISHED/ARCHIVED |
| source | Enum | ✓ | 来源：MANUAL/AI_GENERATED |
| ai_session_id | String(100) |  | AI生成批次ID（AI生成的用例必填） |
| creator_id | Int | ✓ | 创建者ID（关联 User 表） |
| test_type | String(50) |  | 测试类型：functional/smoke/regression |
| preconditions | Text |  | 前置条件 |
| test_data | Text |  | 测试数据 |
| created_at | DateTime | ✓ | 创建时间 |
| updated_at | DateTime | ✓ | 更新时间 |

### 5.2 UITestCase 表（原有，不变）

**说明**：存储 UI 自动化测试用例，基于 Playwright + MCP 执行

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Int | 主键 |
| name | String(255) | 用例名称 |
| ... | ... | 其他字段（原有结构） |

### 5.3 AIGenerationSession 表（新增）

**说明**：记录每次 AI 生成测试用例的会话信息

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | String(100) | ✓ | 主键，UUID |
| user_id | Int | ✓ | 用户ID |
| axure_filename | String(255) | ✓ | 上传的Axure文件名 |
| axure_file_size | Int | ✓ | 文件大小（字节） |
| project_name | String(255) |  | 项目名称 |
| system_type | String(50) |  | 系统类型：2C/2B/internal/platform |
| business_domain | String(100) |  | 业务领域 |
| requirement_doc | Text |  | 生成的需求文档 |
| page_count | Int | ✓ | 识别的页面数量 |
| element_count | Int | ✓ | 元素数量 |
| interaction_count | Int | ✓ | 交互数量 |
| total_generated | Int | ✓ | 生成的用例总数（不限制数量） |
| total_saved | Int | ✓ | 保存的用例数量 |
| batches | JSON |  | 分批信息（JSON数组） |
| created_at | DateTime | ✓ | 创建时间 |

### 5.4 草稿箱数据结构（前端）

**说明**：AI 生成器页面的前端数据结构

```typescript
interface DraftTestCase {
  id: string;              // 临时ID（前端生成）
  name: string;
  description: string;
  steps: string;
  assertions: string;
  system: string;
  module: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
  tags: string[];
  testType: string;
  batchNumber: number;     // 所属批次
  batchName: string;       // 批次名称（如"正常流程"）
  selected: boolean;       // 是否选中
  status: 'generating' | 'completed' | 'error';  // 生成状态
}

interface GeneratorState {
  // 步骤1数据
  axureFile: File | null;
  projectInfo: {
    projectName: string;
    systemType: string;
    businessDomain: string;
    businessRules: string[];
    constraints: string[];
    description: string;
  };
  
  // 步骤2数据
  requirementDoc: string;
  completeness: number;
  suggestions: string[];
  
  // 步骤3数据
  draftTestCases: DraftTestCase[];
  batches: Batch[];
  currentBatchIndex: number;
  selectedIds: string[];
  isGenerating: boolean;
  
  // 会话信息
  sessionId: string;
}
```

---

## 6. 接口设计

### 6.1 API 列表

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/axure/parse` | POST | 上传并解析 Axure HTML |
| `/api/v1/axure/generate-requirement` | POST | 生成需求文档 |
| `/api/v1/axure/ask-questions` | POST | AI 主动提问（可选） |
| `/api/v1/axure/plan-batches` | POST | 规划分批策略（不限制用例数量） |
| `/api/v1/axure/generate-batch` | POST | 生成单个批次的用例 |
| `/api/v1/axure/regenerate-cases` | POST | 重新生成指定用例 |
| `/api/v1/axure/optimize-cases` | POST | 优化指定用例 |
| `/api/v1/axure/supplement-generate` | POST | 追加生成用例 |
| `/api/v1/functional-test-cases/batch-save` | POST | 批量保存功能测试用例 |
| `/api/v1/functional-test-cases` | GET | 获取功能测试用例列表 |
| `/api/v1/ui-test-cases` | GET | 获取UI自动化测试用例列表 |

### 6.2 核心接口详情

#### 6.2.1 解析 Axure

```
POST /api/v1/axure/parse

Request:
- Content-Type: multipart/form-data
- Body:
  - file: File (Axure HTML)

Response:
{
  "success": true,
  "data": {
    "sessionId": "uuid-xxx",
    "pageCount": 3,
    "elementCount": 25,
    "interactionCount": 10,
    "pages": [
      {
        "name": "登录页面",
        "url": "login.html",
        "elements": [...],
        "interactions": [...]
      }
    ]
  }
}
```

#### 6.2.2 生成需求文档

```
POST /api/v1/axure/generate-requirement

Request:
{
  "sessionId": "uuid-xxx",
  "axureData": {...},
  "projectInfo": {
    "projectName": "电商系统",
    "systemType": "2B",
    "businessDomain": "电商/零售",
    "businessRules": ["订单>1000需审批", ...],
    "constraints": ["符合GDPR", ...],
    "description": "..."
  }
}

Response:
{
  "success": true,
  "data": {
    "requirementDoc": "# 需求文档\n\n...",
    "completeness": 0.75,
    "suggestions": [
      "密码错误次数限制规则",
      "Session过期处理",
      ...
    ]
  }
}
```

#### 6.2.3 规划分批策略

```
POST /api/v1/axure/plan-batches

Request:
{
  "sessionId": "uuid-xxx",
  "requirementDoc": "..."
}

Response:
{
  "success": true,
  "data": {
    "batches": [
      {
        "id": "batch-1",
        "name": "正常流程",
        "priority": "high",
        "scenarios": [
          "用户登录 - 正确的用户名和密码",
          "提交订单 - 库存充足且地址完整",
          ...
        ],
        "estimatedCount": 5
      },
      {
        "id": "batch-2",
        "name": "异常流程",
        "scenarios": [...]
      }
    ],
    "totalScenarios": 15,
    "estimatedBatches": 3
  }
}
```

#### 6.2.4 生成单个批次

```
POST /api/v1/axure/generate-batch

Request:
{
  "sessionId": "uuid-xxx",
  "batchId": "batch-1",
  "scenarios": ["场景1", "场景2", ...],
  "requirementDoc": "...",
  "existingTests": [...]  // 已生成的用例（避免重复）
}

Response:
{
  "success": true,
  "data": {
    "testCases": [
      {
        "name": "用户登录 - 正常流程",
        "description": "...",
        "steps": "1. ...\n2. ...",
        "assertions": "- ...\n- ...",
        "priority": "high",
        "tags": ["登录", "认证"],
        "system": "电商系统",
        "module": "用户管理"
      },
      ...
    ]
  }
}
```

#### 6.2.5 重新生成指定用例

```
POST /api/v1/axure/regenerate-cases

Request:
{
  "sessionId": "uuid-xxx",
  "testCaseIds": ["temp-id-1", "temp-id-2"],
  "originalCases": [...],
  "instruction": "把验证点写得更详细，至少5个",  // 可选
  "requirementDoc": "..."
}

Response:
{
  "success": true,
  "data": {
    "testCases": [...]  // 重新生成的用例
  }
}
```

#### 6.2.6 批量保存功能测试用例

```
POST /api/v1/functional-test-cases/batch-save

Request:
{
  "testCases": [
    {
      "name": "用户登录 - 正常流程",
      "description": "...",
      "steps": "...",
      "assertions": "...",
      "system": "电商系统",
      "module": "用户管理",
      "priority": "high",
      "tags": ["登录", "认证"]
    },
    ...
  ],
  "aiSessionId": "uuid-xxx"
}

Response:
{
  "success": true,
  "data": {
    "savedCount": 7,
    "failedCount": 0,
    "testCaseIds": [101, 102, 103, ...]
  }
}
```

**说明**：保存到 `functional_test_case` 表

---

## 7. 非功能性需求

### 7.1 性能要求

| 操作 | 响应时间要求 | 说明 |
|------|-------------|------|
| 文件上传 | < 5 秒 | 10MB 文件 |
| Axure 解析 | < 30 秒 | 20 个页面 |
| 需求文档生成 | < 30 秒 | 单次调用 |
| 单批用例生成 | < 60 秒 | 生成 5 个用例 |
| 批量保存 | < 5 秒 | 保存 10 个用例 |
| 重新生成单个用例 | < 20 秒 | 单个用例 |

### 7.2 可用性要求

- 界面操作流畅，无明显卡顿
- 每个步骤都有清晰的进度提示
- 错误提示信息友好、具体、可操作
- 支持键盘快捷键（Esc 关闭弹窗、Ctrl+Z 撤销）
- 流式输出时实时显示进度
- 支持中途暂停和恢复

### 7.3 兼容性要求

- 支持主流浏览器：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- 支持桌面端和平板设备（1024px 宽度以上）
- 不支持移动端（屏幕太小）

### 7.4 安全性要求

- 上传的文件只保留 24 小时，自动清理
- AI API 调用使用环境变量配置密钥
- 用户只能保存自己创建的测试用例
- 批量操作有权限校验
- 敏感信息不记录到日志

### 7.5 可扩展性要求

- 架构设计支持未来扩展其他原型工具（Figma、墨刀）
- AI Prompt 可配置，便于后续优化
- 支持自定义测试用例模板（未来功能）
- 分批策略可配置（批次大小、批次数量）

### 7.6 数据完整性要求

- 草稿箱数据缓存到 LocalStorage，防止意外关闭页面
- 缓存有效期 24 小时
- 保存操作使用数据库事务，确保原子性
- 记录 AI 生成历史，便于追溯

---

## 8. 测试计划

### 8.1 单元测试

**后端**：
- Axure 解析器：测试各种 HTML 结构
- AI Prompt 生成：测试不同输入的输出质量
- 数据库操作：测试批量插入、事务回滚

**前端**：
- 组件功能测试
- State 管理测试
- LocalStorage 缓存测试

### 8.2 集成测试

- 完整流程测试：上传 → 需求 → 用例 → 保存
- 分批生成测试：测试多批次生成
- 增量修改测试：测试重新生成和优化
- 异常场景测试：网络中断、超时、格式错误
- 并发测试：多用户同时使用

### 8.3 用户验收测试（UAT）

- 邀请 3-5 名测试工程师试用
- 收集反馈：
  - 功能完整性
  - 易用性
  - 生成质量
  - 性能体验
- 根据反馈迭代优化

### 8.4 性能测试

- 大文件解析测试（50MB）
- 大批量生成测试（50 个用例）
- 并发用户测试（10 人同时使用）
- Token 限制测试（验证分批策略）

---

## 9. 上线计划

### 9.1 开发排期

| 阶段 | 任务 | 预计工期 |
|------|------|---------|
| **第一周** | 后端开发：解析器、AI 服务、核心 API | 5 天 |
| | - Axure 解析器 | 2 天 |
| | - AI Prompt 设计和调试 | 2 天 |
| | - 分批生成逻辑 | 1 天 |
| **第二周** | 前端开发：页面和组件 | 5 天 |
| | - AI 生成器页面框架 | 1 天 |
| | - 步骤1: 上传和项目信息 | 1 天 |
| | - 步骤2: 需求文档审核 | 1 天 |
| | - 步骤3: 用例生成和审核 | 2 天 |
| **第三周** | 功能完善和优化 | 5 天 |
| | - 增量修改功能 | 2 天 |
| | - 流式输出 | 1 天 |
| | - 缓存和状态管理 | 1 天 |
| | - UI/UX 优化 | 1 天 |
| **第四周** | 联调测试、Bug 修复 | 5 天 |
| | - 集成测试 | 2 天 |
| | - Bug 修复 | 2 天 |
| | - UAT 测试 | 1 天 |

### 9.2 上线前检查清单

- [ ] 所有单元测试通过
- [ ] 集成测试通过
- [ ] UAT 测试通过
- [ ] 性能测试达标
- [ ] 错误处理完善
- [ ] 日志记录完整
- [ ] 文档齐全（用户手册、技术文档）
- [ ] 数据库备份
- [ ] AI API 密钥配置
- [ ] 文件存储配置
- [ ] 监控告警配置

### 9.3 灰度发布

- **第一批**：内部测试团队（5 人，3 天）
- **第二批**：部分试点团队（20 人，1 周）
- **第三批**：全员开放

---

## 10. 风险与应对

### 10.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| AI 生成质量不稳定 | 中 | 高 | 优化 Prompt、提供编辑功能、收集反馈迭代 |
| LLM Token 限制 | 高 | 高 | 分批生成、增量修改、流式输出 |
| Axure 解析失败 | 低 | 中 | 提供友好错误提示、支持多种导出格式 |
| LLM API 限流/超时 | 中 | 中 | 实现重试机制、缓存结果、降级方案 |
| 大文件解析性能差 | 低 | 低 | 设置文件大小限制、异步处理 |

### 10.2 业务风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| 用户不会用 | 低 | 中 | 提供详细的使用说明、视频教程、新手引导 |
| 生成的用例不符合预期 | 中 | 中 | 强调审核环节、提供编辑功能、支持重新生成 |
| 用户依赖过度，不思考 | 低 | 低 | 提示 AI 只是辅助，需要人工审核 |
| 草稿箱数据丢失 | 低 | 中 | LocalStorage 缓存、定期提醒保存 |

### 10.3 成本风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| AI API 成本过高 | 中 | 中 | 监控调用量、优化 Prompt、设置用户配额 |
| 存储成本增加 | 低 | 低 | 定期清理临时文件、压缩存储 |

---

## 11. 后续优化方向

### 11.1 短期优化（1-2 个月）

1. **支持更多原型工具**
   - Figma 插件
   - 墨刀导出
   - 蓝湖集成

2. **增加测试用例模板库**
   - 登录功能模板
   - 支付功能模板
   - 权限控制模板

3. **优化 AI Prompt**
   - 收集用户反馈
   - A/B 测试不同 Prompt
   - 提升生成质量

4. **增加解析历史记录**
   - 查看历史生成记录
   - 恢复历史会话
   - 导出生成报告

### 11.2 长期优化（3-6 个月）

1. **版本管理**
   - 需求文档版本管理
   - 测试用例版本管理
   - 对比不同版本

2. **智能推荐**
   - 基于历史数据推荐用例
   - 推荐相似场景
   - 推荐最佳实践

3. **审批流程**
   - AI 生成的用例需要审批
   - 多级审批流程
   - 审批记录和追溯

4. **集成第三方工具**
   - JIRA 集成
   - 禅道集成
   - Confluence 集成

5. **AI 能力增强**
   - 图片识别（原型截图）
   - 语音输入（描述场景）
   - 自然语言查询用例

---

## 12. 附录

### 12.1 术语表

| 术语 | 说明 |
|------|------|
| Axure | 一款原型设计工具 |
| PRD | Product Requirements Document（产品需求文档） |
| LLM | Large Language Model（大语言模型） |
| UAT | User Acceptance Testing（用户验收测试） |
| Playwright | 浏览器自动化测试框架 |
| MCP | Model Context Protocol（模型上下文协议） |
| SSE | Server-Sent Events（服务器推送事件） |
| Token | LLM 的输入输出单位 |
| 草稿箱 | AI 生成器中的临时存储区域 |
| 正式库 | 已保存到数据库的测试用例 |

### 12.2 参考资料

- Axure 官方文档：https://docs.axure.com
- Playwright 文档：https://playwright.dev
- Claude API 文档：https://docs.anthropic.com
- React 文档：https://react.dev

### 12.3 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| V1.0 | 2025-01-20 | 初始版本 | - |
| V2.0 | 2025-01-20 | 重构设计：草稿箱+正式库分离、分批生成、增量修改 | - |

---

**文档结束**

审核人：__________  
审核日期：__________  
批准人：__________  
批准日期：__________
