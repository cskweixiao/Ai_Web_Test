# 预览按钮位置调整说明

## 🎯 更新内容

将预览按钮从页面底部移至文件列表中每个文件的右侧，支持预览指定的文件。

## 📸 功能演示

### 之前的设计
```
[文件列表]
  - file1.docx    [删除]
  - file2.pdf     [删除]
  - file3.html    [删除]

[预览文件内容] 按钮（页面底部，只能预览第一个主文件）
```

### 更新后的设计
```
[文件列表]
  - file1.docx    [预览] [删除]
  - file2.pdf     [预览] [删除]
  - file3.html    [预览] [删除]
  - file4.js      [删除]  （JS文件不显示预览按钮）
```

## ✨ 新特性

### 1. 每个文件独立预览
- ✅ 主文件（HTML/PDF/DOCX/Markdown/TXT）右侧显示"预览"按钮
- ✅ JS 辅助文件不显示预览按钮
- ✅ 点击任意文件的预览按钮，即可预览该文件内容

### 2. 智能文件过滤
只有支持预览的文件类型才显示预览按钮：
- ✅ HTML (.html, .htm)
- ✅ PDF (.pdf)
- ✅ DOCX (.docx)
- ✅ Markdown (.md, .markdown)
- ✅ TXT (.txt)
- ❌ JS (.js) - 不显示预览按钮

### 3. 按钮样式
- 蓝色主题按钮
- 带边框和图标
- Hover 效果
- 包含 tooltip 提示

## 🔧 技术实现

### 修改的文件

1. **MultiFileUpload.tsx**
   - 添加 `onPreviewFile` 回调参数
   - 在文件列表每项右侧添加预览按钮
   - 只对主文件显示预览按钮

2. **FunctionalTestCaseGenerator.tsx**
   - 修改 `handlePreviewFile` 函数，接受可选的 `file` 参数
   - 将预览回调传递给 MultiFileUpload 组件
   - 移除步骤底部的预览逻辑

### 代码片段

```tsx
// MultiFileUpload 组件中添加预览按钮
{item.status === 'valid' && 
 (item.type === 'html' || item.type === 'pdf' || item.type === 'docx' || 
  item.type === 'md' || item.type === 'txt') && 
 onPreviewFile && (
  <button
    onClick={(e) => {
      e.stopPropagation();
      onPreviewFile(item.file);
    }}
    className="ml-3 px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 
               hover:bg-blue-100 border border-blue-200 rounded-lg"
    title="预览文件内容"
  >
    <FileText className="w-3.5 h-3.5" />
    预览
  </button>
)}
```

## 📝 使用步骤

### 1. 上传多个文件
```
拖拽或选择多个文件到上传区
例如：
  - 需求文档.docx
  - 原型设计.html
  - 接口说明.md
  - 交互脚本.js
```

### 2. 预览指定文件
```
在文件列表中，点击想要预览的文件右侧的"预览"按钮
系统会读取该文件并显示预览界面
```

### 3. 切换预览文件
```
如果想预览其他文件：
1. 关闭当前预览
2. 点击另一个文件的"预览"按钮
```

### 4. 确认并生成
```
预览确认内容无误后，点击"确认并生成需求文档"
系统将使用当前预览的文件内容进行生成
```

## 🎨 UI 改进

### 按钮设计
- **颜色**: 蓝色主题（#2563eb）
- **大小**: 小号按钮（text-xs）
- **图标**: FileText 图标
- **边框**: 圆角 + 边框
- **状态**: Hover 时背景色加深

### 布局优化
- 预览按钮位于状态图标和删除按钮之间
- 文件名自动截断（truncate）
- 响应式设计，适配不同屏幕

## 🧪 测试建议

### 测试场景 1: 单文件预览
```
1. 上传一个 .docx 文件
2. 点击右侧的"预览"按钮
3. 验证文件内容正确显示
4. 点击"确认并生成"
```

### 测试场景 2: 多文件切换
```
1. 上传 3 个不同格式的文件（.html, .pdf, .md）
2. 依次点击每个文件的"预览"按钮
3. 验证每次都能正确预览对应文件
4. 选择一个文件确认生成
```

### 测试场景 3: 混合文件类型
```
1. 上传主文件 + JS 辅助文件
2. 验证 JS 文件不显示"预览"按钮
3. 验证主文件显示"预览"按钮
4. 预览主文件并生成
```

### 测试场景 4: 错误处理
```
1. 上传一个损坏的文件
2. 点击"预览"按钮
3. 验证显示友好的错误提示
4. 关闭预览，重新上传正确的文件
```

## 📊 优势对比

### 旧方案的问题
- ❌ 只能预览第一个主文件
- ❌ 预览按钮位置不明显
- ❌ 上传多个文件时无法选择

### 新方案的优势
- ✅ 可以预览任意主文件
- ✅ 预览按钮位置直观（文件旁边）
- ✅ 支持多文件独立预览
- ✅ 更符合用户操作习惯

## 🔄 向后兼容

- ✅ 保持原有的预览功能
- ✅ 保持原有的文件验证逻辑
- ✅ 保持原有的错误提示
- ✅ 添加的是增强功能，不影响现有流程

## 💡 使用建议

1. **推荐工作流**
   ```
   上传文件 → 预览主文件 → 确认内容 → 生成文档
   ```

2. **多文件场景**
   ```
   上传多个文件 → 逐个预览对比 → 选择最佳文件 → 生成文档
   ```

3. **快速模式**
   ```
   上传单个文件 → 直接点击预览 → 快速确认 → 生成
   ```

## ⚠️ 注意事项

1. **JS 文件处理**
   - JS 文件不显示预览按钮
   - JS 文件仅作为辅助文件
   - 需要配合 HTML 文件使用

2. **预览内容限制**
   - 默认显示前 500 字符
   - 完整内容在生成时使用
   - 大文件预览可能需要等待

3. **文件选择逻辑**
   - 点击预览按钮预览指定文件
   - 生成时使用最后预览的文件
   - 建议每次只预览要使用的文件

## 🎉 更新总结

这次更新让文件预览功能更加灵活和直观：
- ✨ 预览按钮移至文件列表右侧
- ✨ 支持预览任意主文件
- ✨ 更符合用户操作习惯
- ✨ 提升多文件上传场景的体验

