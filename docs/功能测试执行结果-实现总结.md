# åŠŸèƒ½æµ‹è¯•æ‰§è¡Œç»“æœä¿å­˜ - å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡ âœ…
- ä½¿ç”¨ç°æœ‰çš„ `functional_test_executions` è¡¨å­˜å‚¨æ‰§è¡Œç»“æœ
- åŒ…å«å­—æ®µï¼š
  - åŸºæœ¬ä¿¡æ¯ï¼štest_case_id, test_case_name, final_result, actual_result
  - æ—¶é—´ç»Ÿè®¡ï¼šduration_ms, executed_at
  - æ‰§è¡Œäººï¼šexecutor_id, executor_department
  - æ­¥éª¤ç»Ÿè®¡ï¼šstep_results, total_steps, completed_steps, passed_steps, failed_steps, blocked_steps
  - é™„ä»¶ï¼šscreenshots, attachments
  - å…ƒæ•°æ®ï¼šmetadata (JSON)

### 2. åç«¯å®ç° âœ…

#### æœåŠ¡å±‚ (server/services/functionalTestCaseService.ts)

æ–°å¢æ–¹æ³•ï¼š
- `saveExecutionResult()` - ä¿å­˜æ‰§è¡Œç»“æœ
- `getExecutionHistory()` - è·å–æ‰§è¡Œå†å²
- `getExecutionById()` - è·å–æ‰§è¡Œè¯¦æƒ…

#### APIè·¯ç”± (server/routes/functionalTestCase.ts)

æ–°å¢æ¥å£ï¼š
- `POST /api/v1/functional-test-cases/:id/execute` - æäº¤æ‰§è¡Œç»“æœ
- `GET /api/v1/functional-test-cases/:id/executions` - æŸ¥è¯¢æ‰§è¡Œå†å²
- `GET /api/v1/functional-test-cases/executions/:executionId` - æŸ¥è¯¢æ‰§è¡Œè¯¦æƒ…

### 3. å‰ç«¯å®ç° âœ…

#### æœåŠ¡å±‚ (src/services/functionalTestCaseService.ts)

æ–°å¢æ–¹æ³•ï¼š
- `saveExecutionResult()` - è°ƒç”¨APIä¿å­˜ç»“æœ
- `getExecutionHistory()` - è°ƒç”¨APIè·å–å†å²
- `getExecutionById()` - è°ƒç”¨APIè·å–è¯¦æƒ…

#### é¡µé¢å®ç°

å·²æ›´æ–°çš„é¡µé¢ï¼š
- âœ… `src/pages/FunctionalTestCaseExecute.tsx` - ä¸»æ‰§è¡Œé¡µé¢
- âœ… `src/pages/FunctionalTestCaseExecuteAlt.tsx` - å¤‡é€‰æ ·å¼æ‰§è¡Œé¡µé¢

ä¿®æ”¹ `handleSubmit()` æ–¹æ³•ï¼š
- æ•°æ®éªŒè¯
- è®¡ç®—æ­¥éª¤ç»Ÿè®¡
- è°ƒç”¨APIä¿å­˜ç»“æœåˆ°æ•°æ®åº“
- æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶è¿”å›åˆ—è¡¨

### 4. æ‰§è¡Œæ—¥å¿—å…³è”è®¾è®¡ âœ…

é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°å…³è”ï¼š

1. **ä¸»é”®å…³è”**ï¼š`test_case_id` å­—æ®µå…³è” `functional_test_cases` è¡¨
2. **ç”¨æˆ·å…³è”**ï¼š`executor_id` å­—æ®µå…³è” `users` è¡¨
3. **å…ƒæ•°æ®å…³è”**ï¼šé€šè¿‡ `metadata` JSONå­—æ®µå­˜å‚¨é¢å¤–å…³è”ä¿¡æ¯

```json
{
  "system": "ç”¨æˆ·ä¸­å¿ƒ",
  "module": "ç™»å½•æ¨¡å—",
  "scenario_name": "ç”¨æˆ·ç™»å½•",
  "test_point_name": "æ­£å¸¸ç™»å½•æµç¨‹",
  "priority": "high",
  "case_type": "SMOKE"
}
```

### 5. æ–‡æ¡£è¾“å‡º âœ…

åˆ›å»ºäº†ä¸¤ä»½æ–‡æ¡£ï¼š
- `docs/åŠŸèƒ½æµ‹è¯•æ‰§è¡Œç»“æœä¿å­˜æ–¹æ¡ˆ.md` - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ
- `docs/åŠŸèƒ½æµ‹è¯•æ‰§è¡Œç»“æœ-å®ç°æ€»ç»“.md` - å®ç°æ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰

## ğŸ”— æ•°æ®å…³è”æ–¹å¼

### æ‰‹å·¥æµ‹è¯•ä¸è‡ªåŠ¨åŒ–æµ‹è¯•å…³è”

```sql
-- æŸ¥è¯¢æŸä¸ªåŠŸèƒ½æ¨¡å—çš„æ‰€æœ‰æ‰§è¡Œè®°å½•ï¼ˆæ‰‹å·¥+è‡ªåŠ¨åŒ–ï¼‰
SELECT 
  'manual' as type,
  fte.id,
  fte.test_case_name,
  fte.final_result,
  fte.executed_at,
  fte.duration_ms,
  JSON_EXTRACT(fte.metadata, '$.system') as system,
  JSON_EXTRACT(fte.metadata, '$.module') as module
FROM functional_test_executions fte
WHERE JSON_EXTRACT(fte.metadata, '$.system') = 'ç”¨æˆ·ä¸­å¿ƒ'

UNION ALL

SELECT 
  'automated' as type,
  tce.id,
  tc.title as test_case_name,
  tce.status as final_result,
  tce.started_at as executed_at,
  tce.duration_ms,
  tc.system,
  tc.module
FROM test_case_executions tce
JOIN test_cases tc ON tce.test_case_id = tc.id
WHERE tc.system = 'ç”¨æˆ·ä¸­å¿ƒ'

ORDER BY executed_at DESC;
```

## ğŸ“Š æ•°æ®æµç¨‹

```
ç”¨æˆ·æ‰§è¡Œæµ‹è¯•
    â†“
å¡«å†™æ‰§è¡Œç»“æœ
    â†“
ç‚¹å‡»"æäº¤ç»“æœ"
    â†“
å‰ç«¯æ”¶é›†æ•°æ®ï¼ˆæ­¥éª¤ç»“æœã€ç»Ÿè®¡ä¿¡æ¯ã€å…ƒæ•°æ®ï¼‰
    â†“
è°ƒç”¨ API: POST /api/v1/functional-test-cases/:id/execute
    â†“
åç«¯éªŒè¯æ•°æ®
    â†“
ä¿å­˜åˆ° functional_test_executions è¡¨
    â†“
è¿”å› executionId
    â†“
å‰ç«¯æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶è·³è½¬
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. âœ… **å®Œæ•´çš„æ•°æ®ä¿å­˜**ï¼šä¿å­˜æ‰€æœ‰æ‰§è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬æ­¥éª¤è¯¦æƒ…ã€é™„ä»¶ç­‰
2. âœ… **å†å²è®°å½•è¿½æº¯**ï¼šå¯ä»¥æŸ¥è¯¢ä»»ä½•æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œå†å²
3. âœ… **æ‰§è¡Œäººè¿½è¸ª**ï¼šè®°å½•æ‰§è¡Œäººå’Œéƒ¨é—¨ä¿¡æ¯
4. âœ… **ç»Ÿè®¡åˆ†æ**ï¼šè‡ªåŠ¨è®¡ç®—å„æ­¥éª¤çš„é€šè¿‡ç‡
5. âœ… **çµæ´»å…³è”**ï¼šé€šè¿‡ test_case_id å’Œ metadata å®ç°å¤šç»´åº¦å…³è”
6. âœ… **æ‰©å±•æ€§å¼º**ï¼šJSONå­—æ®µæ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•

```bash
# 1. æµ‹è¯•æäº¤æ‰§è¡Œç»“æœ
curl -X POST http://localhost:3000/api/v1/functional-test-cases/1/execute \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "testCaseName": "ç™»å½•åŠŸèƒ½æµ‹è¯•",
    "finalResult": "pass",
    "actualResult": "æ‰€æœ‰æ­¥éª¤æ‰§è¡Œé€šè¿‡",
    "durationMs": 180000,
    "totalSteps": 4,
    "completedSteps": 4,
    "passedSteps": 4
  }'

# 2. æµ‹è¯•æŸ¥è¯¢æ‰§è¡Œå†å²
curl http://localhost:3000/api/v1/functional-test-cases/1/executions?limit=10 \
  -H "Authorization: Bearer YOUR_TOKEN"

# 3. æµ‹è¯•æŸ¥è¯¢æ‰§è¡Œè¯¦æƒ…
curl http://localhost:3000/api/v1/functional-test-cases/executions/YOUR_EXECUTION_ID \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. å‰ç«¯æµ‹è¯•

1. æ‰“å¼€æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡µé¢
2. æ‰§è¡Œå„ä¸ªæ­¥éª¤ï¼Œæ ‡è®°ç»“æœ
3. å¡«å†™å®é™…ç»“æœæ€»ç»“
4. ç‚¹å‡»"æäº¤ç»“æœ"æŒ‰é’®
5. éªŒè¯ï¼š
   - æ˜¯å¦æ˜¾ç¤ºæˆåŠŸæç¤º
   - æ˜¯å¦è·³è½¬åˆ°åˆ—è¡¨é¡µ
   - æ•°æ®åº“ä¸­æ˜¯å¦æ­£ç¡®ä¿å­˜

### 3. æ•°æ®éªŒè¯

```sql
-- æ£€æŸ¥æœ€æ–°çš„æ‰§è¡Œè®°å½•
SELECT * FROM functional_test_executions 
ORDER BY executed_at DESC 
LIMIT 5;

-- æ£€æŸ¥æŸä¸ªç”¨ä¾‹çš„æ‰§è¡Œå†å²
SELECT 
  id,
  test_case_name,
  final_result,
  executed_at,
  duration_ms,
  total_steps,
  passed_steps
FROM functional_test_executions
WHERE test_case_id = 1
ORDER BY executed_at DESC;
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨

```typescript
// 1. ä¿å­˜æ‰§è¡Œç»“æœ
const result = await functionalTestCaseService.saveExecutionResult(123, {
  testCaseName: 'ç™»å½•åŠŸèƒ½æµ‹è¯•',
  finalResult: 'pass',
  actualResult: 'æ‰€æœ‰æ­¥éª¤æ‰§è¡Œé€šè¿‡ï¼ŒåŠŸèƒ½æ­£å¸¸',
  comments: 'æµ‹è¯•ç¯å¢ƒï¼šChrome 120',
  durationMs: 180000,
  stepResults: [
    {
      stepIndex: 1,
      action: 'æ‰“å¼€ç™»å½•é¡µé¢',
      expected: 'é¡µé¢æ­£å¸¸æ˜¾ç¤º',
      result: 'pass',
      note: ''
    },
    // ... æ›´å¤šæ­¥éª¤
  ],
  totalSteps: 4,
  completedSteps: 4,
  passedSteps: 4,
  failedSteps: 0,
  blockedSteps: 0,
  metadata: {
    system: 'ç”¨æˆ·ä¸­å¿ƒ',
    module: 'ç™»å½•æ¨¡å—',
    browser: 'Chrome 120'
  }
});

// 2. è·å–æ‰§è¡Œå†å²
const history = await functionalTestCaseService.getExecutionHistory(123, 10);

// 3. è·å–æ‰§è¡Œè¯¦æƒ…
const detail = await functionalTestCaseService.getExecutionById(executionId);
```

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **é™„ä»¶ä¸Šä¼ **ï¼šå®ç°æˆªå›¾å’Œè§†é¢‘çš„ä¸Šä¼ ä¿å­˜åŠŸèƒ½
2. **æ‰§è¡ŒæŠ¥å‘Š**ï¼šç”ŸæˆPDFæ ¼å¼çš„æ‰§è¡ŒæŠ¥å‘Š
3. **æ•°æ®åˆ†æ**ï¼šå¼€å‘æµ‹è¯•æ•°æ®åˆ†æçœ‹æ¿
4. **ç¼ºé™·å…³è”**ï¼šä¸ç¼ºé™·ç®¡ç†ç³»ç»Ÿé›†æˆ
5. **é€šçŸ¥æé†’**ï¼šæ‰§è¡Œå¤±è´¥æ—¶å‘é€é€šçŸ¥
6. **æƒé™æ§åˆ¶**ï¼šåªå…è®¸æ‰§è¡Œäººä¿®æ”¹è‡ªå·±çš„æ‰§è¡Œè®°å½•

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®éšç§**ï¼šæ‰§è¡Œè®°å½•åŒ…å«æ‰§è¡Œäººä¿¡æ¯ï¼Œéœ€æ³¨æ„æƒé™æ§åˆ¶
2. **å­˜å‚¨ç©ºé—´**ï¼šJSONå­—æ®µå¯èƒ½å­˜å‚¨å¤§é‡æ•°æ®ï¼Œéœ€å®šæœŸå½’æ¡£
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§é‡å†å²æ•°æ®æŸ¥è¯¢æ—¶å»ºè®®åˆ†é¡µå’Œç´¢å¼•ä¼˜åŒ–
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿test_case_idå¼•ç”¨çš„æµ‹è¯•ç”¨ä¾‹å­˜åœ¨
5. **æ—¶åŒºé—®é¢˜**ï¼šexecuted_atæ—¶é—´å­—æ®µéœ€æ³¨æ„æ—¶åŒºè½¬æ¢

## âœ¨ æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæˆäº†åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç»“æœçš„å®Œæ•´ä¿å­˜æœºåˆ¶ï¼Œå®ç°äº†ï¼š
- âœ… æ•°æ®åº“è¡¨è®¾è®¡å’Œå…³è”
- âœ… åç«¯APIå’ŒæœåŠ¡å±‚å®ç°
- âœ… å‰ç«¯é¡µé¢é›†æˆ
- âœ… æ‰§è¡Œæ—¥å¿—å…³è”æ–¹æ¡ˆ
- âœ… å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£

æ‰€æœ‰ä»£ç å·²ç»å®ç°å¹¶å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ğŸ‰

