# æµ‹è¯•è®¡åˆ’æ¨¡å— - å¿«é€Ÿå¼€å§‹æŒ‡å—

## æ¦‚è¿°

æµ‹è¯•è®¡åˆ’æ¨¡å—å·²ç»å®Œå…¨é›†æˆåˆ°ç³»ç»Ÿä¸­ï¼Œæä¾›äº†å®Œæ•´çš„æµ‹è¯•è®¡åˆ’ç®¡ç†åŠŸèƒ½ã€‚

## å·²å®Œæˆçš„å·¥ä½œ

### âœ… 1. æ•°æ®åº“è®¾è®¡
- åˆ›å»ºäº†3ä¸ªæ•°æ®è¡¨ï¼š
  - `test_plans` - æµ‹è¯•è®¡åˆ’ä¸»è¡¨
  - `test_plan_cases` - æµ‹è¯•è®¡åˆ’ä¸ç”¨ä¾‹å…³è”è¡¨
  - `test_plan_executions` - æµ‹è¯•è®¡åˆ’æ‰§è¡Œè®°å½•è¡¨
- å®šä¹‰äº†ç›¸å…³æšä¸¾ç±»å‹ï¼ˆè®¡åˆ’çŠ¶æ€ã€è®¡åˆ’ç±»å‹ï¼‰
- æ–‡ä»¶ä½ç½®ï¼š`prisma/schema.prisma`

### âœ… 2. ç±»å‹å®šä¹‰
- åˆ›å»ºäº†å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- åŒ…å«ï¼šTestPlan, TestPlanCase, TestPlanExecutionç­‰
- æ–‡ä»¶ä½ç½®ï¼š`src/types/testPlan.ts`

### âœ… 3. åç«¯API
- åˆ›å»ºäº†å®Œæ•´çš„åç«¯æœåŠ¡å±‚ï¼š`server/services/testPlanService.ts`
- åˆ›å»ºäº†RESTful APIè·¯ç”±ï¼š`server/routes/testPlan.ts`
- åœ¨æœåŠ¡å™¨ä¸­æ³¨å†Œäº†è·¯ç”±ï¼š`server/index.ts`
- APIåŸºç¡€è·¯å¾„ï¼š`/api/v1/test-plans`

### âœ… 4. å‰ç«¯æœåŠ¡
- åˆ›å»ºäº†å‰ç«¯æœåŠ¡å±‚ï¼š`src/services/testPlanService.ts`
- å°è£…äº†æ‰€æœ‰APIè°ƒç”¨

### âœ… 5. å‰ç«¯é¡µé¢
åˆ›å»ºäº†3ä¸ªä¸»è¦é¡µé¢ï¼š
- `TestPlans.tsx` - æµ‹è¯•è®¡åˆ’åˆ—è¡¨é¡µé¢
- `TestPlanForm.tsx` - æµ‹è¯•è®¡åˆ’åˆ›å»º/ç¼–è¾‘é¡µé¢
- `TestPlanDetail.tsx` - æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢

### âœ… 6. è·¯ç”±é…ç½®
- åœ¨ `src/App.tsx` ä¸­æ·»åŠ äº†æµ‹è¯•è®¡åˆ’è·¯ç”±
- è·¯ç”±è·¯å¾„ï¼š
  - `/test-plans` - åˆ—è¡¨é¡µé¢
  - `/test-plans/create` - åˆ›å»ºé¡µé¢
  - `/test-plans/:id` - è¯¦æƒ…é¡µé¢
  - `/test-plans/:id/edit` - ç¼–è¾‘é¡µé¢

### âœ… 7. å¯¼èˆªèœå•
- åœ¨ `src/components/Layout.tsx` ä¸­æ·»åŠ äº†æµ‹è¯•è®¡åˆ’å¯¼èˆªé¡¹
- å›¾æ ‡ï¼šTarget
- ä½ç½®ï¼šUIè‡ªåŠ¨åŒ–å’Œæµ‹è¯•æ‰§è¡Œä¹‹é—´

### âœ… 8. æ–‡æ¡£
- åˆ›å»ºäº†å®Œæ•´çš„ä½¿ç”¨è¯´æ˜æ–‡æ¡£ï¼š`docs/TEST_PLAN_MODULE.md`
- åˆ›å»ºäº†æ•°æ®åº“è¿ç§»è„šæœ¬ï¼š`prisma/migrations/add_test_plan_tables.sql`

## éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: æ•°æ®åº“è¿ç§»

```bash
# æ–¹å¼1: ä½¿ç”¨Prismaè¿ç§»
npx prisma generate
npx prisma db push

# æ–¹å¼2: ç›´æ¥æ‰§è¡ŒSQLè„šæœ¬
mysql -u root -p sakura_test_flow < prisma/migrations/add_test_plan_tables.sql
```

### æ­¥éª¤2: é‡å¯æœåŠ¡å™¨

```bash
# é‡å¯åç«¯æœåŠ¡
npm run dev

# æˆ–è€…å¦‚æœä½¿ç”¨PM2
pm2 restart server
```

### æ­¥éª¤3: åˆ·æ–°å‰ç«¯

```bash
# æ¸…ç†ç¼“å­˜å¹¶é‡æ–°æ„å»ºï¼ˆå¦‚æœéœ€è¦ï¼‰
npm run build

# æˆ–è€…åœ¨å¼€å‘æ¨¡å¼ä¸‹ç›´æ¥åˆ·æ–°æµè§ˆå™¨å³å¯
```

## ä½¿ç”¨æŒ‡å—

### åˆ›å»ºæµ‹è¯•è®¡åˆ’

1. ç™»å½•ç³»ç»Ÿ
2. ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„"æµ‹è¯•è®¡åˆ’"
3. ç‚¹å‡»"æ–°å»ºè®¡åˆ’"æŒ‰é’®
4. å¡«å†™è®¡åˆ’ä¿¡æ¯ï¼š
   - è®¡åˆ’åç§°ï¼ˆå¿…å¡«ï¼‰
   - è®¡åˆ’ç±»å‹ï¼ˆå¿…å¡«ï¼‰ï¼šåŠŸèƒ½æµ‹è¯•/UIè‡ªåŠ¨åŒ–/æ··åˆæµ‹è¯•ç­‰
   - æ‰€å±é¡¹ç›®
   - è®¡åˆ’æè¿°
   - å¼€å§‹/ç»“æŸæ—¥æœŸ
5. ç‚¹å‡»"åˆ›å»ºè®¡åˆ’"

### æ·»åŠ æµ‹è¯•ç”¨ä¾‹

1. è¿›å…¥æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢
2. åœ¨"æµ‹è¯•ç”¨ä¾‹"æ ‡ç­¾é¡µä¸­ç‚¹å‡»"æ·»åŠ ç”¨ä¾‹"
3. é€‰æ‹©ç”¨ä¾‹ç±»å‹ï¼š
   - åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹
   - UIè‡ªåŠ¨åŒ–ç”¨ä¾‹
4. é€‰æ‹©è¦æ·»åŠ çš„ç”¨ä¾‹
5. ç¡®è®¤æ·»åŠ 

### æ‰§è¡Œæµ‹è¯•è®¡åˆ’

#### åŠŸèƒ½æµ‹è¯•æ‰§è¡Œ
1. åœ¨æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢ç‚¹å‡»"æ‰§è¡ŒåŠŸèƒ½æµ‹è¯•"
2. æŒ‰ç…§æç¤ºæ‰‹åŠ¨æ‰§è¡Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹
3. è®°å½•æ‰§è¡Œç»“æœï¼ˆé€šè¿‡/å¤±è´¥/é˜»å¡/è·³è¿‡ï¼‰
4. æŸ¥çœ‹æ‰§è¡Œç»“æœæ±‡æ€»

#### UIè‡ªåŠ¨åŒ–æ‰§è¡Œ
1. åœ¨æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢ç‚¹å‡»"æ‰§è¡ŒUIè‡ªåŠ¨åŒ–"
2. ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰UIè‡ªåŠ¨åŒ–ç”¨ä¾‹
3. æŸ¥çœ‹å®æ—¶æ‰§è¡Œæ—¥å¿—å’Œè¿›åº¦
4. æŸ¥çœ‹æ‰§è¡Œç»“æœæ±‡æ€»

### æŸ¥çœ‹ç»Ÿè®¡æ•°æ®

åœ¨æµ‹è¯•è®¡åˆ’è¯¦æƒ…é¡µé¢çš„"ç»Ÿè®¡åˆ†æ"æ ‡ç­¾é¡µä¸­å¯ä»¥æŸ¥çœ‹ï¼š
- ç”¨ä¾‹æ€»æ•°
- é€šè¿‡ç‡
- æ‰§è¡Œç‡
- å¤±è´¥/é˜»å¡ç”¨ä¾‹æ•°
- æ‰§è¡Œæ¬¡æ•°

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æµ‹è¯•è®¡åˆ’ç®¡ç†
- âœ… åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æµ‹è¯•è®¡åˆ’
- âœ… æ”¯æŒå¤šç§è®¡åˆ’ç±»å‹ï¼ˆåŠŸèƒ½ã€UIè‡ªåŠ¨åŒ–ã€æ··åˆã€å›å½’ã€å†’çƒŸã€é›†æˆï¼‰
- âœ… æ”¯æŒè®¡åˆ’çŠ¶æ€ç®¡ç†ï¼ˆè‰ç¨¿ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å–æ¶ˆã€å·²å½’æ¡£ï¼‰
- âœ… æ”¯æŒé¡¹ç›®åˆ†ç±»
- âœ… æ”¯æŒæ—¶é—´èŒƒå›´è®¾ç½®

### ğŸ“‹ ç”¨ä¾‹ç®¡ç†
- âœ… æ·»åŠ åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹åˆ°è®¡åˆ’
- âœ… æ·»åŠ UIè‡ªåŠ¨åŒ–ç”¨ä¾‹åˆ°è®¡åˆ’
- âœ… ç§»é™¤ç”¨ä¾‹
- âœ… ç”¨ä¾‹æ’åº
- âœ… æŸ¥çœ‹ç”¨ä¾‹æ‰§è¡ŒçŠ¶æ€å’Œç»“æœ

### ğŸš€ æ‰§è¡Œç®¡ç†
- âœ… åŠŸèƒ½æµ‹è¯•æ‰‹åŠ¨æ‰§è¡Œ
- âœ… UIè‡ªåŠ¨åŒ–æ‰¹é‡æ‰§è¡Œ
- âœ… æ‰§è¡Œå†å²è®°å½•
- âœ… æ‰§è¡Œç»“æœæ±‡æ€»
- âœ… æ‰§è¡Œè¿›åº¦è·Ÿè¸ª

### ğŸ“Š ç»Ÿè®¡åˆ†æ
- âœ… ç”¨ä¾‹ç»Ÿè®¡ï¼ˆæ€»æ•°ã€åŠŸèƒ½ç”¨ä¾‹ã€UIè‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼‰
- âœ… æ‰§è¡Œç»Ÿè®¡ï¼ˆæ‰§è¡Œç‡ã€é€šè¿‡ç‡ï¼‰
- âœ… ç»“æœç»Ÿè®¡ï¼ˆé€šè¿‡ã€å¤±è´¥ã€é˜»å¡ã€è·³è¿‡ï¼‰
- âœ… æ‰§è¡Œæ¬¡æ•°ç»Ÿè®¡

### ğŸ” æŸ¥è¯¢ç­›é€‰
- âœ… æŒ‰é¡¹ç›®ç­›é€‰
- âœ… æŒ‰è®¡åˆ’ç±»å‹ç­›é€‰
- âœ… æŒ‰çŠ¶æ€ç­›é€‰
- âœ… å…³é”®è¯æœç´¢
- âœ… åˆ†é¡µæ˜¾ç¤º

## APIç«¯ç‚¹

### æµ‹è¯•è®¡åˆ’

```
GET    /api/v1/test-plans                        # è·å–æµ‹è¯•è®¡åˆ’åˆ—è¡¨
GET    /api/v1/test-plans/:id                    # è·å–æµ‹è¯•è®¡åˆ’è¯¦æƒ…
POST   /api/v1/test-plans                        # åˆ›å»ºæµ‹è¯•è®¡åˆ’
PUT    /api/v1/test-plans/:id                    # æ›´æ–°æµ‹è¯•è®¡åˆ’
DELETE /api/v1/test-plans/:id                    # åˆ é™¤æµ‹è¯•è®¡åˆ’ï¼ˆè½¯åˆ é™¤ï¼‰
```

### ç”¨ä¾‹ç®¡ç†

```
POST   /api/v1/test-plans/:id/cases              # æ·»åŠ ç”¨ä¾‹åˆ°æµ‹è¯•è®¡åˆ’
DELETE /api/v1/test-plans/:id/cases/:caseId     # ä»æµ‹è¯•è®¡åˆ’ä¸­ç§»é™¤ç”¨ä¾‹
PUT    /api/v1/test-plans/:id/cases/:caseId/status  # æ›´æ–°ç”¨ä¾‹æ‰§è¡ŒçŠ¶æ€
```

### æ‰§è¡Œç®¡ç†

```
POST   /api/v1/test-plans/:id/execute            # å¼€å§‹æ‰§è¡Œæµ‹è¯•è®¡åˆ’
GET    /api/v1/test-plans/:id/executions         # è·å–æ‰§è¡Œå†å²
PUT    /api/v1/test-plans/executions/:executionId  # æ›´æ–°æ‰§è¡ŒçŠ¶æ€
```

## æ•°æ®æ¨¡å‹

### TestPlan (æµ‹è¯•è®¡åˆ’)
```typescript
{
  id: number;
  name: string;              // è®¡åˆ’åç§°
  short_name?: string;       // è®¡åˆ’ç®€ç§°
  description?: string;      // è®¡åˆ’æè¿°
  project?: string;          // æ‰€å±é¡¹ç›®
  plan_type: TestPlanType;   // è®¡åˆ’ç±»å‹
  status: TestPlanStatus;    // è®¡åˆ’çŠ¶æ€
  members?: number[];        // æˆå‘˜åˆ—è¡¨
  owner_id: number;          // ä¸»è´Ÿè´£äººID
  owner_name?: string;       // ä¸»è´Ÿè´£äººå§“å
  start_date?: string;       // å¼€å§‹æ—¥æœŸ
  end_date?: string;         // ç»“æŸæ—¥æœŸ
  created_at: string;        // åˆ›å»ºæ—¶é—´
  updated_at: string;        // æ›´æ–°æ—¶é—´
}
```

### TestPlanCase (æµ‹è¯•è®¡åˆ’ç”¨ä¾‹)
```typescript
{
  id: number;
  plan_id: number;           // æµ‹è¯•è®¡åˆ’ID
  case_id: number;           // ç”¨ä¾‹ID
  case_type: 'functional' | 'ui_auto';  // ç”¨ä¾‹ç±»å‹
  case_name: string;         // ç”¨ä¾‹åç§°
  sort_order: number;        // æ’åºå·
  is_executed: boolean;      // æ˜¯å¦å·²æ‰§è¡Œ
  execution_result?: 'pass' | 'fail' | 'block' | 'skip';  // æ‰§è¡Œç»“æœ
  created_at: string;        // æ·»åŠ æ—¶é—´
}
```

### TestPlanExecution (æµ‹è¯•è®¡åˆ’æ‰§è¡Œ)
```typescript
{
  id: string;                // æ‰§è¡ŒID (UUID)
  plan_id: number;           // æµ‹è¯•è®¡åˆ’ID
  plan_name: string;         // è®¡åˆ’åç§°
  executor_id: number;       // æ‰§è¡Œè€…ID
  executor_name: string;     // æ‰§è¡Œè€…å§“å
  execution_type: 'functional' | 'ui_auto';  // æ‰§è¡Œç±»å‹
  status: ExecutionStatus;   // æ‰§è¡ŒçŠ¶æ€
  progress: number;          // æ‰§è¡Œè¿›åº¦ (0-100)
  total_cases: number;       // æ€»ç”¨ä¾‹æ•°
  completed_cases: number;   // å·²å®Œæˆæ•°
  passed_cases: number;      // é€šè¿‡æ•°
  failed_cases: number;      // å¤±è´¥æ•°
  blocked_cases: number;     // é˜»å¡æ•°
  skipped_cases: number;     // è·³è¿‡æ•°
  started_at: string;        // å¼€å§‹æ—¶é—´
  finished_at?: string;      // ç»“æŸæ—¶é—´
  duration_ms?: number;      // æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
  execution_results?: TestPlanCaseResult[];  // æ‰§è¡Œç»“æœè¯¦æƒ…
  error_message?: string;    // é”™è¯¯ä¿¡æ¯
}
```

## æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**ï¼šæ‰€æœ‰æµ‹è¯•è®¡åˆ’APIéƒ½éœ€è¦ç”¨æˆ·è®¤è¯
2. **æ•°æ®å®‰å…¨**ï¼šåˆ é™¤æ“ä½œä¸ºè½¯åˆ é™¤ï¼Œæ•°æ®å¯æ¢å¤
3. **å¹¶å‘æ‰§è¡Œ**ï¼šUIè‡ªåŠ¨åŒ–æ”¯æŒæ‰¹é‡æ‰§è¡Œï¼Œæ³¨æ„èµ„æºé™åˆ¶
4. **æ•°æ®å…³è”**ï¼šåˆ é™¤æµ‹è¯•è®¡åˆ’ä¼šçº§è”åˆ é™¤ç›¸å…³ç”¨ä¾‹å’Œæ‰§è¡Œè®°å½•

## é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æµ‹è¯•è®¡åˆ’é¡µé¢æ— æ³•è®¿é—®
- æ£€æŸ¥è·¯ç”±æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥å¯¼èˆªèœå•æ˜¯å¦æ·»åŠ 
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•

### é—®é¢˜2: åˆ›å»ºæµ‹è¯•è®¡åˆ’å¤±è´¥
- æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦å·²åˆ›å»º
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡å™¨æ—¥å¿—

### é—®é¢˜3: æ·»åŠ ç”¨ä¾‹å¤±è´¥
- ç¡®è®¤ç”¨ä¾‹IDæ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤ç”¨ä¾‹ç±»å‹æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç”¨ä¾‹

## ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] å®ç°æµ‹è¯•è®¡åˆ’æ‰§è¡Œé¡µé¢ï¼ˆåŠŸèƒ½æµ‹è¯•æ‰‹åŠ¨æ‰§è¡Œï¼‰
- [ ] å®ç°æµ‹è¯•è®¡åˆ’æ‰§è¡Œé¡µé¢ï¼ˆUIè‡ªåŠ¨åŒ–æ‰¹é‡æ‰§è¡Œï¼‰
- [ ] æ·»åŠ ç”¨ä¾‹é€‰æ‹©é¡µé¢ï¼ˆæ”¯æŒæ‰¹é‡é€‰æ‹©ï¼‰
- [ ] å®ç°æµ‹è¯•è®¡åˆ’å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF/Excelï¼‰
- [ ] æ·»åŠ æµ‹è¯•è®¡åˆ’æ¨¡æ¿åŠŸèƒ½
- [ ] å®ç°æµ‹è¯•è®¡åˆ’å¤åˆ¶åŠŸèƒ½
- [ ] æ·»åŠ æ‰§è¡Œç»“æœå›¾è¡¨å±•ç¤º
- [ ] å®ç°å›¢é˜Ÿåä½œåŠŸèƒ½ï¼ˆè¯„è®ºã€å®¡æ‰¹ï¼‰

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- è¯¦ç»†æ–‡æ¡£ï¼š`docs/TEST_PLAN_MODULE.md`
- æ•°æ®åº“è„šæœ¬ï¼š`prisma/migrations/add_test_plan_tables.sql`
- APIæ–‡æ¡£ï¼šæ£€æŸ¥ `server/routes/testPlan.ts`

---

âœ¨ **æµ‹è¯•è®¡åˆ’æ¨¡å—å·²ç»å°±ç»ªï¼Œå¼€å§‹ä½¿ç”¨å§ï¼**

