# QdrantçŸ¥è¯†åº“å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“… 3å¤©å®æ–½è®¡åˆ’

---

## Day 1ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆ2å°æ—¶ï¼‰

### âœ… æ£€æŸ¥æ¸…å•

- [ ] Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] ç«¯å£ 6333 æœªè¢«å ç”¨
- [ ] Node.js 18+ å·²å®‰è£…

### Step 1ï¼šå¯åŠ¨ Qdrantï¼ˆ10åˆ†é’Ÿï¼‰

#### Windows PowerShell:
```powershell
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd d:\AI_mvp\ai_test\project

# 2. å¯åŠ¨ Qdrant å®¹å™¨
docker run -d `
  --name qdrant `
  -p 6333:6333 `
  -p 6334:6334 `
  -v "${PWD}\qdrant_storage:/qdrant/storage" `
  qdrant/qdrant

# 3. éªŒè¯å¯åŠ¨
docker ps | findstr qdrant
```

#### éªŒè¯æˆåŠŸ:
è®¿é—® http://localhost:6333/dashboard çœ‹åˆ°ç®¡ç†ç•Œé¢

### Step 2ï¼šå®‰è£…ä¾èµ–ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
npm install @qdrant/js-client-rest openai
```

### Step 3ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ2åˆ†é’Ÿï¼‰

åœ¨ `.env` æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

```bash
# ========== QdrantçŸ¥è¯†åº“é…ç½® ==========
QDRANT_URL=http://localhost:6333

# Embedding APIé…ç½®ï¼ˆä½¿ç”¨ç°æœ‰çš„OpenRouterï¼‰
EMBEDDING_API_BASE_URL=https://openrouter.ai/api/v1
EMBEDDING_API_KEY=your_openrouter_api_key_here
EMBEDDING_MODEL=openai/text-embedding-3-small
```

### Step 4ï¼šéªŒè¯é…ç½®

åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `test-qdrant.ts`:

```typescript
import { QdrantClient } from '@qdrant/js-client-rest';

async function test() {
  const client = new QdrantClient({ url: 'http://localhost:6333' });
  const collections = await client.getCollections();
  console.log('âœ… Qdrant è¿æ¥æˆåŠŸï¼', collections);
}

test();
```

è¿è¡Œï¼š
```bash
npx tsx test-qdrant.ts
```

çœ‹åˆ° `âœ… Qdrant è¿æ¥æˆåŠŸï¼` å³è¡¨ç¤º Day 1 å®Œæˆã€‚

---

## Day 2ï¼šæ„å»ºçŸ¥è¯†å†…å®¹ï¼ˆ6å°æ—¶ï¼‰

### Step 5ï¼šç†è§£çŸ¥è¯†ç»“æ„ï¼ˆ30åˆ†é’Ÿï¼‰

æ‰“å¼€ `server/knowledgeBase/initialKnowledge.json`ï¼ŒæŸ¥çœ‹ç°æœ‰çŸ¥è¯†ç»“æ„ï¼š

```json
{
  "businessRules": [],      // ä¸šåŠ¡è§„åˆ™
  "testPatterns": [],       // æµ‹è¯•æ¨¡å¼
  "pitfalls": [],           // è¸©å‘ç‚¹
  "riskScenarios": []       // èµ„æŸåœºæ™¯
}
```

### Step 6ï¼šè¡¥å……ä½ çš„ä¸šåŠ¡çŸ¥è¯†ï¼ˆ3å°æ—¶ï¼‰

æ ¹æ®ä½ ä»¬çš„å®é™…ä¸šåŠ¡ï¼Œç¼–è¾‘ `initialKnowledge.json`ï¼š

#### 6.1 æ·»åŠ ä¸šåŠ¡è§„åˆ™

```json
{
  "id": "br_006",
  "category": "business_rule",
  "title": "ä½ çš„ä¸šåŠ¡è§„åˆ™æ ‡é¢˜",
  "content": "è¯¦ç»†æè¿°ä¸šåŠ¡è§„åˆ™...",
  "businessDomain": "ä½ çš„ä¸šåŠ¡é¢†åŸŸ",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
}
```

**å»ºè®®æ•°é‡**ï¼šè‡³å°‘ 10-15 æ¡æ ¸å¿ƒä¸šåŠ¡è§„åˆ™

#### 6.2 æ·»åŠ æµ‹è¯•åœºæ™¯æ¨¡å¼

**å·²æœ‰æ¨¡æ¿**ï¼š
- è¡¨å•æäº¤
- åˆ—è¡¨æŸ¥è¯¢
- å®¡æ ¸æµç¨‹
- æ•°æ®å¯¼å…¥
- åˆ é™¤æ“ä½œ

**ä½ éœ€è¦åš**ï¼šæ ¹æ®ä½ ä»¬çš„ä¸šåŠ¡è¡¥å……ç‰¹æœ‰åœºæ™¯æ¨¡å¼

#### 6.3 æ·»åŠ è¸©å‘ç‚¹

**å…³é”®é—®é¢˜**ï¼š
- æ”¶é›†å†å² Bug
- è®°å½•å®¹æ˜“é—æ¼çš„æµ‹è¯•ç‚¹
- æ ‡æ³¨æ›¾å¯¼è‡´çº¿ä¸Šé—®é¢˜çš„åœºæ™¯

```json
{
  "id": "pf_006",
  "category": "pitfall",
  "title": "æ›¾ç»è¸©è¿‡çš„å‘",
  "content": "é—®é¢˜ï¼š...\nåœºæ™¯ï¼š...\næ­£ç¡®åšæ³•ï¼š...\næµ‹è¯•é‡ç‚¹ï¼š...",
  "businessDomain": "ç›¸å…³ä¸šåŠ¡",
  "tags": ["é—®é¢˜ç±»å‹"],
  "metadata": {
    "severity": "high",
    "occurredDate": "2024-XX"
  }
}
```

**å»ºè®®æ•°é‡**ï¼šè‡³å°‘ 5-10 ä¸ªé‡è¦è¸©å‘ç‚¹

#### 6.4 æ·»åŠ èµ„æŸåœºæ™¯

**é‡ç‚¹å…³æ³¨**ï¼š
- é‡‘é¢è®¡ç®—é”™è¯¯
- ä¼˜æƒ åˆ¸æ¼æ´
- å¹¶å‘é—®é¢˜
- æƒé™æ¼æ´

**å»ºè®®æ•°é‡**ï¼šè‡³å°‘ 3-5 ä¸ªé«˜é£é™©åœºæ™¯

### Step 7ï¼šå¯¼å…¥çŸ¥è¯†åˆ° Qdrantï¼ˆ30åˆ†é’Ÿï¼‰

```bash
# è¿è¡Œå¯¼å…¥è„šæœ¬
npx tsx server/scripts/importKnowledge.ts
```

**é¢„æœŸè¾“å‡º**ï¼š
```
========================================
ğŸ“¦ å¼€å§‹å¯¼å…¥æµ‹è¯•ç”¨ä¾‹çŸ¥è¯†åº“
========================================

Step 1: åˆå§‹åŒ–Qdranté›†åˆ...
âœ… çŸ¥è¯†åº“é›†åˆåˆ›å»ºæˆåŠŸ: test_knowledge

Step 2: å‡†å¤‡çŸ¥è¯†æ•°æ®...
ğŸ“Š å…±å‡†å¤‡ 25 æ¡çŸ¥è¯†
   - ä¸šåŠ¡è§„åˆ™: 5 æ¡
   - æµ‹è¯•æ¨¡å¼: 5 æ¡
   - è¸©å‘ç‚¹: 5 æ¡
   - èµ„æŸåœºæ™¯: 5 æ¡

Step 3: æ‰¹é‡å¯¼å…¥åˆ°Qdrant...
âœ… çŸ¥è¯†å·²æ·»åŠ : [business_rule] è®¢å•é‡‘é¢è®¡ç®—è§„åˆ™
âœ… çŸ¥è¯†å·²æ·»åŠ : [business_rule] åº“å­˜æ‰£å‡æ—¶æœº
...

âœ… æ‰¹é‡å¯¼å…¥å®Œæˆ: æˆåŠŸ25æ¡, å¤±è´¥0æ¡

Step 4: éªŒè¯å¯¼å…¥ç»“æœ...
âœ… çŸ¥è¯†åº“æ€»æ•°: 25 æ¡

Step 5: æµ‹è¯•çŸ¥è¯†æ£€ç´¢åŠŸèƒ½...
ğŸ” æ£€ç´¢åˆ° 3 æ¡ç›¸å…³çŸ¥è¯†:

1. [business_rule] åº“å­˜æ‰£å‡æ—¶æœº
   ç›¸ä¼¼åº¦: 89.3%
   å†…å®¹: åº“å­˜æ‰£å‡æ—¶æœºï¼šç”¨æˆ·ä¸‹å•å¹¶æ”¯ä»˜æˆåŠŸåç«‹å³æ‰£å‡åº“å­˜...

========================================
âœ… çŸ¥è¯†åº“å¯¼å…¥å®Œæˆï¼
========================================
```

### Step 8ï¼šéªŒè¯çŸ¥è¯†åº“ï¼ˆ1å°æ—¶ï¼‰

è®¿é—® http://localhost:6333/dashboard

1. ç‚¹å‡» Collections â†’ `test_knowledge`
2. æŸ¥çœ‹ Points countï¼ˆåº”è¯¥ = ä½ å¯¼å…¥çš„çŸ¥è¯†æ•°é‡ï¼‰
3. ç‚¹å‡» "Scroll points" æµè§ˆå‘é‡æ•°æ®

---

## Day 3ï¼šé›†æˆä¸æµ‹è¯•ï¼ˆ6å°æ—¶ï¼‰

### Step 9ï¼šé›†æˆåˆ°æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼ˆ2å°æ—¶ï¼‰

#### 9.1 ä¿®æ”¹ `functionalTestCaseAIService.ts`

åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  importï¼š

```typescript
import { TestCaseKnowledgeBase } from './testCaseKnowledgeBase';
```

åœ¨ç±»ä¸­æ·»åŠ å±æ€§ï¼š

```typescript
export class FunctionalTestCaseAIService {
  private knowledgeBase: TestCaseKnowledgeBase;

  constructor() {
    // åŸæœ‰ä»£ç ...

    // åˆå§‹åŒ–çŸ¥è¯†åº“
    this.knowledgeBase = new TestCaseKnowledgeBase();
  }
}
```

#### 9.2 ä¿®æ”¹ `generateBatch` æ–¹æ³•

å‚è€ƒ `functionalTestCaseAIService_withKnowledgeBase.ts.example` ä¸­çš„å®Œæ•´ä»£ç ã€‚

**æ ¸å¿ƒæ”¹åŠ¨**ï¼š

```typescript
// åœ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹å‰ï¼Œå…ˆæ£€ç´¢çŸ¥è¯†åº“
const knowledgeResults = await this.knowledgeBase.searchByCategory({
  query: sectionContent,
  businessDomain: this.projectInfo?.businessDomain,
  topK: 2
});

// æ„å»ºçŸ¥è¯†å¢å¼ºçš„Prompt
const knowledgePrompt = this.buildKnowledgePrompt(knowledgeResults);

// å°†çŸ¥è¯†æ³¨å…¥åˆ° userPrompt ä¸­
const userPrompt = `...
${knowledgePrompt}
...`;
```

æ·»åŠ æ–°æ–¹æ³• `buildKnowledgePrompt`ï¼ˆè§ç¤ºä¾‹æ–‡ä»¶ï¼‰

### Step 10ï¼šæµ‹è¯•éªŒè¯ï¼ˆ2å°æ—¶ï¼‰

#### 10.1 å¯¹æ¯”æµ‹è¯•

**æµ‹è¯•Aï¼šä¸ä½¿ç”¨çŸ¥è¯†åº“**
1. ä¸´æ—¶æ³¨é‡Šæ‰çŸ¥è¯†åº“æ£€ç´¢ä»£ç 
2. ç”Ÿæˆä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
3. è®°å½•ç”¨ä¾‹æ•°é‡ã€è¦†ç›–åœºæ™¯

**æµ‹è¯•Bï¼šä½¿ç”¨çŸ¥è¯†åº“**
1. å¯ç”¨çŸ¥è¯†åº“æ£€ç´¢
2. ç”ŸæˆåŒä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
3. å¯¹æ¯”æ•ˆæœ

#### 10.2 éªŒè¯æŒ‡æ ‡

- [ ] ç”¨ä¾‹æ•°é‡å¢åŠ  20%+
- [ ] è¦†ç›–äº†çŸ¥è¯†åº“ä¸­çš„ä¸šåŠ¡è§„åˆ™
- [ ] åŒ…å«äº†è¸©å‘ç‚¹æµ‹è¯•
- [ ] åŒ…å«äº†èµ„æŸåœºæ™¯æµ‹è¯•
- [ ] ç”Ÿæˆæ—¶é—´å¢åŠ  < 5ç§’

### Step 11ï¼šè°ƒä¼˜ï¼ˆ2å°æ—¶ï¼‰

#### 11.1 è°ƒæ•´æ£€ç´¢å‚æ•°

```typescript
// åœ¨ searchByCategory ä¸­è°ƒæ•´
topK: 2  // å¢åŠ åˆ° 3 æˆ–å‡å°‘åˆ° 1
scoreThreshold: 0.7  // é™ä½åˆ° 0.6 è·å–æ›´å¤šçŸ¥è¯†
```

#### 11.2 è¡¥å……é—æ¼çŸ¥è¯†

å¦‚æœå‘ç°æŸäº›åœºæ™¯æ€»æ˜¯æ²¡æœ‰è¦†ç›–ï¼š
1. æ·»åŠ å¯¹åº”çš„çŸ¥è¯†åˆ° `initialKnowledge.json`
2. é‡æ–°è¿è¡Œå¯¼å…¥è„šæœ¬
3. å†æ¬¡æµ‹è¯•

---

## ğŸ¯ å®Œæˆæ ‡å¿—

- [x] Qdrant å®¹å™¨è¿è¡Œæ­£å¸¸
- [x] çŸ¥è¯†åº“è‡³å°‘æœ‰ 20 æ¡çŸ¥è¯†
- [x] æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæ—¶èƒ½æ£€ç´¢åˆ°ç›¸å…³çŸ¥è¯†
- [x] ç”¨ä¾‹è¦†ç›–ç‡æå‡ 30%+
- [x] ç”Ÿæˆçš„ç”¨ä¾‹åŒ…å«ä¸šåŠ¡è§„åˆ™ã€è¸©å‘ç‚¹ã€èµ„æŸåœºæ™¯

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: Docker å®¹å™¨å¯åŠ¨å¤±è´¥

**é”™è¯¯**: `port 6333 is already in use`

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr 6333

# ç»“æŸè¿›ç¨‹æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
docker run -d --name qdrant -p 6334:6333 ...
```

### Q2: Embedding API è°ƒç”¨å¤±è´¥

**é”™è¯¯**: `fetch failed` æˆ– `401 Unauthorized`

**è§£å†³**:
1. æ£€æŸ¥ `.env` ä¸­çš„ `EMBEDDING_API_KEY` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ä»£ç†é…ç½® `HTTPS_PROXY`
3. æµ‹è¯• API:
```bash
curl https://openrouter.ai/api/v1/models \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Q3: æ£€ç´¢ä¸åˆ°ç›¸å…³çŸ¥è¯†

**åŸå› **: ç›¸ä¼¼åº¦é˜ˆå€¼å¤ªé«˜

**è§£å†³**:
```typescript
// é™ä½é˜ˆå€¼
scoreThreshold: 0.6  // ä» 0.7 é™åˆ° 0.6
```

### Q4: çŸ¥è¯†åº“å¯¼å…¥å¾ˆæ…¢

**åŸå› **: æ¯æ¡çŸ¥è¯†éƒ½è¦è°ƒç”¨ Embedding API

**ä¼˜åŒ–**:
- ä½¿ç”¨æ‰¹é‡ APIï¼ˆå¦‚æœæ”¯æŒï¼‰
- æˆ–è€…åˆ†æ‰¹å¯¼å…¥ï¼Œæ¯æ‰¹é—´éš”å‡ ç§’

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ä½¿ç”¨çŸ¥è¯†åº“å‰ï¼š
```
æµ‹è¯•ç”¨ä¾‹: è®¢å•åˆ›å»ºåŠŸèƒ½
- æµ‹è¯•ç‚¹1: ã€æ­£å¸¸ã€‘æ‰€æœ‰å¿…å¡«é¡¹å¡«å†™æ­£ç¡®
- æµ‹è¯•ç‚¹2: ã€å¼‚å¸¸ã€‘å¿…å¡«é¡¹ä¸ºç©º
- æµ‹è¯•ç‚¹3: ã€è¾¹ç•Œã€‘è¾“å…¥è¶…é•¿å†…å®¹
```

### ä½¿ç”¨çŸ¥è¯†åº“åï¼š
```
æµ‹è¯•ç”¨ä¾‹: è®¢å•åˆ›å»ºåŠŸèƒ½
- æµ‹è¯•ç‚¹1: ã€æ­£å¸¸ã€‘æ‰€æœ‰å¿…å¡«é¡¹å¡«å†™æ­£ç¡®
- æµ‹è¯•ç‚¹2: ã€å¼‚å¸¸ã€‘å¿…å¡«é¡¹ä¸ºç©º
- æµ‹è¯•ç‚¹3: ã€è¾¹ç•Œã€‘è¾“å…¥è¶…é•¿å†…å®¹
- æµ‹è¯•ç‚¹4: ã€ä¸šåŠ¡è§„åˆ™ã€‘è®¢å•é‡‘é¢ = å•†å“æ€»ä»· - ä¼˜æƒ  + è¿è´¹
- æµ‹è¯•ç‚¹5: ã€ä¸šåŠ¡è§„åˆ™ã€‘åº“å­˜æ‰£å‡æ—¶æœºï¼šæ”¯ä»˜æˆåŠŸåç«‹å³æ‰£å‡
- æµ‹è¯•ç‚¹6: ã€è¸©å‘ç‚¹ã€‘ä¼˜æƒ å åŠ å¯¼è‡´è®¢å•é‡‘é¢ä¸ºè´Ÿæ•°
- æµ‹è¯•ç‚¹7: ã€èµ„æŸåœºæ™¯ã€‘é‡å¤æäº¤å¯¼è‡´é‡å¤æ‰£æ¬¾
- æµ‹è¯•ç‚¹8: ã€é«˜å¹¶å‘ã€‘100äººåŒæ—¶æŠ¢è´­åº“å­˜10çš„å•†å“
```

**è¦†ç›–ç‡æå‡**: 3ä¸ªæµ‹è¯•ç‚¹ â†’ 8ä¸ªæµ‹è¯•ç‚¹ï¼ˆ+167%ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

1. **æŒç»­ç§¯ç´¯çŸ¥è¯†**
   - æ¯æ¬¡å‘ç°æ–°çš„Bugï¼Œæ·»åŠ åˆ°è¸©å‘ç‚¹åº“
   - æ¯ä¸ªç‰ˆæœ¬çš„ä¸šåŠ¡è§„åˆ™å˜æ›´ï¼Œæ›´æ–°çŸ¥è¯†åº“

2. **è‡ªåŠ¨åŒ–çŸ¥è¯†ç®¡ç†**
   - å¼€å‘å‰ç«¯ç•Œé¢ï¼Œå¯è§†åŒ–ç®¡ç†çŸ¥è¯†
   - æµ‹è¯•æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè‡ªåŠ¨æç¤ºè¡¥å……çŸ¥è¯†

3. **çŸ¥è¯†åº“æ‰©å±•**
   - æ·»åŠ æµ‹è¯•æ•°æ®ç¤ºä¾‹åº“
   - æ·»åŠ APIæ¥å£å®šä¹‰åº“
   - æ·»åŠ UIäº¤äº’æ¨¡å¼åº“

---

**å¼€å§‹ä½ çš„çŸ¥è¯†åº“ä¹‹æ—…å§ï¼ğŸ‰**
