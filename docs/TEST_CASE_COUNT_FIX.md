# 测试用例数量问题修复

## 📋 问题描述

**现象**：修改数据一致性规则后，1个测试点只能生成1个用例了，之前还有3条。

**根本原因**：
在优化数据一致性提示词时，提示词中的某些表述让 AI 倾向于只生成 1 个用例：

```markdown
- 如果测试点比较简单，通常生成1个测试用例
- 如果测试点涉及多种情况，可以生成2-3个测试用例  ← 表述太弱
```

这种表述让 AI 默认倾向于生成 1 个用例，只有在"涉及多种情况"时才"可以"生成多个，导致用例数量骤减。

## ✅ 解决方案

### 1. 强化用例数量要求

#### 修改前 ❌
```markdown
- 如果测试点比较简单，通常生成1个测试用例（但仍需为每步骤添加预期结果）
- 如果测试点涉及多种情况，可以生成2-3个测试用例
```

**问题**：
- ❌ "通常生成1个" - 默认就是1个
- ❌ "可以生成2-3个" - 只是可选项
- ❌ 没有强调应该生成多个

#### 修改后 ✅
```markdown
### 用例数量要求（重要！）
- **一个测试点通常需要生成 2-3 个测试用例**，覆盖不同的测试场景：
  * 至少1个 SMOKE（冒烟用例）- 正常流程
  * 1-2个 BOUNDARY（边界用例）- 边界条件
  * 0-1个 ABNORMAL（异常用例）- 异常情况
- **只有极其简单的测试点才生成1个用例**（如：纯查看类、单一操作）
- **大多数测试点都应该生成多个用例**，以覆盖：
  * 正常情况 vs 异常情况
  * 有数据 vs 无数据
  * 不同的输入组合
  * 不同的边界值
```

**改进**：
- ✅ "通常需要生成 2-3 个" - 明确默认数量
- ✅ "只有极其简单的才生成1个" - 反向强调
- ✅ "大多数都应该生成多个" - 强调普遍性
- ✅ 列出具体覆盖场景 - 指导 AI 生成

### 2. 优化"何时生成多个"的描述

#### 修改前 ❌
```markdown
**何时生成多个测试用例？**
- 测试点涉及多种测试数据（如：正常值、边界值、异常值）→ 通常生成2-3个用例
- 测试点涉及多种场景（如：不同用户角色、不同权限）→ 通常生成2-3个用例
- 测试点需要不同的前置条件 → 通常生成2个用例
- 简单测试点（单一场景、单一数据）→ 通常生成1个用例  ← 问题
- 复杂测试点（多种组合）→ 通常生成3-5个用例
```

#### 修改后 ✅
```markdown
**何时生成多个测试用例？（默认情况下都应该生成多个）**
- ✅ **强烈推荐**：测试点涉及输入验证 → **必须生成2-3个用例**（正常、为空、异常）
- ✅ **强烈推荐**：测试点涉及多种测试数据 → **必须生成2-3个用例**（正常值、边界值、异常值）
- ✅ **强烈推荐**：测试点涉及多种场景 → **生成2-3个用例**（不同角色、不同权限）
- ✅ **推荐**：测试点需要不同的前置条件 → **生成2个用例**
- ⚠️ **谨慎**：极简单测试点（仅查看、只读）→ 可考虑1个用例
- ✅ **必须**：复杂测试点（多种组合）→ **生成3-5个用例**

**总原则：一个测试点通常应该生成 2-3 个用例，而不是 1 个！**
```

**改进**：
- ✅ 使用"强烈推荐"、"必须"等强调词
- ✅ 使用 ✅ 符号突出显示
- ✅ 将"简单测试点"改为"极简单"并标记为"谨慎"
- ✅ 添加总原则强调

### 3. 更新预估数量原则

#### 修改前 ❌
```markdown
**预估测试用例数量的原则：**
- 分析测试点的复杂度：步骤数量、涉及的数据类型、场景数量
- 简单测试点（3步以内，单一场景）：预估1个用例  ← 默认1个
- 中等测试点（4-6步，2-3种情况）：预估2-3个用例
- 复杂测试点（7步以上，多种组合）：预估3-5个用例
```

#### 修改后 ✅
```markdown
**预估测试用例数量的原则：**
- 分析测试点的复杂度：步骤数量、涉及的数据类型、场景数量
- **默认策略：每个测试点生成 2-3 个用例**（覆盖正常、边界、异常场景）
- 极简单测试点（纯查看、单一只读操作）：可考虑1个用例
- 中等测试点（输入、查询、操作类）：**强烈建议 2-3 个用例**
- 复杂测试点（多步骤、多分支、关键功能）：**建议 3-5 个用例**
- 🔥 **原则：宁多勿少，确保覆盖全面**
```

**改进**：
- ✅ 开头明确"默认策略：2-3个"
- ✅ "简单"改为"极简单"
- ✅ 中等测试点强调"强烈建议"
- ✅ 添加"宁多勿少"原则

### 4. 在用户提示中强调数量

#### 新增内容 ✅
```markdown
### 3. 用例数量要求（关键！）
🔥 **请为该测试点生成 2-3 个测试用例，覆盖不同场景**：
   - 至少1个正常场景用例（SMOKE）
   - 1-2个边界/异常场景用例（BOUNDARY/ABNORMAL）
   - 例如：登录测试点应生成：
     * "正常登录" (SMOKE)
     * "用户名为空" (BOUNDARY)
     * "密码错误" (ABNORMAL)
   - **只有极其简单的测试点才生成1个用例**

...

请基于测试点的步骤和预期结果，**生成 2-3 个测试用例**。
```

**特点**：
- ✅ 明确要求"生成 2-3 个测试用例"
- ✅ 提供具体示例（登录场景）
- ✅ 再次强调"只有极其简单的才1个"
- ✅ 最后再次强调数量要求

## 📊 修复对比

### 修复前 ❌

**测试点**：用户登录验证

**生成结果**：
```json
{
  "testCases": [
    {
      "name": "用户登录 - SMOKE",
      "caseType": "SMOKE",
      "testData": "用户名：admin\n密码：123456",
      "steps": "1. 输入用户名和密码\n2. 点击登录"
    }
  ]
}
```

**问题**：
- ❌ 只生成了 1 个用例
- ❌ 没有覆盖边界和异常场景
- ❌ 测试不充分

### 修复后 ✅

**测试点**：用户登录验证

**生成结果**：
```json
{
  "testCases": [
    {
      "name": "正常登录 - SMOKE",
      "caseType": "SMOKE",
      "priority": "high",
      "testData": "用户名：admin\n密码：123456",
      "steps": "1. 【操作】输入用户名'admin'\n   【预期】输入框接收输入\n2. 【操作】输入密码'123456'\n   【预期】密码显示为掩码\n3. 【操作】点击登录按钮\n   【预期】登录成功，跳转到首页"
    },
    {
      "name": "用户名为空 - BOUNDARY",
      "caseType": "BOUNDARY",
      "priority": "high",
      "testData": "用户名：（空）\n密码：123456",
      "steps": "1. 【操作】用户名输入框保持为空\n   【预期】用户名输入框为空\n2. 【操作】输入密码'123456'\n   【预期】密码输入框接收输入\n3. 【操作】点击登录按钮\n   【预期】显示'用户名不能为空'的提示"
    },
    {
      "name": "密码错误 - ABNORMAL",
      "caseType": "ABNORMAL",
      "priority": "medium",
      "testData": "用户名：admin\n密码：wrongpass",
      "testData": "用户名：admin\n密码：wrongpass",
      "steps": "1. 【操作】输入用户名'admin'\n   【预期】输入框接收输入\n2. 【操作】输入错误密码'wrongpass'\n   【预期】密码输入框接收输入\n3. 【操作】点击登录按钮\n   【预期】显示'用户名或密码错误'的提示"
    }
  ]
}
```

**改进**：
- ✅ 生成了 3 个用例
- ✅ 覆盖了正常、边界、异常场景
- ✅ 每个用例都有明确的测试目标
- ✅ 测试覆盖充分

## 🎯 生成策略总结

### 默认策略：2-3 个用例

**适用场景**（大多数情况）：
- ✅ 涉及输入验证的功能
- ✅ 涉及数据操作的功能
- ✅ 涉及状态变化的功能
- ✅ 涉及权限控制的功能

**用例组合建议**：
1. **SMOKE（冒烟）** - 正常流程，基本功能
2. **BOUNDARY（边界）** - 边界条件，空值、最大最小值
3. **ABNORMAL（异常）** - 异常情况，错误数据、非法操作

### 特殊情况：1 个用例

**仅适用于极简单场景**：
- 纯查看类功能（如：查看用户详情）
- 单一只读操作（如：下载文件）
- 无需输入的简单展示

### 特殊情况：3-5 个用例

**适用于复杂场景**：
- 多步骤流程（如：订单创建）
- 多分支逻辑（如：审批流程）
- 关键功能（如：支付）
- 需要覆盖多种组合的场景

## 🚀 生效时间

- ✅ 提示词优化：**立即生效**
- ✅ 默认生成 2-3 个用例：**立即生效**
- ✅ 强化数量要求：**立即生效**

下次为测试点生成用例时，将默认生成 2-3 个用例！

## 📝 使用建议

1. **检查生成结果**：如果某个测试点只生成了 1 个用例，检查是否真的足够简单
2. **手动补充**：如果觉得用例不够，可以点击"重新生成"或手动添加
3. **质量优先**：宁愿多生成几个用例，也不要遗漏重要场景

## 📌 相关文档

- `docs/TEST_CASE_CONSISTENCY_FIX.md` - 数据一致性修复
- `docs/REGENERATE_CASES_FIX.md` - 重新生成修复
- `docs/TEST_CASE_COUNT_FIX.md` - 用例数量修复（本文档）

