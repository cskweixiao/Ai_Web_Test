# æ–‡ä»¶æ ¼å¼ä¼˜åŒ–è¯´æ˜

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³ PDF å’Œ DOCX æ–‡ä»¶è¯»å–æ—¶æ ¼å¼ä¸¢å¤±çš„é—®é¢˜ï¼Œå°½å¯èƒ½ä¿ç•™åŸå§‹æ–‡æ¡£çš„ç»“æ„å’Œæ ¼å¼ä¿¡æ¯ã€‚

---

## âœ¨ ä¼˜åŒ–å†…å®¹

### 1. **PDF æ–‡ä»¶ä¼˜åŒ–**

#### åŸæœ‰é—®é¢˜
- âŒ ä»…æå–çº¯æ–‡æœ¬ï¼Œæ‰€æœ‰æ ¼å¼ä¸¢å¤±
- âŒ æ‰«æç‰ˆ PDFï¼ˆå›¾ç‰‡ï¼‰æ— æ³•è¯†åˆ«
- âŒ è¡¨æ ¼ç»“æ„ä¸¢å¤±
- âŒ å¸ƒå±€ä¿¡æ¯ä¸¢å¤±

#### ä¼˜åŒ–æ–¹æ¡ˆ
- âœ… **ä¿ç•™å¸ƒå±€ä¿¡æ¯**ï¼šæŒ‰è¡Œç»„ç»‡æ–‡æœ¬ï¼Œä¿æŒåŸå§‹ä¸Šä¸‹ä½ç½®å…³ç³»
- âœ… **æ£€æµ‹è¡¨æ ¼ç»“æ„**ï¼šè‡ªåŠ¨è¯†åˆ«è¡¨æ ¼æ¨¡å¼å¹¶è½¬æ¢ä¸º Markdown è¡¨æ ¼æ ¼å¼
- âœ… **æ‰«æç‰ˆè¯†åˆ«**ï¼šæ™ºèƒ½æ£€æµ‹æ‰«æç‰ˆ PDFï¼Œæä¾›æ˜ç¡®è­¦å‘Šå’Œå»ºè®®
- âœ… **å›¾ç‰‡æ£€æµ‹**ï¼šæ ‡è®°åŒ…å«å›¾ç‰‡çš„é¡µé¢ï¼Œæé†’ç”¨æˆ·è¡¥å……æè¿°

#### æŠ€æœ¯å®ç°
```typescript
// æŒ‰è¡Œç»„ç»‡æ–‡æœ¬ï¼ˆä¿ç•™å¸ƒå±€ï¼‰
const lines: { y: number; text: string }[] = [];
items.forEach(item => {
  const y = Math.round(item.transform[5]);
  const existingLine = lines.find(line => Math.abs(line.y - y) < 5);
  if (existingLine) {
    existingLine.text += ' ' + item.str;
  } else {
    lines.push({ y, text: item.str });
  }
});

// æ£€æµ‹è¡¨æ ¼å¹¶æ ¼å¼åŒ–ä¸º Markdown
const tableDetected = detectTable(pageLines);
if (tableDetected) {
  fullText += formatAsTable(pageLines);
}

// æ£€æµ‹æ‰«æç‰ˆ PDF
const isScanned = totalTextLength < 100 && pdf.numPages > 0;
```

---

### 2. **DOCX æ–‡ä»¶ä¼˜åŒ–**

#### åŸæœ‰é—®é¢˜
- âŒ ä½¿ç”¨ `extractRawText()` åªæå–çº¯æ–‡æœ¬
- âŒ è¡¨æ ¼ã€åˆ—è¡¨ã€æ ‡é¢˜ç­‰æ ¼å¼å…¨éƒ¨ä¸¢å¤±
- âŒ å›¾ç‰‡å®Œå…¨æ— æ³•è¯†åˆ«

#### ä¼˜åŒ–æ–¹æ¡ˆ
- âœ… **HTML è½¬æ¢**ï¼šä½¿ç”¨ `convertToHtml()` ä¿ç•™å®Œæ•´æ ¼å¼ç»“æ„
- âœ… **å›¾ç‰‡è½¬ Base64**ï¼šè‡ªåŠ¨å°†å›¾ç‰‡è½¬æ¢ä¸º base64 å†…è”æ˜¾ç¤º
- âœ… **ä¿ç•™æ ‡é¢˜å±‚çº§**ï¼šH1-H6 æ ‡é¢˜è‡ªåŠ¨è½¬æ¢ä¸º Markdown æ ¼å¼
- âœ… **ä¿ç•™åˆ—è¡¨æ ¼å¼**ï¼šæœ‰åº/æ— åºåˆ—è¡¨ä¿æŒç»“æ„
- âœ… **æ™ºèƒ½è¡¨æ ¼è½¬æ¢**ï¼šç®€å•è¡¨æ ¼è½¬ Markdownï¼Œå¤æ‚è¡¨æ ¼ä¿ç•™ HTML
- âœ… **æ ·å¼æ˜ å°„**ï¼šæ­£ç¡®å¤„ç†ä¸­è‹±æ–‡æ ‡é¢˜æ ·å¼
- âœ… **è¿‡æ»¤æ— å…³è­¦å‘Š**ï¼šè‡ªåŠ¨è¿‡æ»¤ Mammoth.js çš„å¸¸è§è­¦å‘Šä¿¡æ¯

#### æŠ€æœ¯å®ç°
```typescript
// ä½¿ç”¨ HTML è½¬æ¢å¹¶é…ç½®å›¾ç‰‡å¤„ç†
const htmlResult = await mammoth.convertToHtml(
  { arrayBuffer },
  {
    // é…ç½®å›¾ç‰‡è½¬æ¢ä¸º base64
    convertImage: mammoth.images.imgElement(function(image: any) {
      return image.read("base64").then(function(imageBuffer: any) {
        hasImages = true;
        return {
          src: "data:" + image.contentType + ";base64," + imageBuffer
        };
      });
    }),
    // æ ·å¼æ˜ å°„ï¼ˆæ­£ç¡®çš„ Mammoth.js è¯­æ³•ï¼‰
    styleMap: [
      "p[style-name='Heading 1'] => h1:fresh",
      "p[style-name='Heading 2'] => h2:fresh",
      "p[style-name='æ ‡é¢˜ 1'] => h1:fresh",
      "p[style-name='æ ‡é¢˜ 2'] => h2:fresh",
      // ...æ›´å¤šæ ·å¼
    ]
  }
);

// HTML è½¬ Markdownï¼ˆå¢å¼ºç‰ˆï¼‰
const content = convertHtmlToMarkdown(htmlResult.value);
```

---

### 3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**

#### æ–°å¢åŠŸèƒ½
1. **æ ¼å¼è­¦å‘Šæç¤º**
   - âš ï¸ æ‰«æç‰ˆ PDF è­¦å‘Šï¼ˆçº¢è‰²é«˜äº®ï¼‰
   - ğŸ“· å›¾ç‰‡å†…å®¹æé†’
   - ğŸ“Š è¡¨æ ¼ä¿ç•™æç¤º
   - ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼ˆä½¿ç”¨æ–‡å­—ç‰ˆ PDFã€OCR è½¬æ¢ç­‰ï¼‰

2. **æ–‡ä»¶é¢„è§ˆå¢å¼º**
   - æ˜¾ç¤ºæ–‡ä»¶ç±»å‹ã€å¤§å°ã€å†…å®¹é•¿åº¦
   - æ™ºèƒ½æ£€æµ‹æ–‡ä»¶è´¨é‡
   - æä¾›æ”¹è¿›å»ºè®®

3. **é”™è¯¯å¤„ç†ä¼˜åŒ–**
   - æ‰«æç‰ˆ PDF å…è®¸ç»§ç»­ï¼ˆæä¾›è­¦å‘Šä½†ä¸é˜»æ­¢ï¼‰
   - è¯¦ç»†çš„è­¦å‘Šä¿¡æ¯æ”¶é›†
   - å‹å¥½çš„é”™è¯¯æç¤º

---

## ğŸ“‹ ä½¿ç”¨å»ºè®®

### PDF æ–‡ä»¶
- âœ… **æ¨è**ï¼šä½¿ç”¨æ–‡å­—ç‰ˆ PDFï¼ˆå¯é€‰æ‹©å¤åˆ¶æ–‡æœ¬çš„ PDFï¼‰
- âš ï¸ **ä¸æ¨è**ï¼šæ‰«æç‰ˆ PDFï¼ˆå›¾ç‰‡æ ¼å¼ï¼‰
- ğŸ’¡ **æ›¿ä»£æ–¹æ¡ˆ**ï¼š
  1. é‡æ–°ç”Ÿæˆæ–‡å­—ç‰ˆ PDF
  2. ä½¿ç”¨ OCR å·¥å…·è½¬æ¢ï¼ˆå¦‚ Adobe Acrobatã€ABBYY FineReaderï¼‰
  3. ç›´æ¥ç²˜è´´æ–‡æœ¬å†…å®¹ï¼ˆæ¨èï¼‰

### DOCX æ–‡ä»¶
- âœ… **æ¨è**ï¼šæ ‡å‡†æ ¼å¼çš„ Word æ–‡æ¡£
- âš ï¸ **é™åˆ¶**ï¼šå›¾ç‰‡æ— æ³•æå–å†…å®¹
- ğŸ’¡ **å»ºè®®**ï¼š
  1. è¡¨æ ¼ä¼šå°½å¯èƒ½ä¿ç•™æ ¼å¼
  2. å›¾ç‰‡ä½ç½®ä¼šæ ‡è®°ï¼Œä½†éœ€åœ¨"è¡¥å……ä¸šåŠ¡è§„åˆ™"ä¸­æ‰‹åŠ¨æè¿°
  3. å¤æ‚æ ¼å¼å¯èƒ½éœ€è¦è°ƒæ•´

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–°å¢æ¥å£å­—æ®µ

```typescript
export interface FileReadResult {
  success: boolean;
  content: string;
  error?: string;
  fileName: string;
  fileType: string;
  fileSize: number;
  hasImages?: boolean;        // ğŸ†• æ˜¯å¦åŒ…å«å›¾ç‰‡
  isScannedPdf?: boolean;     // ğŸ†• æ˜¯å¦ä¸ºæ‰«æç‰ˆPDF
  formatWarnings?: string[];  // ğŸ†• æ ¼å¼è­¦å‘Šä¿¡æ¯
}
```

### è­¦å‘Šç±»å‹

1. **ä¸¥é‡è­¦å‘Š**ï¼ˆçº¢è‰²ï¼‰
   - æ‰«æç‰ˆ PDF æ£€æµ‹
   - æ–‡ä»¶æ— æ³•è¯»å–

2. **æ ¼å¼æç¤º**ï¼ˆæ©™è‰²ï¼‰
   - å›¾ç‰‡å†…å®¹æ— æ³•æå–
   - è¡¨æ ¼æ ¼å¼ä¿ç•™
   - æ ¼å¼è½¬æ¢è­¦å‘Š

3. **ä¼˜åŒ–å»ºè®®**ï¼ˆè“è‰²ï¼‰
   - ä½¿ç”¨å»ºè®®
   - æ›¿ä»£æ–¹æ¡ˆ

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### PDF å¤„ç†

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| æ–‡æœ¬æå– | âœ… | âœ… |
| å¸ƒå±€ä¿ç•™ | âŒ | âœ… |
| è¡¨æ ¼è¯†åˆ« | âŒ | âœ… (è½¬ä¸ºMarkdown) |
| æ‰«æç‰ˆæ£€æµ‹ | âŒ | âœ… (æ™ºèƒ½è­¦å‘Š) |
| å›¾ç‰‡è¯†åˆ« | âŒ | âœ… (æ ‡è®°ä½ç½®) |

### DOCX å¤„ç†

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| æ–‡æœ¬æå– | âœ… | âœ… |
| æ ‡é¢˜æ ¼å¼ | âŒ | âœ… (Markdown) |
| åˆ—è¡¨æ ¼å¼ | âŒ | âœ… (Markdown) |
| è¡¨æ ¼ä¿ç•™ | âŒ | âœ… (HTML/Markdown) |
| ç²—ä½“æ–œä½“ | âŒ | âœ… (Markdown) |
| å›¾ç‰‡è¯†åˆ« | âŒ | âœ… (æ ‡è®°ä½ç½®) |

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
1. **OCR é›†æˆ**ï¼šé›†æˆ Tesseract.js è‡ªåŠ¨è¯†åˆ«æ‰«æç‰ˆ PDF
2. **å›¾ç‰‡æè¿°**ï¼šä½¿ç”¨ AI è§†è§‰æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡æè¿°
3. **è¡¨æ ¼ä¼˜åŒ–**ï¼šæ›´æ™ºèƒ½çš„è¡¨æ ¼è¯†åˆ«å’Œæ ¼å¼åŒ–

### é•¿æœŸè§„åˆ’
1. **å¤šæ–‡æ¡£åˆå¹¶**ï¼šæ”¯æŒå¤šä¸ª PDF/DOCX æ™ºèƒ½åˆå¹¶
2. **æ ¼å¼é¢„è§ˆ**ï¼šå®æ—¶é¢„è§ˆæ–‡æ¡£æ ¼å¼è½¬æ¢æ•ˆæœ
3. **è‡ªå®šä¹‰è§„åˆ™**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ ¼å¼è½¬æ¢è§„åˆ™

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.1.1 (2024-12-18 - ä¿®å¤ç‰ˆ)
- ğŸ”§ **ä¿®å¤ Mammoth.js API é”™è¯¯**ï¼šä½¿ç”¨æ­£ç¡®çš„ `convertToHtml` ä»£æ›¿ä¸å­˜åœ¨çš„ `convertToMarkdown`
- ğŸ”§ **ä¿®å¤æ ·å¼æ˜ å°„è¯­æ³•**ï¼šä½¿ç”¨ `h1:fresh` æ ¼å¼ä»£æ›¿é”™è¯¯çš„ Markdown è¯­æ³•
- ğŸ”§ **è¿‡æ»¤æ— å…³è­¦å‘Š**ï¼šè‡ªåŠ¨å¿½ç•¥ `w:tblPrEx`ã€`List Paragraph` ç­‰å¸¸è§è­¦å‘Š
- ğŸ–¼ï¸ **å›¾ç‰‡ Base64 è½¬æ¢**ï¼šDOCX ä¸­çš„å›¾ç‰‡è‡ªåŠ¨è½¬ä¸º base64 å†…è”æ˜¾ç¤º
- ğŸ“ **ä¿®å¤é¡µé¢å®½åº¦é—®é¢˜**ï¼šæ·»åŠ  CSS é˜²æ­¢é•¿å†…å®¹å’Œå›¾ç‰‡æ’‘å¼€é¡µé¢å¸ƒå±€
- ğŸ†• **å¢å¼ºè¡¨æ ¼è½¬æ¢**ï¼šæ”¹è¿› HTML åˆ° Markdown çš„è¡¨æ ¼è½¬æ¢é€»è¾‘

### v1.1.0 (2024-12-18)
- âœ… PDFï¼šä¿ç•™å¸ƒå±€ã€æ£€æµ‹è¡¨æ ¼ã€è¯†åˆ«æ‰«æç‰ˆ
- âœ… DOCXï¼šè½¬æ¢ä¸º Markdownã€ä¿ç•™è¡¨æ ¼å’Œåˆ—è¡¨
- âœ… UIï¼šæ–°å¢æ ¼å¼è­¦å‘Šæç¤ºå’Œä¼˜åŒ–å»ºè®®
- âœ… ä½“éªŒï¼šæ›´å‹å¥½çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·å¼•å¯¼

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‡†å¤‡
- ä¼˜å…ˆä½¿ç”¨æ–‡å­—ç‰ˆ PDF æˆ–æ ‡å‡† Word æ–‡æ¡£
- é¿å…ä½¿ç”¨æ‰«æç‰ˆã€å›¾ç‰‡æ ¼å¼
- è¡¨æ ¼å»ºè®®ä½¿ç”¨ç®€å•æ ¼å¼ï¼ˆé¿å…åˆå¹¶å•å…ƒæ ¼ï¼‰

### 2. å›¾ç‰‡å¤„ç†
- é‡è¦å›¾ç‰‡ä¿¡æ¯åœ¨"è¡¥å……ä¸šåŠ¡è§„åˆ™"ä¸­æè¿°
- æµç¨‹å›¾ã€æ¶æ„å›¾å¯ä»¥è½¬ä¸ºæ–‡å­—æè¿°
- UI æˆªå›¾å»ºè®®ä½¿ç”¨åŸå‹æ–‡ä»¶ï¼ˆHTMLï¼‰

### 3. æ ¼å¼ä¼˜åŒ–
- æ ‡é¢˜ä½¿ç”¨æ ‡å‡†æ ·å¼ï¼ˆWord ä¸­çš„"æ ‡é¢˜1"ã€"æ ‡é¢˜2"ç­‰ï¼‰
- åˆ—è¡¨ä½¿ç”¨æ ‡å‡†é¡¹ç›®ç¬¦å·æˆ–ç¼–å·
- è¡¨æ ¼ä¿æŒç®€å•æ¸…æ™°çš„ç»“æ„

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¼šçœ‹åˆ° "w:tblPrEx" è­¦å‘Šï¼Ÿ
**A:** è¿™æ˜¯ Mammoth.js å¯¹ Word è¡¨æ ¼æ‰©å±•å±æ€§çš„è­¦å‘Šï¼Œä¸å½±å“å†…å®¹æå–ã€‚ç³»ç»Ÿå·²è‡ªåŠ¨è¿‡æ»¤æ­¤ç±»è­¦å‘Šã€‚

### Q2: DOCX ä¸­çš„å›¾ç‰‡èƒ½æ­£å¸¸æ˜¾ç¤ºå—ï¼Ÿ
**A:** âœ… èƒ½ï¼å›¾ç‰‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸º base64 å†…è”æ˜¾ç¤ºã€‚ä½†è¦æ³¨æ„ï¼š
- å›¾ç‰‡ä¼šå¢åŠ æ–‡ä»¶å¤§å°
- å¤§é‡å›¾ç‰‡å¯èƒ½å½±å“åŠ è½½é€Ÿåº¦
- å›¾ç‰‡å†…å®¹ AI æ— æ³•ç†è§£ï¼Œå»ºè®®åœ¨"è¡¥å……ä¸šåŠ¡è§„åˆ™"ä¸­æè¿°

### Q3: é¡µé¢å®½åº¦è¢«æ‹‰é•¿æ€ä¹ˆåŠï¼Ÿ
**A:** å·²ä¿®å¤ï¼ç°åœ¨æ·»åŠ äº†ä»¥ä¸‹ CSS ä¿æŠ¤ï¼š
- æ–‡æœ¬è‡ªåŠ¨æ¢è¡Œï¼ˆ`word-wrap: break-word`ï¼‰
- å›¾ç‰‡æœ€å¤§å®½åº¦é™åˆ¶ï¼ˆ`max-width: 100%`ï¼‰
- Base64 å›¾ç‰‡é«˜åº¦é™åˆ¶ï¼ˆ`max-height: 500px`ï¼‰
- è¡¨æ ¼æ¨ªå‘æ»šåŠ¨

### Q4: è¡¨æ ¼æ ¼å¼ä¼šä¸¢å¤±å—ï¼Ÿ
**A:** å°½é‡ä¿ç•™ï¼å¤„ç†é€»è¾‘ï¼š
- ç®€å•è¡¨æ ¼ â†’ è½¬æ¢ä¸º Markdown è¡¨æ ¼
- å¤æ‚è¡¨æ ¼ â†’ ä¿ç•™ HTML æ ¼å¼ï¼ˆå¸¦æ¨ªå‘æ»šåŠ¨ï¼‰
- åˆå¹¶å•å…ƒæ ¼ â†’ å°½é‡ä¿ç•™ç»“æ„

### Q5: æ‰«æç‰ˆ PDF å¦‚ä½•å¤„ç†ï¼Ÿ
**A:** ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è­¦å‘Šï¼Œå»ºè®®ï¼š
1. é‡æ–°ç”Ÿæˆæ–‡å­—ç‰ˆ PDF
2. ä½¿ç”¨ OCR å·¥å…·è½¬æ¢ï¼ˆAdobe Acrobatã€ABBYY FineReaderï¼‰
3. ç›´æ¥å¤åˆ¶ç²˜è´´æ–‡æœ¬å†…å®¹ï¼ˆæ¨èï¼‰

### Q6: æ ·å¼æ˜ å°„é”™è¯¯æ€ä¹ˆè§£å†³ï¼Ÿ
**A:** å·²ä¿®å¤ï¼ç°åœ¨ä½¿ç”¨æ­£ç¡®çš„ Mammoth.js è¯­æ³•ï¼š
```typescript
// âŒ é”™è¯¯ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
"p[style-name='Heading 1'] => # "

// âœ… æ­£ç¡®ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
"p[style-name='Heading 1'] => h1:fresh"
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- æ ¸å¿ƒå®ç°ï¼š`src/utils/fileReader.ts`
- UI é›†æˆï¼š`src/pages/FunctionalTestCaseGenerator.tsx`
- ç±»å‹å®šä¹‰ï¼š`FileReadResult` æ¥å£

---

**æ›´æ–°æ—¶é—´**ï¼š2024-12-18  
**ç‰ˆæœ¬**ï¼šv1.1.1  
**ç»´æŠ¤è€…**ï¼šAI å¼€å‘åŠ©æ‰‹

