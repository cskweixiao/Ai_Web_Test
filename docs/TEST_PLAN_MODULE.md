# 测试计划模块使用说明

## 功能概述

测试计划模块是一个综合性的测试管理功能，支持创建、管理和执行测试计划。该模块整合了功能测试用例和UI自动化用例，提供完整的测试计划生命周期管理。

## 主要功能

### 1. 创建测试计划

测试计划包含以下字段：

- **基本信息**
  - 计划名称（必填）
  - 计划简称
  - 所属项目
  - 计划描述
  
- **计划类型**（必填）
  - 功能测试
  - UI自动化测试
  - 混合测试
  - 回归测试
  - 冒烟测试
  - 集成测试

- **计划状态**
  - 草稿
  - 进行中
  - 已完成
  - 已取消
  - 已归档

- **时间安排**
  - 开始日期
  - 结束日期

- **成员管理**
  - 主负责人（必填）
  - 测试成员列表

### 2. 测试用例管理

#### 添加用例到测试计划

1. 在测试计划详情页面点击"添加用例"
2. 选择用例类型（功能测试或UI自动化）
3. 从用例列表中选择要添加的用例
4. 用例会按照添加顺序排序

#### 移除用例

在测试计划详情页面的用例列表中，点击"移除"按钮即可移除用例。

### 3. 执行测试计划

#### 功能测试执行

1. 在测试计划列表或详情页面点击"执行功能测试"
2. 系统会进入功能测试执行页面
3. 按照测试步骤手动执行每个用例
4. 记录执行结果（通过/失败/阻塞/跳过）
5. 执行完成后，结果会自动汇总到测试计划中

#### UI自动化执行

1. 在测试计划列表或详情页面点击"执行UI自动化"
2. 系统会自动执行所有UI自动化用例
3. 执行过程中可以查看实时日志和进度
4. 执行完成后，结果会自动汇总到测试计划中

### 4. 执行历史和统计

#### 执行历史

在测试计划详情页面的"执行历史"标签页中，可以查看：
- 执行时间
- 执行人
- 执行类型（功能测试/UI自动化）
- 执行状态
- 用例统计（总数、完成数、通过数、失败数等）
- 执行进度

#### 统计分析

在测试计划详情页面的"统计分析"标签页中，可以查看：
- 用例总数（功能测试、UI自动化）
- 通过率
- 执行率
- 失败用例数
- 阻塞用例数
- 执行次数

## 技术架构

### 前端页面

1. **TestPlans.tsx** - 测试计划列表页面
   - 支持搜索、筛选（项目、类型、状态）
   - 支持创建、查看、编辑、删除测试计划
   - 分页显示

2. **TestPlanForm.tsx** - 测试计划创建/编辑页面
   - 表单验证
   - 支持新建和编辑两种模式

3. **TestPlanDetail.tsx** - 测试计划详情页面
   - 显示计划基本信息
   - 管理测试用例（添加、移除）
   - 查看执行历史
   - 查看统计分析

### 后端API

#### 路由配置

所有测试计划API都在 `/api/v1/test-plans` 路径下：

```
GET    /api/v1/test-plans                    # 获取测试计划列表
GET    /api/v1/test-plans/:id                # 获取测试计划详情
POST   /api/v1/test-plans                    # 创建测试计划
PUT    /api/v1/test-plans/:id                # 更新测试计划
DELETE /api/v1/test-plans/:id                # 删除测试计划
POST   /api/v1/test-plans/:id/cases          # 添加用例到测试计划
DELETE /api/v1/test-plans/:id/cases/:caseId  # 从测试计划中移除用例
POST   /api/v1/test-plans/:id/execute        # 开始执行测试计划
PUT    /api/v1/test-plans/executions/:executionId  # 更新执行状态
GET    /api/v1/test-plans/:id/executions     # 获取执行历史
```

#### 服务层

- **testPlanService.ts** - 后端服务，处理所有测试计划相关的数据库操作
- **testPlanService.ts** (前端) - 前端服务，封装API调用

### 数据库设计

#### 表结构

1. **test_plans** - 测试计划主表
   - 存储测试计划的基本信息
   - 包含计划名称、类型、状态、负责人等

2. **test_plan_cases** - 测试计划与用例关联表
   - 关联测试计划和测试用例
   - 支持功能测试用例和UI自动化用例
   - 记录执行状态和结果

3. **test_plan_executions** - 测试计划执行记录表
   - 记录每次执行的详细信息
   - 包含执行时间、执行人、执行结果、统计数据等

## 数据库迁移

执行以下步骤进行数据库迁移：

```bash
# 1. 应用Prisma schema变更
npx prisma generate

# 2. 执行SQL迁移脚本
mysql -u your_username -p your_database < prisma/migrations/add_test_plan_tables.sql

# 或者在MySQL客户端中执行
source prisma/migrations/add_test_plan_tables.sql;
```

## 使用流程

### 完整的测试计划执行流程

1. **创建测试计划**
   - 进入测试计划页面
   - 点击"新建计划"
   - 填写计划信息
   - 保存

2. **添加测试用例**
   - 进入测试计划详情页面
   - 点击"添加用例"
   - 选择功能测试或UI自动化用例
   - 从用例列表中选择要添加的用例
   - 确认添加

3. **执行测试计划**
   - **功能测试**：手动执行，记录每个用例的执行结果
   - **UI自动化**：自动执行，系统自动记录执行结果

4. **查看执行结果**
   - 在执行历史中查看每次执行的详细信息
   - 在统计分析中查看整体数据

5. **更新测试计划状态**
   - 根据执行情况更新计划状态
   - 草稿 → 进行中 → 已完成

## 注意事项

1. **权限控制**
   - 测试计划的创建、编辑、删除需要认证
   - 执行测试计划需要相应权限

2. **数据完整性**
   - 删除测试计划会同时删除关联的用例记录和执行记录（级联删除）
   - 建议使用软删除（设置deleted_at字段）而不是物理删除

3. **执行并发**
   - UI自动化执行支持并发，但需要注意资源限制
   - 功能测试为手动执行，不存在并发问题

4. **数据备份**
   - 建议定期备份测试计划和执行记录
   - 重要的测试计划建议归档保存

## 后续优化建议

1. **功能增强**
   - 支持测试计划模板
   - 支持测试计划复制
   - 支持测试计划归档和恢复
   - 支持测试计划导出（PDF、Excel）

2. **执行优化**
   - 支持部分用例执行
   - 支持失败用例重试
   - 支持执行进度实时推送
   - 支持执行日志查看

3. **统计分析增强**
   - 添加趋势分析图表
   - 支持自定义统计维度
   - 支持数据对比分析

4. **团队协作**
   - 支持测试计划审批流程
   - 支持测试计划评论和讨论
   - 支持邮件通知和提醒

## 相关文档

- [功能测试用例使用指南](./FUNCTIONAL_TEST_CASES.md)
- [UI自动化用例使用指南](./UI_AUTO_CASES.md)
- [测试执行指南](./TEST_EXECUTION.md)
- [API文档](./API_REFERENCE.md)

