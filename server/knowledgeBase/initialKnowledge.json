{
  "businessRules": [
    {
      "id": "br_001",
      "category": "business_rule",
      "title": "订单金额计算规则",
      "content": "订单总金额 = 商品总价 - 优惠金额 + 运费。优惠金额包括：满减优惠、优惠券、会员折扣等。运费根据地区和重量计算，满足包邮条件时运费为0。",
      "businessDomain": "订单管理",
      "tags": ["订单", "金额计算", "优惠", "运费"]
    },
    {
      "id": "br_002",
      "category": "business_rule",
      "title": "库存扣减时机",
      "content": "库存扣减时机：用户下单并支付成功后立即扣减库存。未支付订单不扣减库存，仅做预占（30分钟）。超时未支付自动释放预占库存。退款时库存回退。",
      "businessDomain": "订单管理",
      "tags": ["库存", "扣减", "预占", "退款"]
    },
    {
      "id": "br_003",
      "category": "business_rule",
      "title": "优惠券使用规则",
      "content": "优惠券使用规则：1) 满减券需订单金额达到门槛才可使用；2) 同类优惠券不可叠加（如两张满减券）；3) 不同类优惠券可叠加（满减+折扣）；4) 优惠券有效期内可用，过期自动失效；5) 部分商品不参与优惠活动。",
      "businessDomain": "优惠促销",
      "tags": ["优惠券", "满减", "叠加规则", "有效期"]
    },
    {
      "id": "br_004",
      "category": "business_rule",
      "title": "订单状态流转",
      "content": "订单状态流转：待支付 → 已支付 → 待发货 → 已发货 → 已完成。特殊路径：待支付可取消；已支付未发货可取消并退款；已发货后只能申请退货退款；已完成可申请售后。超时30分钟未支付自动取消。",
      "businessDomain": "订单管理",
      "tags": ["订单状态", "流转", "取消", "退款"]
    },
    {
      "id": "br_005",
      "category": "business_rule",
      "title": "支付超时自动取消",
      "content": "订单创建后30分钟内未支付，系统自动取消订单。取消后库存预占释放，用户可重新下单。已支付订单不受此规则影响。",
      "businessDomain": "订单管理",
      "tags": ["支付", "超时", "自动取消"]
    }
  ],

  "testPatterns": [
    {
      "id": "tp_001",
      "category": "test_pattern",
      "title": "表单提交功能测试模式",
      "content": "表单提交必测场景：\n【正常】所有必填项正确填写后提交成功\n【异常】必填项为空时提示错误\n【边界】输入框超长内容（最大长度+1）\n【边界】特殊字符输入：<script>alert(1)</script>\n【业务】重复提交拦截（防止表单重复提交）\n【格式】手机号、邮箱、身份证格式校验",
      "businessDomain": "通用",
      "tags": ["表单", "提交", "校验", "必填项"]
    },
    {
      "id": "tp_002",
      "category": "test_pattern",
      "title": "列表查询功能测试模式",
      "content": "列表查询必测场景：\n【正常】不选任何条件查询全部数据\n【正常】单条件精确查询\n【组合】多条件组合查询\n【边界】查询结果为空时显示\"暂无数据\"\n【边界】查询结果超过分页大小时正确分页\n【性能】大数据量查询（>10000条）响应时间<3秒\n【排序】默认排序、点击列头排序",
      "businessDomain": "通用",
      "tags": ["列表", "查询", "筛选", "分页"]
    },
    {
      "id": "tp_003",
      "category": "test_pattern",
      "title": "审核流程功能测试模式",
      "content": "审核流程必测场景：\n【正常】审核通过后状态变更为\"已审核\"\n【正常】审核驳回后状态变更为\"已驳回\"并记录驳回原因\n【权限】非审核人员无法操作审核按钮\n【业务】同一数据不可重复审核\n【业务】驳回后可重新提交审核\n【审计】记录审核人、审核时间、审核意见",
      "businessDomain": "通用",
      "tags": ["审核", "审批", "流程", "权限"]
    },
    {
      "id": "tp_004",
      "category": "test_pattern",
      "title": "数据导入功能测试模式",
      "content": "数据导入必测场景：\n【正常】导入格式正确的Excel文件\n【异常】导入文件格式错误（如PDF、图片）\n【异常】Excel中存在数据格式错误\n【边界】空文件导入\n【边界】超大文件导入（10000行+）\n【业务】数据校验：必填项、格式、重复数据\n【性能】显示导入进度条",
      "businessDomain": "通用",
      "tags": ["导入", "Excel", "批量", "校验"]
    },
    {
      "id": "tp_005",
      "category": "test_pattern",
      "title": "删除操作功能测试模式",
      "content": "删除操作必测场景：\n【正常】删除单条数据成功\n【安全】删除前二次确认\"确定要删除吗？删除后不可恢复\"\n【业务】已关联数据不允许删除或级联删除\n【权限】非创建人不能删除\n【业务】特定状态不允许删除（如已支付订单）\n【审计】删除操作记录日志",
      "businessDomain": "通用",
      "tags": ["删除", "二次确认", "权限", "级联"]
    }
  ],

  "pitfalls": [
    {
      "id": "pf_001",
      "category": "pitfall",
      "title": "优惠券和满减同时使用时计算错误",
      "content": "问题：先计算满减再计算优惠券，导致实付金额为负数。\n场景：商品100元，满100减50，再用50元优惠券，最终金额变成-50元。\n正确做法：先判断优惠券使用门槛（基于原价），再计算最终金额，确保金额≥0。\n测试重点：【资损】优惠叠加导致负金额或0元购",
      "businessDomain": "优惠促销",
      "tags": ["优惠券", "满减", "金额计算", "资损"],
      "metadata": {
        "severity": "high",
        "occurredDate": "2024-03"
      }
    },
    {
      "id": "pf_002",
      "category": "pitfall",
      "title": "高并发下库存超卖",
      "content": "问题：多用户同时下单同一商品，库存扣减未加锁，导致超卖。\n场景：商品库存10件，100人同时下单，最终卖出50件。\n正确做法：库存扣减使用数据库行锁或分布式锁，扣减前再次校验库存。\n测试重点：【高并发】100人同时抢购库存10的商品，最终销售量不能超过10",
      "businessDomain": "订单管理",
      "tags": ["库存", "并发", "超卖", "锁"],
      "metadata": {
        "severity": "high",
        "occurredDate": "2024-06"
      }
    },
    {
      "id": "pf_003",
      "category": "pitfall",
      "title": "运费计算遗漏",
      "content": "问题：计算订单总金额时忘记加运费，导致用户实付金额少于应付金额。\n场景：商品100元，运费10元，显示应付110元，但实际扣款100元。\n正确做法：订单金额公式必须包含运费：订单总额 = 商品总价 - 优惠 + 运费。\n测试重点：【资损】订单总额必须等于商品总价 - 优惠 + 运费",
      "businessDomain": "订单管理",
      "tags": ["运费", "金额计算", "资损"],
      "metadata": {
        "severity": "medium",
        "occurredDate": "2024-05"
      }
    },
    {
      "id": "pf_004",
      "category": "pitfall",
      "title": "退款金额计算错误",
      "content": "问题：退款时返还全部优惠券和满减，导致用户退款金额大于实付金额。\n场景：用户实付80元（原价100，用券20），退款时返还100元。\n正确做法：退款金额 = 实付金额，优惠券作废不返还（或根据业务规则部分返还）。\n测试重点：【资损】退款金额不能超过实付金额",
      "businessDomain": "订单管理",
      "tags": ["退款", "优惠券", "金额计算", "资损"],
      "metadata": {
        "severity": "high",
        "occurredDate": "2024-07"
      }
    },
    {
      "id": "pf_005",
      "category": "pitfall",
      "title": "SQL注入漏洞",
      "content": "问题：查询条件未做参数化处理，直接拼接SQL，导致SQL注入风险。\n场景：用户名输入：admin' OR '1'='1，绕过登录验证。\n正确做法：使用Prisma等ORM工具，或使用参数化查询，永不直接拼接SQL。\n测试重点：【安全】输入特殊字符：' OR '1'='1、; DROP TABLE--等",
      "businessDomain": "通用",
      "tags": ["SQL注入", "安全", "输入校验"],
      "metadata": {
        "severity": "critical",
        "occurredDate": "2024-04"
      }
    }
  ],

  "riskScenarios": [
    {
      "id": "rs_001",
      "category": "risk_scenario",
      "title": "恶意使用优惠券薅羊毛",
      "content": "场景：同一用户短时间内多次领取使用优惠券，利用优惠规则漏洞薅羊毛。\n触发条件：用户在1小时内领取优惠券超过10次，或使用优惠券下单超过5次。\n测试重点：\n1. 优惠券每人限领次数校验\n2. 优惠券使用频次限制（如每日最多用3张）\n3. 异常账号识别拦截（短时间高频操作）\n4. 优惠券总量控制（发完即止）",
      "businessDomain": "优惠促销",
      "tags": ["优惠券", "薅羊毛", "风控", "资损"],
      "metadata": {
        "riskLevel": "high",
        "impactAmount": "可能导致数万元损失"
      }
    },
    {
      "id": "rs_002",
      "category": "risk_scenario",
      "title": "订单金额为负数或0",
      "content": "场景：通过优惠叠加使订单金额变为负数或0，实现0元购或倒贴钱。\n触发条件：优惠金额 ≥ 商品总价 + 运费。\n测试重点：\n1. 订单金额最小值校验（必须>0）\n2. 优惠金额不能超过商品总价\n3. 多个优惠叠加后的最终金额校验\n4. 前后端双重校验（防止前端绕过）",
      "businessDomain": "订单管理",
      "tags": ["订单金额", "0元购", "资损", "校验"],
      "metadata": {
        "riskLevel": "critical",
        "impactAmount": "可能导致直接资损"
      }
    },
    {
      "id": "rs_003",
      "category": "risk_scenario",
      "title": "高并发下重复下单",
      "content": "场景：用户快速点击多次提交按钮，或通过脚本并发请求，导致重复扣款、重复扣库存。\n触发条件：短时间内（如1秒内）同一用户提交多个相同订单。\n测试重点：\n1. 前端按钮防抖（点击后置灰）\n2. 后端接口幂等性（相同请求只处理一次）\n3. 分布式锁控制并发\n4. 订单号唯一性校验",
      "businessDomain": "订单管理",
      "tags": ["并发", "重复下单", "幂等性", "锁"],
      "metadata": {
        "riskLevel": "high",
        "impactAmount": "用户投诉、重复扣款"
      }
    },
    {
      "id": "rs_004",
      "category": "risk_scenario",
      "title": "权限绕过漏洞",
      "content": "场景：通过修改请求参数或直接访问URL，绕过权限校验访问他人数据。\n触发条件：URL中包含用户ID、订单ID等敏感参数，且后端未做权限校验。\n测试重点：\n1. 修改URL中的ID参数访问他人订单\n2. 非审核员直接调用审核接口\n3. 普通用户访问管理员功能\n4. 前后端权限校验一致性",
      "businessDomain": "通用",
      "tags": ["权限", "安全", "数据泄露"],
      "metadata": {
        "riskLevel": "critical",
        "impactAmount": "用户隐私泄露、数据篡改"
      }
    },
    {
      "id": "rs_005",
      "category": "risk_scenario",
      "title": "XSS跨站脚本攻击",
      "content": "场景：用户输入包含恶意脚本，在其他用户浏览器执行，窃取cookie或进行钓鱼攻击。\n触发条件：输入框未做HTML转义，直接渲染到页面。\n测试重点：\n1. 输入<script>alert(document.cookie)</script>是否执行\n2. 输入<img src=x onerror=alert(1)>是否执行\n3. 富文本编辑器输入恶意代码\n4. URL参数中注入脚本",
      "businessDomain": "通用",
      "tags": ["XSS", "安全", "脚本注入"],
      "metadata": {
        "riskLevel": "high",
        "impactAmount": "用户账号被盗、信息泄露"
      }
    }
  ]
}
